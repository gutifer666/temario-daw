
<!-- saved from url=(0112)https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&dopt=1 -->
<html><input type="hidden" id="__yoroi_connector_api_injected_type" value="prod"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<script src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/exe_jquery.js" type="text/javascript"></script>
<script src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/common_i18n.js" type="text/javascript"></script>
<script src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/common.js" type="text/javascript"></script>
<script src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/SCORM_API_wrapper.js" type="text/javascript"></script>
<script src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/SCOFunctions.js" type="text/javascript"></script>
<script src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/exe_highlighter.js" type="text/javascript"></script>
<script src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource" type="text/javascript"></script>
<link href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/base.css" type="text/css" rel="stylesheet">
<link href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/content.css" type="text/css" rel="stylesheet">
<link href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/exe_highlighter.css" type="text/css" rel="stylesheet">
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/exe_tooltips.js"></script></head>
<body class=" js js js js js js js js js js js js js js js js js js js js js js js js js js js js js js js js js js js js js js">
<script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main" role="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">Gestión de bases de datos: relacionales y orientadas a objetos. Persistencia de objetos</h1></div></div>
<div class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id0">
<div class="iDevice emphasis_casopracticofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id0-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta0_66" class="block iDevice_content">
<div class="exe-figure exe-image float-left license-copyright" style="width: 200px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/clothes-g29b96280a.jpg" alt="Imagen que muestra el interior de una tienda de ropa." title="Tienda de ropa" style="float: left;" width="200" height="133">
<div class="figcaption"><a href="https://pixabay.com/es/photos/ropa-moda-tienda-tienda-de-ropa-1839935/" target="_blank" class="author">Pexels</a> <span class="license"><span>Pixabay License</span><span class="sep"></span></span></div>
</div>
<p><strong><br>Ada</strong> ha asignado un proyecto a <strong>María</strong> y a <strong>Juan</strong>. Se trata de un proyecto importante, puede suponer muchas ventas, y por tanto una gran expansión para la empresa.</p>
<p>En concreto, una cadena de tiendas a nivel nacional se ha puesto en contacto con <strong>BK programación</strong> para decirles que necesitan un programa que sustituya al actual <span lang="en">software</span> que utilizan para los puntos de venta. El nuevo <span lang="en">software</span> tendrá unas características especiales,&nbsp; todavía por determinar. Este es un proyecto que si sale adelante será de largo recorrido, dado que no solo requerirá el desarrollo, sino también el mantenimiento y mejora del mismo a lo largo de los años. Podría ser trabajo asegurado para la empresa durante mucho tiempo.</p>
<p>De momento <strong>Ada</strong> les ha pedido a <strong>María</strong> y a <strong>Juan</strong> que se pongan a estudiar cómo es ese tipo de <span lang="en">software</span> y a prepararse para la tarea que está por venir. Ambos saben que una cuestión vital en una aplicación como esta es el almacenamiento de los datos: productos, tiques, movimientos de caja, entrada de productos, <abbr title="etcétera" lang="es">etc</abbr>.</p>
<p>Como en<strong> BK programación</strong> trabajan sobre todo con <span lang="en">Java</span>, desde el primer momento <strong>Juan</strong> y<strong> María</strong> tienen claro que van a tener que utilizar <strong>Bases de Datos</strong>. Su idea ahora es explorar y experimentar, y para ello tienen pensado crear una aplicación sencilla de punto de venta que van a denominar "mini <acronym title="Point of Sale" lang="en">pos</acronym>".</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id48">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id48-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta48_69" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-pd" style="width: 185px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/Baul.png" width="185" height="200" alt="Ilusrración de un bauíl marrón, con la tapa medio abierta." title="Baúl" style="float: right;"><figcaption class="figcaption"><a href="https://pixabay.com/es/vectors/pecho-brown-de-madera-cuadro-150392/" target="_blank" class="author" title="Acceder a la imagen  " baúl",="" de="" "openclipart-vectors",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">OpenClipart-Vectors</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></figcaption></figure>
<p>¿Te imaginas una aplicación donde no se pudieran guardar los datos?</p>
<p>Casi todos los programas hoy día tienen la opción de guardar los datos con los que se trabaja.</p>
<p>Hasta ahora, ya conoces cómo abrir un archivo y utilizarlo como “almacén” para los datos que maneja tu aplicación. Utilizar un archivo para almacenar datos es la forma más sencilla de persistencia, porque en definitiva, <strong>la persistencia es hacer que los datos perduren en el tiempo</strong>.</p>
<p>Hay muchas formas de hacer los datos de una aplicación persistentes, y muchos <strong>niveles de persistencia</strong>. Cuando los datos de la aplicación solo están disponibles mientras la aplicación se está ejecutando, tenemos un nivel de persistencia muy bajo.</p>
<p class="destacado" style="text-align: center;"><strong>Es deseable que los datos de nuestra aplicación tengan el mayor nivel de persistencia posible</strong>.</p>
<p>Tendremos un mayor nivel de persistencia si los datos “sobreviven” a varias ejecuciones, o lo que es lo mismo, <strong>si nuestros datos se guardan</strong> y luego son <strong>reutilizables</strong> con posterioridad. Tendremos un nivel todavía mayor si “sobreviven” a varias versiones de la aplicación, es decir, si guardo los datos con la versión 1.0 de la aplicación y luego puedo utilizarlos cuando esté disponible la versión 2.0.</p>
<p>Ya hemos visto varias formas de hacer los datos de una aplicación persistentes, mediante ficheros, en una unidad anterior. Ahora, en esta unidad, vamos a ver cómo pueden persistir los datos en una base de datos, explorando dos técnicas diferentes:</p>
<ul class="lista_verificacion">
<li>Almacenando los datos en una base de datos relacional.</li>
<li>Usando técnicas más avanzadas de persistencia de objetos.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.- Bases de datos relacionales</h1></div></div>
<div class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id119">
<div class="iDevice emphasis_casopracticofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id119-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta119_147" class="block iDevice_content">
<div class="exe-figure exe-image float-left license-gnu-gpl" style="width: 200px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/info-1641937.jpg" alt="Imagen que muestra el cabezal de un disco duro mágnetico." title="Disco duro magnético." style="float: left;" width="200" height="133">
<div class="figcaption"><a href="https://pixabay.com/es/photos/informaci%C3%B3n-datos-disco-servidor-1641937/" target="_blank" class="author">FreePhotosART</a> <span class="license"><span class="sep">(</span><a href="https://pixabay.com/es/service/license/" target="_blank">Pixabay License</a><span class="sep">)</span></span></div>
</div>
<p><strong><br>María</strong> y <strong>Juan</strong> han empezado a darle vueltas a la aplicación que quieren hacer para practicar, y lo primero que piensan es:</p>
<p>¿Dónde almacenaremos los datos de nuestro mini punto de venta?</p>
<p>Saben que la persistencia de los datos es sumamente importante y claro, tal y como ya aprendieron en el módulo de Bases de Datos, uno de los mecanismos más habituales es usar una <strong>Base de Datos relacional</strong>.</p>
<p>Diseñar una base de datos relacional de forma adecuada es importante, y requiere paciencia y técnica. Pero por ahora simplemente van a desarrollar una aplicación de prueba, para experimentar, así que aunque lo tienen en cuenta, tampoco lo van a tomar a rajatabla.</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id1">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id1-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta1_73" class="block iDevice_content">
<div class="elemento_derecha">
<div class="elemento_centrado" style="margin: 10px;"><a title="Haz clic para ampliar la imagen sobre la tabla de productos." href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/ejemplo_de_tabla_productos.png" target="_blank"><img alt="Tabla de una base de datos relacional destinada a almacenar una serie de productos." class="imagen_ampliable" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/ejemplo_de_tabla_productos_mini.png" title="Tabla de productos."></a>
<div class="figcaption"><span class="title"><em>Elaboración propia.&nbsp; Tabla de base de datos relacional que almacena productos.</em></span></div>
</div>
</div>
<p>Hoy en día, la mayoría de aplicaciones informáticas necesitan almacenar y gestionar gran cantidad de datos.</p>
<p>Esos datos, se suelen guardar en <strong>bases de datos relacionales</strong>, ya que éstas son las más extendidas actualmente.</p>
<p>Las bases de datos relacionales permiten organizar los datos en <strong>tablas</strong> y esas tablas y datos se relacionan mediante <strong>campos clave</strong>. Además se trabaja con el lenguaje estándar conocido como<strong> <acronym title="Structured Query Language" lang="en">SQL</acronym></strong>, para poder realizar las consultas que deseemos a la base de datos.</p>
<div class="destacado"><strong>Una base de datos relacional se puede definir de una manera simple como aquella que presenta la información en tablas con filas y columnas.</strong></div>
<p>Una <strong>tabla es una serie de filas y columnas</strong>, en la que <strong>cada fila es un registro</strong> y <strong>cada columna es un campo</strong>. Un <strong>campo</strong> representa un dato de los elementos almacenados en la tabla (nombre del producto, precio, código de barras<acronym title="Número de la Seguridad Social."></acronym>, <abbr title="etcétera.">etc.</abbr>). Cada registro, compuesto por tanto por varios campos, representa un elemento de la tabla (un modelo concreto de camiseta, un modelo concreto de pantalón, <abbr title="etcétera.">etc.</abbr>)</p>
<p><span>Desde un punto de vista formal, <strong>en una tabla no debería haber nunca dos registros iguales </strong>(no debería aparecer dos veces, por ejemplo, el mismo modelo de camiseta). Por ello, las tablas deben tener una</span> <a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#tc32fc751-a6af-b4d1-b78b-e5d7ea1de56d" id="linkc32fc751-a6af-b4d1-b78b-e5d7ea1de56d" class="exe-tooltip definition-tt titled-tt">clave primaria</a>. <strong><span class="resaltado_inline">La clave primaria estaría formada por uno o más campos cuyos valores no se pueden repetir en otras filas de la tabla</span></strong>. Ejemplos de claves primarias serían: código de barras para una tabla de productos, número de bastidor para una tabla de coches o número de la seguridad social para una tabla de personas.</p>
<p>El sistema gestor de bases de datos, en inglés conocido como: <strong><span lang="en">Database Management System</span> (<acronym title="Database Management System" lang="en">DBMS</acronym>)</strong>, gestiona el modo en que los datos se almacenan, mantienen y recuperan.</p>
<p>En el caso de una base de datos relacional, el sistema gestor de base de datos se denomina: <strong>Relational Database Management System (<acronym title="Relational Database Management System" lang="en">RDBMS</acronym>), </strong>que podríamos traducir por Sistema Gestor de Bases de Datos Relacionales.</p>
<p>Tradicionalmente, la programación de bases de datos ha sido como una Torre de Babel: gran cantidad de productos de bases de datos en el mercado, y cada uno "hablando" en su lenguaje privado con las aplicaciones.</p>
<p><span lang="en">Java</span>, mediante <acronym title="Java Database Connectivity" lang="en"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#tfd97e3ae-45f9-7c4d-c580-c48f2b70e6f2" id="linkfd97e3ae-45f9-7c4d-c580-c48f2b70e6f2" class="exe-tooltip definition-tt titled-tt">JDBC</a></acronym> (<strong><em><span lang="en">Java Database Connectivity</span></em></strong>), permite <strong>simplificar el acceso a base de datos relacionales</strong>, proporcionando un único mecanismo mediante el cual las aplicaciones pueden comunicarse con motores de bases de datos. La empresa <span lang="en">Sun</span> desarrolló esta&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym> para el acceso a bases de datos, con tres objetivos principales en mente:</p>
<ul class="lista_verificacion">
<li>Ser un&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym> con soporte de <acronym title="Structured Query Language." lang="en">SQL</acronym>: poder construir sentencias&nbsp;<acronym title="Structured Query Language" lang="en">SQL</acronym> e insertarlas dentro de llamadas a la&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym> de <span lang="en">Java</span>.</li>
<li>Aprovechar la experiencia de las <acronym title="Application Programming Interface." lang="en">API</acronym> de Bases de Datos existentes.</li>
<li>Ser sencillo.</li>
</ul>
<div id="tc32fc751-a6af-b4d1-b78b-e5d7ea1de56d" class="exe-tooltip-text">
<p>Es el atributo que se elige como identificador en una tabla, de manera que no haya dos registros iguales, sino que se diferencien al menos en esa clave. Por ejemplo, en el caso de una tabla que guarda datos de personas, el número de la seguridad social, podría elegirse como clave primaria, ya que aunque haya dos personas que se llamen igual, (por ejemplo, dos Juan Pérez Pérez), tenemos la certeza de que su número de seguridad social será distinto.</p>
</div>
<div id="tfd97e3ae-45f9-7c4d-c580-c48f2b70e6f2" class="exe-tooltip-text">
<p><span title="Application Programming Interface" lang="en">API</span> que permite la ejecución de operaciones sobre bases de datos desde el lenguaje de programación <span lang="en">Java</span>, independientemente del sistema operativo donde se ejecute o de la base de datos a la cual se accede.</p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id2">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id2-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta2_54" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b2" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b2" class="block iDevice_content">
<p><strong><acronym title="Java Database Connectivity." lang="en">JDBC</acronym> permite acceder a bases de datos relacionales cuando programamos con <span lang="en">Java</span>, pudiendo así utilizar <acronym title="Structured Query Languaje." lang="en">SQL</acronym>.</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b2"><input type="radio" name="option0b2" id="true0b2" class="exe-radio-option exe-radio-option-0-2-0b2-truefalse"> Verdadero</label> 
<label for="false0b2"><input type="radio" name="option0b2" id="false0b2" class="exe-radio-option exe-radio-option-1-2-0b2-truefalse"> Falso</label>
</p>
</form>
<div id="s0b2" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b2-result" class="right">Verdadero</strong></p>
<p><acronym title="Java Database Connectivity" lang="en">JBDC</acronym> sirve para acceder a bases de datos relacionales con <span lang="en">Java</span>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id3">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id3-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta3_47" class="block iDevice_content">
<p>Si necesitas refrescar o simplemente aprender el concepto de clave primaria, en la Wikipedia puedes consultarlo.</p>
<div class="enlace_centrado"><a class="html" title="Acceder a la definición de clave primaria en Wikipedia. (Se abre en una nueva ventana)" href="http://es.wikipedia.org/wiki/Clave_primaria" target="_blank"> Clave primaria.</a></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.1.- El desfase objeto-relacional</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id4">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id4-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta4_73" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/problem-860227_640.jpg" alt="Imagen que muestra dos figuras de madera con un problema por resolver." title="Problema por resolver." style="float: right;" width="250" height="188">
<div class="figcaption"><a href="https://pixabay.com/es/photos/problema-pregunta-soluci%C3%B3n-860227/" target="_blank" class="author" title="Acceder a la imagen  " problema="" por="" resolver",="" de="" "succco",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">succo </a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>El <strong>desfase objeto-relacional</strong>, también conocido como<strong> impedancia objeto-relacional</strong>, consiste en la diferencia de aspectos que existen entre la programación orientada a objetos y la base de datos. Estos aspectos se puede presentar en cuestiones como:</p>
<ul class="lista_verificacion">
<li><strong>Lenguaje de programación:&nbsp;</strong>el programador debe conocer el lenguaje de programación orientada a objetos (<acronym title="Programación Orientada a Objetos.">POO</acronym>) y el lenguaje de acceso a datos.</li>
<li><strong>Tipos de datos:</strong> en las bases de datos relacionales siempre hay restricciones en cuanto a los tipos de datos que se pueden usar, que suelen ser sencillos, mientras que la programación orientada a objetos utiliza tipos de datos más complejos.</li>
<li><strong><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#tff0a115c-6d7c-3a15-1ff5-e070820761e4" id="linkff0a115c-6d7c-3a15-1ff5-e070820761e4" class="exe-tooltip definition-tt titled-tt">Paradigma</a> de programación:</strong> en el proceso de diseño y construcción del <span lang="en">software</span> se tiene que hacer una traducción del modelo orientado a objetos de clases al<strong> modelo Entidad-Relación (<acronym title="Entidad Relación.">E/R</acronym>)</strong> puesto que el primero maneja objetos y el segundo maneja tablas y tuplas o filas, lo que implica que se tengan que diseñar dos diagramas diferentes para el diseño de la aplicación.</li>
</ul>
<p>El modelo relacional trata con relaciones y conjuntos debido a su <strong>naturaleza matemática</strong>. Sin embargo, el modelo de Programación Orientada a Objetos trata con objetos y las asociaciones entre ellos. Por esta razón, el problema entre estos dos modelos surge en el momento de querer hacer persistentes en la base de datos los objetos de negocio que maneja la aplicación.</p>
<p>La escritura (y de manera similar la lectura) mediante <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> implica: abrir una conexión, crear una sentencia en <acronym title="Structured Query Language." lang="en">SQL</acronym> y copiar todos los valores de las propiedades o atributos de un objeto en la sentencia, ejecutarla y así almacenar el objeto. Esto es sencillo para un caso simple, pero trabajoso si el objeto posee muchas propiedades, o bien si se necesita almacenar un objeto que a su vez posee una colección de otros elementos que también son objetos. Se necesita crear mucho más código, además del tedioso trabajo de creación de sentencias <acronym title="Strtuctured Query Language." lang="en">SQL</acronym>.</p>
<p>Este problema es lo que denominábamos <strong>impedancia </strong><strong>Objeto-Relacional</strong>, o sea, el conjunto de dificultades técnicas que surgen cuando una base de datos relacional se usa en asociación con un programa escrito en un lenguajes de Programación Orientada a Objetos.</p>
<p>Podemos poner como ejemplo de desfase objeto-relacional, un equipo de fútbol, que tenga un atributo que sea una colección de objetos de la clase Jugador. Cada jugador tiene un atributo "teléfono". Al transformar este caso a relacional se ocuparía más de una tabla para almacenar la información, implicando varias sentencias <acronym title="Strtuctured Query Language." lang="en">SQL</acronym> y bastante código.</p>
<div id="tff0a115c-6d7c-3a15-1ff5-e070820761e4" class="exe-tooltip-text">
<p>Es una propuesta tecnológica, un modelo, que se adopta por una comunidad de programadores que unívocamente trata de resolver uno o varios problemas claramente delimitados. Tiene una estrecha relación con la formalización de determinados lenguajes en su momento de definición. Un paradigma de programación está delimitado en el tiempo en cuanto a aceptación y uso, ya que nuevos paradigmas aportan nuevas o mejores soluciones que sustituyen esa propuesta tecnológica parcial o totalmente.</p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id5">
<div class="iDevice emphasis_debesconocerfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id5-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta5_48" class="block iDevice_content">
<p>Si no has estudiado nunca bases de datos, ni tienes idea de qué es <acronym title="Strtuctured Query Language." lang="en">SQL</acronym> o el modelo relacional, sería conveniente que te familiarizaras con él. A continuación te indicamos un tutorial bastante ameno sobre <acronym title="Strtuctured Query Language." lang="en">SQL</acronym> y&nbsp; que describe brevemente el modelo relacional.</p>
<div class="enlace_centrado"><a class="html" title="Acceder al tutorial de SQL en Aula clic. (Se abre en una nueva ventana)" href="http://www.aulaclic.es/sql/" target="_blank"> Tutorial SQL.</a></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.2.- JDBC</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id6">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id6-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta6_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-pd" style="width: 200px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/PROG11_CONT_R04_jdbc.JPG" width="200" height="120" alt="Rectángulo amarillo donde se pueden leer las palabras jdbc-odbc." title="JDBC - ODBC" style="float: right;"><figcaption class="figcaption"><span class="author">Elaboración propia.</span> <span class="license"><span class="sep">(</span><span>Dominio público</span><span class="sep">)</span></span></figcaption></figure>
<div>
<div>Ha llegado el momento de profundizar en&nbsp;<acronym title="Java Database Connectivity." lang="en">JDBC</acronym> para empezar a persistir datos de nuestra aplicación, ¿crees que serás capaz de usarlo?</div>
<div></div>
<div>Seguro que sí. Como ya se comentó en apartados anteriores, <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> es una <acronym title="Application Programming Interface." lang="en">API</acronym> <span lang="en">Java</span> que hace posible ejecutar sentencias&nbsp;<acronym title="Strtuctured Query Language." lang="en">SQL</acronym> en cualquier base de datos relacional.&nbsp;De&nbsp;<acronym title="Java Database Connectivity." lang="en">JDBC</acronym> podemos decir que:</div>
<ul class="lista_verificacion">
<li>Consta de un <strong>conjunto de clases e interfaces</strong> escritas en <span lang="en">Java</span>.</li>
<li>Proporciona un <acronym title="Application Programming Interface." lang="en">API</acronym> estándar para desarrollar aplicaciones que usen bases de datos. De esa forma, siempre usarás las mismas clases y métodos para almacenar datos en la base de datos, independientemente de la base de datos.</li>
</ul>
<p><span><strong>Con <acronym title="Java Database Connectivity." lang="en">JDBC</acronym></strong>, no hay que usar mecanismos diferentes para almacenar datos en una base de datos <strong><span lang="en">Access</span></strong>, o para almacenar datos en una base de datos<strong> <span lang="en">Oracle</span></strong>, <abbr title="etcétera.">etc.</abbr>, sino que <strong>podemos hacer uso del mismo conjunto de técnicas para usar cualquier base de datos relacional.</strong> Gracias a la&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym> <acronym title="Java Database Connectivity." lang="en">JDBC</acronym>, ejecutar consultas <acronym title="Strtuctured Query Language." lang="en">SQL</acronym> en una base de datos o en otra será algo transparente para el programador.</span></p>
<p>Cuando se desarrolló&nbsp;<acronym title="Java Database Connectivity." lang="en">JDBC</acronym>, y debido a la confusión que hubo por la proliferación de&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym> propietarias de acceso a datos, <span lang="en">Sun </span>buscó los aspectos de éxito de una&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym> de este tipo, y el ejemplo a seguir fue <a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#t63986200-6f17-5a53-980e-21730737a74f" id="link63986200-6f17-5a53-980e-21730737a74f" class="exe-tooltip definition-tt titled-tt">ODBC</a> (<span lang="en">Open Database Connectivity</span>).</p>
<p><acronym title="Open Database Connectivity." lang="en">ODBC</acronym> se desarrolló con la idea de tener un estándar para el acceso a bases de datos en entornos <span lang="en">Windows</span>. Aunque la industria ha aceptado&nbsp;<acronym title="Open Database Connectivity." lang="en">ODBC</acronym> como medio principal para acceso a bases de datos en<span lang="en"> Windows</span>,&nbsp;<acronym title="Open Database Connectivity." lang="en">ODBC</acronym> no se adapta bien en el mundo <span lang="en">Java</span>, debido a la complejidad que presenta. Factor que junto a otras cosas ha impedido su transición fuera de entornos <span lang="en">Windows</span>.</p>
<p>El <strong><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#t8359949a-2ee7-f937-6cda-0e28bc44a6ae" id="link8359949a-2ee7-f937-6cda-0e28bc44a6ae" class="exe-tooltip definition-tt titled-tt">nivel de abstracción</a> </strong>al que trabaja&nbsp;&nbsp;<acronym title="Java Database Connectivity." lang="en">JDBC</acronym> es alto en comparación con <acronym title="Open Database Connectivity." lang="en">ODBC</acronym>, la intención de <span lang="en">Sun </span>fue que supusiera la base de partida para crear librerías de más alto nivel.</p>
<p><acronym title="Java Database Connectivity." lang="en">JDBC</acronym>&nbsp;intenta ser tan simple como sea posible, pero proporcionando a los desarrolladores la máxima flexibilidad.</p>
</div>
<div id="t63986200-6f17-5a53-980e-21730737a74f" class="exe-tooltip-text">
<p>Es una <acronym title="Application Programming Interface" lang="en">API</acronym> de acceso a datos, desarrollado por <span lang="en">Microsoft</span>, con la idea de tener un estándar para el acceso a bases de datos en entornos <span lang="en">Windows</span>.</p>
</div>
<div id="t8359949a-2ee7-f937-6cda-0e28bc44a6ae" class="exe-tooltip-text">
<p>Uno de los objetivos fundamentales de una base de datos es proporcionar a los usuarios una visión abstracta de los datos. Es decir, el sistema oculta ciertos detalles relativos a la forma en que se almacenan y mantienen los datos. Esto se logra definiendo tres niveles de abstracción en los que puede considerarse la base de datos: físico, conceptual y de visión.</p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id7">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id7-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta7_54" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b7" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b7" class="block iDevice_content">
<p><strong> <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> es la versión de <acronym title="Open Database Connectivity." lang="en">ODBC</acronym> para<span lang="en"> Linux</span>.</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b7"><input type="radio" name="option0b7" id="true0b7" class="exe-radio-option exe-radio-option-0-2-0b7-truefalse"> Verdadero</label> 
<label for="false0b7"><input type="radio" name="option0b7" id="false0b7" class="exe-radio-option exe-radio-option-1-2-0b7-truefalse"> Falso</label>
</p>
</form>
<div id="s0b7" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b7-result" class="wrong">Falso</strong></p>
<p><acronym title="Open Database Connectivity." lang="en">ODBC</acronym> se desarrolló para ser un estándar para el acceso a bases de datos en entornos <span lang="en">Windows</span>, y <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> pretendió recoger esta idea para construir una&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym> genérica independiente de la plataforma.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.3.-  Conectores o Drivers</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id8">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id8-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta8_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-pd" style="width: 152px;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/PROG11_CONT_R05_01_esquemabc.JPG" title="Ampliar imagen " esquema="" jdbc".="" (se="" abre="" en="" una="" nueva="" ventana)"="" target="_blank"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/PROG11_CONT_R05_01_esquemabc_miniatura.JPG" alt="Dos rectángulos en la parte superior que ponen aplicación 1 y aplicación 2. Sendas flechas bidireccionales verticales desde los rectángulos a un rectángulo grande, más abajo, que pone JDBC. Tres flechas bidireccionales más abajo que van hasta tres cilindros que ponen cada uno: MySQL, Oracle, SyBase" title="Esquema JDBC" class="imagen_ampliable" style="float: right;" width="152" height="192"></a><figcaption class="figcaption"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/PROG11_CONT_R05_01_esquemabc.JPG" title="Ampliar imagen " esquema="" jdbc".="" (se="" abre="" en="" una="" nueva="" ventana)"="" target="_blank"><span class="author">Elaboración propia.</span> <span class="license"><span class="sep">(</span><span>Dominio público</span><span class="sep">)</span></span></a></figcaption></figure>
<p><br>La&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym> <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> viene distribuida en dos paquetes dentro de <span lang="en">Java <acronym title="Standard Edition" lang="en">SE</acronym></span>:</p>
<ul class="lista_verificacion">
<li><span>java.sql, contiene las clases e interfaces principales de la&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym>, y su propósito es facilitar el acceso y procesamiento de datos provenientes de diversas fuentes (generalmente bases de datos relacionales).</span></li>
<li><span>javax.sql, contiene clases que complementan a las incluidas en java.sql, y aunque está destinado a facilitar el acceso a fuentes de datos en el entorno de servidor, está incluido en Java <span> <acronym title="Standard Edition" lang="en">SE</acronym></span> desde la versión 1.4.</span></li>
</ul>
<p>Aunque <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> contiene un buen conjunto de clases, este no es suficiente para poder conectarse y usar una base de datos relacional. Para conectarnos a una base de datos específica, <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> necesita un <strong>conector o <span lang="en">driver</span></strong> adicional.&nbsp;<acronym title="Java Database Connectivity." lang="en">JDBC</acronym> es a su vez una especificación que indica cómo debe implementarse dicho conector.</p>
<p><span class="destacado_inline"><strong>Un conector&nbsp;<span><acronym title="Java Database Connectivity." lang="en">JDBC</acronym> </span><span lang="en"> </span>es un conjunto de clases que implementan las interfaces de la&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym> <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> necesarias para conectar a una base de datos específica</strong></span>.</p>
<p><strong><span class="resaltado_inline">La función del conector es permitir el acceso y la comunicación con el motor de base de datos</span></strong>.</p>
<p>El conector es generalmente implementado por el fabricante del <acronym title="Sistema Gestor de Bases de Datos" lang="es">SGBD</acronym> y consta de una o más librerías java (archivos .jar) que deberemos incorporar a nuestro proyecto.</p>
<p>Cuando se construye una aplicación que accede a una <del></del>base de datos,&nbsp;<strong><acronym title="Java Database Connectivity." lang="en">JDBC</acronym> oculta los detalles específicos de cada base de datos</strong>, de modo que al programar nos debemos preocupar <del></del>sólo de nuestra aplicación.</p>
<p>Por tanto, aunque el código de nuestra aplicación no depende del <span lang="en">driver</span> o conector, puesto que trabajaremos directamente con los paquetes java.sql y <code>javax.sql</code>, para ejecutar nuestra aplicación y que esta pueda conectarse y usar la base de datos, sí que vamos a necesitar el conector que nos proporcionará el fabricante.</p>
<p>Como se verá más adelante, de cara al desarrollo de nuestra aplicación, <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> nos ofrece clases e interfaces para:</p>
<ul class="lista_verificacion">
<li>Establecer una conexión a una base de datos.</li>
<li>Ejecutar una consulta.</li>
<li>Procesar los resultados.</li>
</ul>
<p>Vamos a ver un pequeño ejemplo de las clases que tendríamos que usar para ejecutar una consulta usando <acronym title="Java Database Connectivity." lang="en">JDBC</acronym>, échale un vistazo al código, no te preocupes si todavía no lo entiendes todo, más adelante veremos algunas cosas en mayor profundidad:</p>
<div class="highlighted-code language-java line-numbers">
<div>
<pre class="line-numbers">        //URL de conexión
        String connectionURL = "jdbc:h2:./minipos.h2db;MODE=MySQL;AUTO_RECONNECT=TRUE";
        //Usuario para conectar a la base de datos (rellenar si es necesario).
        String usuario = "";
        //Contraseña para conectar a la base de datos (rellenar si es necesario).
        String password = "";

        //Paso 1: conectamos con la base de datos
        try ( Connection con = DriverManager.getConnection(connectionURL, usuario, password)) {

            //Paso 2: crear y ejecutar una consulta
            try ( Statement consulta = con.createStatement()) {
                if (consulta.execute("SELECT id,nombre,precio FROM producto")) {
                    ResultSet resultados = consulta.getResultSet();
                    while (resultados.next()) {
                        long id = resultados.getLong("id");
                        String nombre = resultados.getString("nombre");
                        double precio = resultados.getDouble("precio");
                        System.out.printf("%5d %-15s %10.2f\n", id, nombre, precio);
                    }
                }
            } catch (SQLException ex) {
                System.err.printf("Se ha producido un error al ejecutar la consulta SQL.");
            }

        } catch (SQLException ex) {
            System.err.printf("No se pudo conectar a la base de datos (%s)\n");
        }</pre>
</div>
</div>
<p>En principio, todos los conectores deben ser compatibles con <acronym title="American National Standards Institute." lang="en">ANSI</acronym> <acronym title="Structured Query Language." lang="en">SQL</acronym>-2 <span lang="en">Entry Level</span> (<acronym title="American National Standards Institute." lang="en">ANSI</acronym> <acronym title="Structured Query Language." lang="en">SQL</acronym>-2 se refiere a los estándares adoptados por el <strong><span lang="en">American National Standards Institute</span></strong> (<acronym title="American National Standards Institute." lang="en">ANSI</acronym>) en 1992. <span lang="en">Entry Level</span> se refiere a una lista específica de capacidades de <acronym title="Structured Query Language." lang="en">SQL</acronym>). Los desarrolladores de conectores pueden establecer que sus conectores conocen estos estándares.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id9">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id9-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta9_47" class="block iDevice_content">
<p>Si necesitas acceder a una base de datos con Java, necesitas un controlador o <span lang="en">driver</span> <span title="Java Data Base Conectivity" lang="en">JDBC</span>. Esta es una lista de los controladores disponibles, a qué base de datos pueden acceder, y quién la crea.</p>
<div class="enlace_centrado"><a class="html" title="Acceder a una web con un listado de conectores JDBC. (Se abre en una nueva v ventana)" href="http://www.devx.com/tips/Tip/28818" target="_blank"> Conectores <acronym title="Java Database Connectivity" lang="en">JDBC</acronym></a></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.4.- Instalación de la base de datos</h1></div></div>
<div class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id123">
<div class="iDevice emphasis_casopracticofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id123-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta123_147" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-copyright" style="width: 200px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/CASO_PERSONAJES_04.jpg" alt="Foto de Juan mirando al frente." title="Juan" style="float: right;" width="200" height="134">
<div class="figcaption"><span class="author">Ministerio de Educación. Uso educativo-nc. Elaboración propia.</span> <span class="license"><span class="sep">(</span><span>Todos los derechos reservados</span><span class="sep">)</span></span></div>
</div>
<p><strong>María</strong> y <strong>Juan</strong> tienen claro que los datos de la aplicación que tendrán que programar deberán almacenarse en una base de datos. En su proyecto de prueba han estado valorando diferentes sistemas gestores de bases de datos, cada uno por su cuenta, y ahora, van a ponerlos en común:</p>
<p>—<strong>Juan</strong>, he estado mirando diferentes opciones para nuestro proyecto de prueba <span>—</span>comenta <strong>María</strong>—. Podríamos utilizar alguna base de datos de las que ya hemos visto en el ciclo. ¿Qué piensas de <span lang="en">MySQ</span>L o <span lang="en">PostgreSQL</span>?</p>
<p><span>—</span>Yo he valorado también esas dos bases de datos, pero después de darle vueltas al asunto, pienso que instalar un sistema gestor de base de datos para realizar un proyecto de prueba es excesivo. Tampoco sabemos que base de datos utilizaremos finalmente <span>—</span>responde <strong>Juan</strong>.</p>
<p><span>—</span>¿Y qué solución propones entonces?</p>
<p>—No lo sé, creo que quizás sería mejor preguntarle a <strong>Ada</strong>, a lo mejor ella nos puede orientar.</p>
<p>Después de un ratito hablando con <strong>Ada</strong> tienen las cosas más claras. Les ha propuesto que utilicen <strong>H2</strong> para realizar su proyecto de prueba, una base de datos muy ligera que se usa principalmente a la hora de desarrollar. Pero eso sí, deben tener en mente que el proyecto del cliente se hará sobre <strong><span lang="en">MySQL</span></strong>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id10">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id10-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta10_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-pd" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/database-schema-1895779_640.png" alt="Esquema de base de datos de varias tablas" title="Esquema de Base de Datos" style="float: right;" width="229" height="200"><figcaption class="figcaption"><a href="https://pixabay.com/es/vectors/esquema-base-de-datos-tablas-de-datos-1895779/" target="_blank" class="author" title="Acceder a la imagen  " esquema="" de="" base="" datos",="" "mcmurryjulie",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">mcmurryjulie</a> <span class="license"><span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank"><span>Licencia Pixabay</span></a><span class="sep">)</span></span></figcaption></figure>
<p align="justify">¿Qué es lo primero que tenemos que hacer, para poder realizar consultas en una base de datos?</p>
<p align="justify">Obviamente, instalar la base de datos.</p>
<p align="justify">Dada la cantidad de productos de este tipo que hay en el mercado, es imposible explicar la instalación de todas. Así que vamos a optar por una, en concreto por <span lang="en">MySQL,</span> ya que es un sistema gestor de base de datos gratuito y que funciona en varias plataformas.</p>
<p align="justify">Para instalar <span lang="en">MySQL</span> en <span lang="en">Windows</span> puedes seguir los pasos que te detallamos en la siguiente presentación, descargando el instalador de la página oficial:</p>
<p style="text-align: center;" align="justify">&nbsp;<a class="html" title="Descargar instalador mysql (Se abre en una ventana nueva)" href="https://dev.mysql.com/downloads/installer/" target="_blank">https://dev.mysql.com/downloads/installer/</a>:</p>
<p style="text-align: center;" align="justify"><span class="external-iframe-src" style="display:none"><a href="http://www.youtube.com/embed/ZC1gRVdeaxg">http://www.youtube.com/embed/ZC1gRVdeaxg</a></span><iframe width="320" height="240" style="font-size: 1em;" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/ZC1gRVdeaxg.html" play="false" scale="exactfit" frameborder="0" class="external-iframe"></iframe></p>
<div class="elemento_centrado">
<div class="credenciales elemento_centrado"><a title="Acceder al resumen textual alternativo para " instalar="" mysql"="" (se="" abre="" en="" una="" nueva="" ventana)"="" href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/PROG11_Descripcion_Presentacion_Instalar_MYSQL.html" target="_blank">Resumen textual alternativo para Instalar MySQL</a></div>
</div>
<p></p>
<p>Si utilizas <span lang="en">Linux</span>, el sitio de descarga es el mismo que el indicado en la presentación anterior, y la instalación la puedes hacer con los pasos que te indican en el enlace siguiente:</p>
<div class="enlace_centrado"><a class="html" title="Acceder a una web con información sobre instalación de  MySQL en Linux. (Se abre en una nueva ventana)" href="http://www.alcancelibre.org/staticpages/index.php/como-mysql-quickstart" target="_blank"> Instalar <span lang="en">MySQL</span> en Linux.</a></div>
</div>
</div>
</div>
<div class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id174">
<div class="iDevice emphasis_debesconocerfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id174-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta174_129" class="block iDevice_content">
<p>Aparte de <span lang="en">MySQL</span>, también te proponemos probar con una base de datos que no necesita instalación. Se trata de <strong>H2</strong> y es una base de datos relacional embebida compatible con <span lang="en">MySQL</span>. ¿Y eso que quiere decir? Quiere decir que lo único que hay que hacer para utilizar H2 es añadir a nuestro proyecto la librería de H2 (archivo .jar), no requiere por tanto instalación dado que la librería va incorporada en nuestro mismo código:</p>
<p style="text-align: center;"><a href="http://www.h2database.com/html/download.html" title="Haz clic para acceder a la página de descargas de la base de datos embebida H2. (Se abre en una nueva ventana)" target="_blank" class="html">Página de descargas de H2.</a></p>
<p>En la página anterior encontrarás muchas descargas, pero la única que realmente necesitarás será el archivo&nbsp;.jar (<em></em><span lang="en"><em><span lang="en">Jar File</span></em></span>). H2 es <span lang="en">software</span> libre y es una base de datos ligera muy usada en la fase de desarrollo. Cuando ya se tiene un producto viable, normalmente se sustituye por una base de datos más potente. A continuación tienes un proyecto base para <span lang="en">NetBeans</span> que ya incorpora H2, listo para usar.</p>
<p style="text-align: center;"><span><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/UT10_ProyectoBaseH2.zip" title="Haz clic aquí para descargar proyecto base que utiliza H2.  Se abre en una nueva ventana [zip - 2249572 B]" target="_blank" class="paquete"><span>Proyecto base para NetBeans que utiliza H2</span></a><span class="exe-link-data file-size"> (zip - 2249572 <abbr title="Bytes" lang="en">B</abbr>)</span>.</span></p>
<p style="text-align: left;">Si abres el proyecto anterior, verás que incluye código para crear la estructura de la base de datos y un ejemplo de consulta visto en apartados anteriores.</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id12">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id12-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta12_47" class="block iDevice_content">
<p>De <span lang="en">MySQL</span> se escindieron otras bases de datos, como <span lang="en">MariaDB</span> y <span lang="en">Percona</span>, que cada vez están teniendo mayor número de seguidores.</p>
<p>En el siguiente enlace puedes obtener información sobre <span lang="en">MariaDB</span></p>
<div class="enlace_centrado"><a class="html" title="Acceder a un artículo web sobre la historia de MariaDB.  (Se abre en una nueva ventana)" href="https://es.wikipedia.org/wiki/MariaDB" target="_blank"> MariaDB.</a></div>
<div class="enlace_centrado" style="text-align: left;">Sobre <span lang="en">Percona</span>, aunque está en inglés, puedes ver en este artículo de hace unos años que lanzó su base de datos con prestaciones verdaderamente competentes respecto a los productos de <span lang="en">Oracle</span>:</div>
<div class="enlace_centrado" style="text-align: center;"><a class="html" title="Acceder a un artículo web: Percona desafía a Oracle. (En inglés) (Se abre en una nueva ventana)" href="http://www.pcworld.com/article/2054060/percona-challenges-oracle-with-alternate-mysql-release.html" target="_blank">Percona desafía a Oracle.</a></div>
<div class="enlace_centrado" style="text-align: left;">&nbsp;</div>
<div class="enlace_centrado" style="text-align: left;">Aquí puedes ver un mapa de las bifurcaciones de <span lang="en">MySQL</span></div>
<div class="enlace_centrado" style="text-align: center;">
<div class="exe-figure exe-image position-center license-copyright" style="width: 200px;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/esquemaBdsMariaMysPErc.png" target="_blank"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquemaBdsMariaMysPErc_mini.png" alt="Mapa resumen" title="Mapa resumen" class="imagen_ampliable" width="200" height="125"></a>
<div class="figcaption"><a href="https://www.slideshare.net/neoclova?utm_campaign=profiletracking&amp;utm_medium=sssite&amp;utm_source=ssslideview" target="_blank" class="author">NeoClova</a> Copyright <span class="license"><span class="sep">(cita</span><span class="sep">)</span></span></div>
</div>
<span lang="en"></span></div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id11">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id11-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta11_54" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b11" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b11" class="block iDevice_content">
<p><strong>Para programar accesos a <span lang="en">MySQL</span> hay que tener el <span lang="en">driver</span> <acronym title="Java Database Connectivity." lang="en"><span lang="en">JDBC</span></acronym> para <span lang="en">MySQL</span> en nuestra aplicación.</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b11"><input type="radio" name="option0b11" id="true0b11" class="exe-radio-option exe-radio-option-0-2-0b11-truefalse"> Verdadero</label> 
<label for="false0b11"><input type="radio" name="option0b11" id="false0b11" class="exe-radio-option exe-radio-option-1-2-0b11-truefalse"> Falso</label>
</p>
</form>
<div id="s0b11" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b11-result" class="right">Verdadero</strong></p>
<p>De no ser así será imposible conectarnos a la base de datos.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.5.- Creación de las tablas en una base de datos</h1></div></div>
<div class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id13">
<div class="iDevice emphasis_casopracticofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id13-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta13_66" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-pd" style="width: 200px;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/esquema0.png" target="_blank"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema0_mini.png" alt="Imagen que muestra el esquema entidad-relación de la base de datos que María y Juan están diseñando a modo de pruebas. En la imagen se ve como el esquema incluye tres enteidades, producto, ticket y línea de ticket. También se ve como línea de ticket está relacionado con producto y ticket, y los atributos que contiene cada entidad." title="Esquema entidad-relación de la base de datos de pruebas" class="imagen_ampliable" style="float: right;" width="200" height="140"></a>
<div class="figcaption"><span class="author">Elaboración propia. (Dominio público)</span><span class="license"><span><br></span></span></div>
</div>
<p><strong><br>María</strong> y <strong>Juan</strong> han realizado el diseño de las tablas que necesitan para la base de datos del mini punto de venta. De momento incluye solo tres tablas: producto, ticket y línea de ticket; con unos pocos atributos, pero piensan hacerlo evolucionar. El aspecto que tiene ahora mismo es el que se muestra en el esquema entidad-relación de la derecha.</p>
<p>También han decidido utilizar H2 como sistema gestor de bases de datos para las pruebas, con la mente puesta en que luego tendrán que usar <span lang="en">MySQL</span>.</p>
<p>Saben que H2 es un sistema gestor de bases de datos relacional. Una vez instalado, tendrán que programar los accesos a la base de datos para guardar los datos, recuperarlos, realizar las consultas para los informes y documentos que sean necesarios,<abbr title="etcétera."> etc.</abbr></p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id14">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id14-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta14_73" class="block iDevice_content">
<div class="exe-figure exe-image float-left license-copyright" style="width: 200px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/BasesDeDatos.1.png" alt="Ilustración de un archivador con cajones con forma cilíndrica con el texto Bases de Datos en la cara superior." title="Bases de Datos." style="float: left;" width="200" height="150">
<div class="figcaption"><a href="https://pixabay.com/es/illustrations/big-data-base-de-datos-almacenar-2103091/" target="_blank" class="author">daniel_diaz_bardillo</a> <span class="license"><span class="sep">(</span><span>Pixabay License</span><span class="sep">)</span></span></div>
</div>
<p><br>En <span lang="en">Java</span> podemos conectarnos y manipular bases de datos utilizando <acronym title="Java Database Connectivity." lang="en">JDBC</acronym>. Pero la creación en sí de la estructura de la base de datos normalmente es necesario hacerla con una herramienta específica para ello. Normalmente será el administrador o la administradora de la base de datos, a través de las herramientas que proporcionan el sistema gestor, quien creará la base de datos. No todos los <span lang="en">drivers</span> <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> soportan la creación de la base de datos mediante el lenguaje de definición de datos (<strong><abbr title="Data Definition Language." lang="en">DDL</abbr></strong>).</p>
<p>Normalmente, cualquier sistema gestor de bases de datos incluye asistentes gráficos para crear la base de datos con sus tablas, <a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#t3cfbcb93-460d-5679-b67e-a09bf3beaf29" id="link3cfbcb93-460d-5679-b67e-a09bf3beaf29" class="exe-tooltip definition-tt titled-tt">claves</a>, y todo lo necesario.</p>
<p>También, como en el caso de <span lang="en">MySQL</span>, o de<span lang="en"> Oracle</span>, y la mayoría de sistemas gestores de bases de datos, se puede crear la base de datos, desde la <a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#t75b4ab11-3a1a-cf08-ba41-e95974508ed3" id="link75b4ab11-3a1a-cf08-ba41-e95974508ed3" class="exe-tooltip definition-tt titled-tt">línea de comandos</a> de <span lang="en">MySQL</span> o de <span lang="en">Oracle</span>, con las sentencias <acronym title="Structured Query Language." lang="en">SQL</acronym> apropiadas.</p>
<p>Vamos utilizar el sistema gestor de base de datos <span lang="en">MySQL</span>, por ser un producto gratuito y de fácil uso, además de muy potente. También vamos a utilizar la base de datos H2 por ser <span lang="en">software</span> libre y compatible con <span lang="en">MySQL</span>.</p>
<div id="t3cfbcb93-460d-5679-b67e-a09bf3beaf29" class="exe-tooltip-text">
<p>Una clave consiste en un subconjunto del conjunto de atributos comunes en una colección de entidades, que permite identificar unívocamente cada una de las entidades pertenecientes a dicha colección.</p>
</div>
<div id="t75b4ab11-3a1a-cf08-ba41-e95974508ed3" class="exe-tooltip-text">
<p>Es un método que permite a los usuarios dar instrucciones a algún programa informático por medio de una línea de texto simple.</p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id15">
<div class="iDevice emphasis_debesconocerfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id15-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta15_48" class="block iDevice_content">
<p>Una de las herramientas más usadas para crear esquemas de bases de datos en <span lang="en">MySQL</span> es <span lang="en">MySQL WorkBench. En la siguiente presentación puedes ver como se crearía con MySQL WorkBench una tabla llamada </span>clientes:</p>
<div class="elemento_centrado">
<div class="elemento_centrado"><span class="external-iframe-src" style="display:none"><a href="http://www.youtube.com/embed/bBxuxZpB_yk">http://www.youtube.com/embed/bBxuxZpB_yk</a></span><iframe width="320" height="240" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/bBxuxZpB_yk.html" play="false" scale="exactfit" frameborder="0" class="external-iframe"></iframe></div>
<div class="credenciales elemento_centrado"><a title="Acceder al resumen textual alternativo para " crear="" tabla="" mysql"="" (se="" abre="" en="" una="" nueva="" ventana)"="" href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/PROG11_Descripcion_Presentacion_Crear_Tabla.html" target="_blank">Resumen textual alternativo para "Crear tablas con <span lang="en">MySQL</span>"</a></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id125">
<div class="iDevice emphasis_debesconocerfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id125-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta125_129" class="block iDevice_content">
<p>Aunque en H2 puedes crear las tablas desde <acronym title="Java Database Connectivity." lang="en">JDBC</acronym>, si lo necesitas H2 dispone de una consola web donde ejecutar sentencias <acronym title="Structured Query Language" lang="en">SQL</acronym>. En el siguiente documento puedes ver cómo arrancar dicha consola, es muy sencillo:</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/AbrirConsolaH2.pdf" title="Descargar el resumen de cómo iniciar la consola H2.  Se abre en una nueva ventana [pdf - 58.25 KB]" target="_blank" class="pdf">Resumen de como iniciar la consola de H2</a><span class="exe-link-data file-size"> (pdf - 58.25 <abbr title="KiloBytes" lang="en">KB</abbr>)</span>.</p>
<p style="text-align: left;">No obstante, en el proyecto base expuesto en apartados anteriores, puedes ver como se pueden crear tablas desde H2.</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id16">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id16-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta16_47" class="block iDevice_content">
<p>Aquí puedes ver un vídeo sobre la instalación de la base de datos <span lang="en">Oracle Express</span> y creación de tablas.</p>
<div class="elemento_centrado">
<div class="elemento_centrado"><span class="external-iframe-src" style="display:none"><a href="https://www.youtube-nocookie.com/embed/H8KiNPpq73o">https://www.youtube-nocookie.com/embed/H8KiNPpq73o</a></span><iframe width="300" height="200" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/H8KiNPpq73o.html" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen="" class="external-iframe"></iframe></div>
<div class="credenciales elemento_centrado"><a title="Acceder al resumen textual alternativo para " instalar="" oracle="" express="" y="" crear="" tablas."="" (se="" abre="" en="" una="" nueva="" ventana)"="" href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/PROG11_Descripcion_Video_Inst_Oracle_Crear_Tablas.html" target="_blank">Resumen textual alternativo para para "Instalar <span lang="en">Oracle Express</span> y crear tablas."</a></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.5.1.- Lenguaje SQL (I)</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id177">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id177-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta177_154" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-CC-BY-NC-SA" style="width: 136px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/PROG11_CONT_R10_SQLFundamental.jpg" alt="Libro SQL" title="Libro SQL" style="float: right;" width="136" height="192">
<div class="figcaption"><a href="https://www.flickr.com/photos/phploveme/2630802644/" target="_blank" class="author"> Jinho Jung</a> <span class="license"><span class="sep">(</span><a href="http://creativecommons.org/licenses/?lang=es" rel="license nofollow" target="_blank" title="Creative Commons BY-NC-SA">CC BY-NC-SA</a><span class="sep">)</span></span></div>
</div>
<p><br>¿Cómo le pedimos al Sistema Gestor de Bases de Datos Relacional (<acronym title=" Sistema Gestor de Bases de Datos Relacional.">SGBDR</acronym>) que nos proporcione la información que nos interesa de la base de datos?</p>
<p>En todas o casi todas las bases de datos relacionales se utiliza el <strong>lenguaje <acronym title="Structured Query Language." lang="en">SQL</acronym> </strong>para interactuar con el&nbsp;<acronym title=" Sistema Gestor de Bases de Datos Relacional.">SGBDR</acronym>. Veamos sus características principales.</p>
<p><acronym title="Structured Query Language." lang="en">SQL</acronym> es un lenguaje <strong>no</strong> <strong>procedimental</strong> en el cual se le indica al SGBDR <strong>qué</strong> queremos obtener y <strong>no cómo hacerlo</strong>. El&nbsp;&nbsp;<acronym title=" Sistema Gestor de Bases de Datos Relacional.">SGBDR</acronym> analiza nuestra orden y si es correcta sintácticamente la ejecuta.</p>
<p>El estudio de&nbsp;<acronym title="Structured Query Language." lang="en">SQL</acronym> nos llevaría mucho más que una unidad, y es objeto de estudio en otros módulos de este ciclo formativo. Pero como resulta imprescindible para poder continuar, haremos una mínima introducción sobre él.</p>
<p>Los comandos <acronym title="Structured Query Language." lang="en">SQL</acronym> se pueden dividir en dos grandes grupos:</p>
<ul class="lista_verificacion">
<li>Los que se utilizan para<strong> definir las estructuras de datos</strong>, llamados comandos <strong><acronym title="Data Definition Language. " lang="en">DDL</acronym> </strong> (<span lang="en">Data Definition Language</span>).</li>
<li>Los que se utilizan para <strong>operar con los datos almacenados en las estructuras</strong>, llamados <strong><acronym title="Data Manipulation Language." lang="en">DML</acronym> </strong> (<span lang="en">Data Manipulation Language</span>).</li>
</ul>
<p>En la siguiente presentación encontrarás algunos de los comandos&nbsp;<acronym title="Structured Query Language." lang="en">SQL</acronym> más utilizados.sencillo:</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/ComandosSQLmasUsuales.pdf" title="Descargar el resumen de comandos SQL.  Se abre en una nueva ventana [pdf - 215323 B]" target="_blank" class="pdf">Resumen de comandos SQL</a><span class="exe-link-data file-size"> (pdf - 215323 <abbr title="Bytes" lang="en">B</abbr>)</span></p>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id18">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id18-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta18_47" class="block iDevice_content">
<p>En este enlace encontrarás de una manera breve pero interesante la historia de &nbsp;<acronym title="Structured Query Language." lang="en">SQL</acronym></p>
<div class="enlace_centrado"><a class="html" title="Acceder a una web sobre la historia de SQL. (Se abre en una nueva ventana)" href="https://www.universidadviu.com/es/actualidad/nuestros-expertos/lenguaje-sql-historia-y-conceptos-basicos" target="_blank"> Historia del <acronym title="Structured Query Language." lang="en">SQL</acronym>.</a></div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id19">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id19-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta19_54" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b19" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b19" class="block iDevice_content">
<p><strong>Con las consultas <acronym title="Structured Query Language." lang="en">SQL</acronym> hay que especificar paso a paso cómo recuperar cada dato de la base de datos.</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b19"><input type="radio" name="option0b19" id="true0b19" class="exe-radio-option exe-radio-option-0-2-0b19-truefalse"> Verdadero</label> 
<label for="false0b19"><input type="radio" name="option0b19" id="false0b19" class="exe-radio-option exe-radio-option-1-2-0b19-truefalse"> Falso</label>
</p>
</form>
<div id="s0b19" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b19-result" class="wrong">Falso</strong></p>
<p>Basta con decirle qué datos queremos y el sistema gestor se encarga de obtenerlos.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.5.2.- Lenguaje SQL (II)</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id20">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id20-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta20_73" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-pd" style="width: 192px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/PROG11_CONT_R11_01_SQL.jpg" width="192" height="120" alt="Texto en letras azules sobre fondo blanco, que reza: “SQL”." title="SQL" style="float: right;">
<div class="figcaption"><span class="author">Elaboración propia.</span> <span class="license"><span class="sep">(</span><span>Dominio público</span><span class="sep">)</span></span></div>
</div>
<p>La primera fase del trabajo con cualquier base de datos comienza con sentencias <acronym title="Data Definition Language." lang="en">DDL</acronym>, puesto que antes de poder almacenar y recuperar información debemos definir las estructuras donde agrupar la información. Las estructuras básicas con las que trabaja <acronym title=" Structured Query Language." lang="en">SQL</acronym> son las tablas.</p>
<p>Como hemos visto antes, una tabla es un conjunto de celdas agrupadas en filas y columnas donde se almacenan elementos de información.</p>
<p>Antes de llevar a cabo la creación de una tabla conviene planificar: nombre de la tabla, nombre de cada columna, tipo y tamaño de los datos almacenados en cada columna, información adicional, restricciones, <abbr title="etcétera.">etc.</abbr></p>
<p>Hay que tener en cuenta también ciertas restricciones en la formación de los nombres de las tablas: longitud. Normalmente, aunque dependen del sistema gestor, suele tener una longitud máxima de 30 caracteres, no puede haber nombres de tabla duplicados, deben comenzar con un carácter alfabético, permitir caracteres alfanuméricos y el guión bajo '_', y normalmente no se distingue entre mayúsculas y minúsculas.</p>
<p>Veamos cómo sería un ejemplo de <acronym title="Data Definition Language." lang="en">DDL</acronym> para crear una tabla, concretamente la tabla PRODUCTO del mini punto de venta:</p>
<div class="highlighted-code language-sql">
<div>
<pre>CREATE TABLE IF NOT EXISTS PRODUCTO(
    ID BIGINT NOT NULL PRIMARY KEY auto_increment,
    BARCODE VARCHAR(24) NOT NULL,
    NOMBRE VARCHAR(200) NOT NULL,
    PRECIO DOUBLE NOT NULL
);</pre>
</div>
</div>
<p>En el ejemplo anterior creamos la tabla PRODUCTO, solo si no existe previamente, además el campo&nbsp;ID sería la clave primaria (PRIMARY KEY). El campo&nbsp;ID además es autoincremental, es decir, es una secuencia que cada vez que se inserte un registro se incrementará automáticamente, algo muy habitual en las bases de datos.</p>
<p>Pongamos ahora otro ejemplo, también relacionado con el mini punto de venta. En este caso, sería la tabla que contendría los tickets:</p>
<div class="highlighted-code language-sql">
<div>
<pre>CREATE TABLE IF NOT EXISTS TICKET (
    ID BIGINT NOT NULL PRIMARY KEY auto_increment,
    FECHA DATE NOT NULL,
    HORA TIME NOT NULL,
    TICKETCERRADO BOOLEAN NOT NULL  
);</pre>
</div>
</div>
<p>En la tabla anterior, la clave primaria es igual que en la tabla PRODUCTO. Aparece información sobre la fecha y la hora del ticket, y un boolean que indicará si el ticket está cerrado o no.</p>
<p>Por último veamos como podría ser la última tabla del mini punto de venta, la tabla LINEATICKET:</p>
<div class="highlighted-code language-sql">
<div>
<pre>CREATE TABLE IF NOT EXISTS LINEATICKET(
    ID BIGINT NOT NULL PRIMARY KEY auto_increment,
    CANTIDAD INTEGER NOT NULL,
    PRECIOVENTA DOUBLE NOT NULL,
    PRODUCTO_ID BIGINT,
    TICKET_ID BIGINT,
    FOREIGN KEY(PRODUCTO_ID) REFERENCES PUBLIC.PRODUCTO(ID) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY(TICKET_ID) REFERENCES PUBLIC.TICKET(ID) ON UPDATE CASCADE ON DELETE CASCADE    
);   
</pre>
</div>
</div>
<p><span style="font-size: 1em;">La tabla&nbsp;</span>LINEATICKET<span style="font-size: 1em;"> contiene cada una de las líneas del ticket; como ya sabes, un ticket puede contener varios productos. Los campos&nbsp;</span>PRODUCTO_ID<span style="font-size: 1em;"> y&nbsp;</span>TICKET_ID<span style="font-size: 1em;"> conectarán esta línea de ticket con el ticket al que pertenece y con el producto en cuestión.</span></p>
<p>Como habrás observado en las tablas anteriores, cada campo tiene asociado un tipo de dato: INTEGER, <code>BIGINT</code>, DATE, <code>TIME</code>, BOOLEAN, <code>VARCHAR</code>, <abbr title="etcétera">etc</abbr>. A la hora de almacenar dicha información en <span lang="en">Java</span>, tendrás que tener en cuenta las siguientes equivalencias:</p>
<ul class="lista_verificacion">
<li>El tipo de dato&nbsp;INTEGER en <acronym title="Structured Query Language" lang="en">SQL</acronym> equivaldría al tipo&nbsp;int en <span lang="en">Java</span>.</li>
<li>El tipo de dato&nbsp;BIGINT en <acronym title="Structured Query Language" lang="en">SQL</acronym> equivaldría al tipo&nbsp;long en&nbsp;<span lang="en">Java</span>.</li>
<li>El tipo de dato&nbsp;DOUBLE en <acronym title="Structured Query Language" lang="en">SQL</acronym> equivaldría al tipo&nbsp;double en&nbsp;<span lang="en">Java</span>.</li>
<li>El tipo de dato&nbsp;VARCHAR en&nbsp;<acronym title="Structured Query Language" lang="en">SQL</acronym> equivaldría al tipo&nbsp;String en&nbsp;<span lang="en">Java</span>, pero tienes que tener en cuenta que&nbsp;VARCHAR tiene un tamaño limitado, mientras que un&nbsp;String no. Por ejemplo,&nbsp;"VARCHAR(30)" sería una cadena de hasta 30 caracteres. Así, que a la hora de insertar datos en una base de datos relacional, debes tener en cuenta que la longitud del&nbsp;String en&nbsp;<span lang="en">Java</span> no debería superar al tamaño límite del&nbsp;VARCHAR en la base de datos.</li>
<li>El tipo de dato&nbsp;DATE en&nbsp;<acronym title="Structured Query Language" lang="en">SQL</acronym> equivaldría al tipo&nbsp;java.sql.Date (no debe usarse&nbsp;java.util.Date ni <code>java.time.LocalDate</code>).&nbsp;java.sql.Date puede convertirse rápidamente a java.time.LocalDate.</li>
<li>El tipo de dato&nbsp;TIME en&nbsp;<acronym title="Structured Query Language" lang="en">SQL</acronym> equivaldría al tipo&nbsp;java.sql.Time (no debe usarse&nbsp;java.util.Time ni <code>java.time.LocalTime</code>). Nuevamente,&nbsp;java.sql.Time puede convertirse rápidamente a java.time.LocalTime.</li>
</ul>
</div>
</div>
</div>
<div class="iDevice_wrapper ReflectionfpdIdevice em_iDevice" id="id127">
<div class="iDevice emphasis_reflexionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_reflexionfpd.png)"><h2 class="iDeviceTitle">Reflexiona</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id127-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta127_119" class="block iDevice_content">
<p>En la tabla&nbsp;PRODUCTO la clave primaria es el atributo ID, sin embargo, el código de barras parece una buena clave primaria. ¿Por qué crees que se ha decidido usar el atributo&nbsp;ID como clave primaria y no el código de barras?</p>
</div>
<form name="feedback-form-127" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedback127text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-127" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-127" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<div id="ta127_120" class="block iDevice_content">
<p>La respuesta es simple, en muchos casos se venden productos que no tienen código de barras, ya sean productos físicos (como una simple bolsa pequeña de plástico) o servicios (como envolver para regalo).</p>
</div>
</div>
</form>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ReflectionfpdIdevice em_iDevice" id="id128">
<div class="iDevice emphasis_reflexionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_reflexionfpd.png)"><h2 class="iDeviceTitle">Reflexiona</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id128-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta128_119" class="block iDevice_content">
<p>En la tabla&nbsp;LINEATICKET se almacena el precio de venta del producto, pero dicho precio ya está en la tabla PRODUCTO. ¿Por qué crees que se duplica dicho valor?</p>
</div>
<form name="feedback-form-128" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedback128text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-128" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-128" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<div id="ta128_120" class="block iDevice_content">
<p>La razón es simple, el precio de un producto puede cambiar a lo largo del tiempo, pero un ticket que se emitió en el pasado tiene que tener exactamente el precio con el que se vendío dicho producto en el pasado.</p>
</div>
</div>
</form>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id140">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id140-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta140_128" class="block iDevice_content">
<p>En la siguiente página de la documentación de <span lang="en">MySQL</span> puedes ver una tabla completa de equivalencias de tipos de datos en la base de datos y tipos de datos <span lang="en">Java</span>:</p>
<p style="text-align: center;"><a href="https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-type-conversions.html" title="Acceder a página web con información sobre equivalencia entre tipos de datos (en inglés). (Se abre en una nueva ventana)" class="html" target="_blank"><span lang="en">Equivalencia de tipos de datos entre <span style="text-align: center;" lang="en">MySQL</span> y <span style="text-align: center;" lang="en">Java.</span></span></a></p>
<p style="text-align: center;"></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.6.- Establecimiento de conexiones</h1></div></div>
<div class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id21">
<div class="iDevice emphasis_casopracticofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id21-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta21_66" class="block iDevice_content">
<div class="exe-figure exe-image float-left license-copyright" style="width: 196px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/EIN_PPAA_CASO_R08_ProfesorCuerpo_FOT.jpg" alt="Juan de pie hablando, gesticulando con los brazos." title="Juan hablando." style="float: left;" width="196" height="132">
<div class="figcaption"><span class="author">Ministerio de Educación. Uso educativo-nc. Elaboración propia.</span></div>
</div>
<p><br>Tanto <strong>Juan</strong> como <strong>María</strong> están deseando empezar a trabajar en su proyecto de mini punto de venta, ya tienen pensadas las tablas y ahora toca empezar a escribir código. Saben que usar bases de datos relacionales en <span lang="en">Java</span> es sencillo, pero aún así tienen algunas dudas, por lo que deciden preguntarle a <strong>Ada</strong>.</p>
<p>¿Cómo se crea una conexión a la base de datos? —pregunta <strong>Juan—</strong>. Estoy intentando ejecutar una consulta usando lo que he visto en un tutorial en Internet, y no consigo que se conecte, me falla en la primera línea.</p>
<p>—Primero tienes que cargar el conector —le responde <strong>Ada—</strong>. ¿Has configurado en tu proyecto las librerías del conector <acronym title="Java Database Connectivity." lang="en">JDBC</acronym>? Para conectarte a una base de datos como MySQL u Oracle desde tu programa necesitas el conector.</p>
<p><span class="st"><span class="st">—Estamos usando H2 para nuestras pruebas, que va todo incluido en el archivo .jar&nbsp;—replica <strong>María</strong>.<br></span></span></p>
<p>—Es verdad, no me acordaba —contesta <strong>Ada—</strong>. El problema entonces debe estar en que no habéis realizado la conexión previamente, vamos a echarle un vistazo al código. No obstante, no olvidéis que en el proyecto habrá que usar una base de datos más potente, revisad también como conectaros con una base de datos como<span lang="en"> <span lang="en">MySQL</span></span><span lang="en"></span>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id22">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id22-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta22_73" class="block iDevice_content">
<div class="elemento_derecha">
<div class="elemento_centrado"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/PROG11_CONT_R12_archivo.jpg" alt="Foto de un mueble con filas de cajones para archivar fichas" title="Archivadores de fichas." class="elemento_derecha" style="float: right;"></div>
<div class="elemento_centrado credenciales"><a class="cc-by" title="Acceder a la licencia CC BY (Se abre en una nueva ventana)" href="http://creativecommons.org/licenses/by/3.0/deed.es" target="_blank"><span class="transparente">CC by</span></a>&nbsp;<a title="Acceder a la imagen " archivadores="" de="" fichas."="" "eirik="" stavelin"="" en="" flickr.="" (se="" abre="" una="" nueva="" ventana)"="" href="http://www.flickr.com/photos/eiriks/3359730744/" target="_blank">Eirik Stavelin</a></div>
</div>
<p align="justify">Cuando queremos acceder a una base de datos para operar con ella, necesitamos que el conector <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> esté configurado en nuestro proyecto a dos niveles:</p>
<ul class="lista_verificacion">
<li align="justify">En un primer nivel es necesario añadir el conector <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> (la librería .jar) en nuestro proyecto para poder desarrollar la aplicación, sin esa dependencia no podremos probar el código que estamos desarrollando.</li>
<li align="justify">En un segundo nivel, si estamos trabajando con una versión anterior a&nbsp;<acronym title="Java Database Connectivity." lang="en">JDBC</acronym> <acronym title="cuatro punto cero">4.0</acronym>, es necesario registrar el conector <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> antes de iniciar la conexión.</li>
</ul>
<p align="justify">Una vez que hemos tenido en cuenta los aspectos anteriores, para establecer una conexión con una base de datos debemos utilizar el método getConnection() de la clase DriverManager. Este método recibe como parámetro la <acronym title="Uniform Resource Locator" lang="en">URL</acronym> de <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> que identifica a la base de datos con la que queremos realizar la conexión.</p>
<p align="justify">Un ejemplo de&nbsp;<acronym title="Uniform Resource Locator" lang="en">URL</acronym> de conexión sería el siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>jdbc:mysql://localhost/proyectobase?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf8</pre>
</div>
</div>
<p align="justify">En la <acronym title="Uniform Resource Locator" lang="en">URL</acronym> anterior hay varias partes importantes, separadas por ":". Veamos cuáles son:</p>
<ul class="lista_verificacion">
<li align="justify">jdbc&nbsp;indica que se trata de una&nbsp;<acronym title="Uniform Resource Locator" lang="en">URL</acronym> que contiene la información para conectar usando <acronym title="Java Database Connectivity." lang="en">JDBC</acronym>.</li>
<li align="justify">mysql indica que se trata de una conexión a una base de datos <span lang="en">MySQL</span>.</li>
<li align="justify">La siguiente sección tiene dos partes:<br>
<ul>
<li align="justify">Servidor y base de datos con la que se desea conectar:&nbsp;//localhost/proyectobase. En ese ejemplo el servidor estaría instalado en la máquina local (localhost) y la base de datos se llamaría proyectobase.</li>
<li align="justify">Después, hay una serie de parámetros para el conector:&nbsp;?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf8. En este caso, esos <span lang="en">drivers</span> indican tres cosas: que el servidor debe considerar que se usará la zona horaria de europa occicental (serverTimezone=UTC) y que se utilizará <span lang="en">Unicode</span> para el texto almacenado (useUnicode=true y&nbsp;<code>characterEncoding=utf8</code>).</li>
</ul>
</li>
</ul>
<p align="justify">Ese es un ejemplo de <acronym title="Uniform Resource Locator" lang="en">URL</acronym>. Si usamos otra base de datos, la&nbsp;<acronym title="Uniform Resource Locator" lang="en">URL</acronym> será diferente. Esa&nbsp;<acronym title="Uniform Resource Locator" lang="en">URL</acronym> se proporcionará al método&nbsp;getConnection para efectuar la conexión, junto con otra información que pueda ser necesaria:</p>
<div class="highlighted-code language-java">
<div>
<pre>String url="jdbc:mysql://localhost/proyectobase?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf8";
String usuario="prueba";
String password="prueba";
Connection con = DriverManager.getConnection(url,usuario,password); //Establecer la conexión

/* Resto del código */

if (con!=null) con.close(); //Cerrar la conexión</pre>
</div>
</div>
<p>Fíjate que en el ejemplo anterior, aparte de la&nbsp;<acronym title="Uniform Resource Locator" lang="en">URL</acronym> de conexión, se le proporciona el usuario y la contraseña para acceder a la base de datos.</p>
<p>La ejecución de este método devuelve un objeto Connection que representa la conexión con la base de datos, <strong><span class="destacado_inline">no debes olvidar cerrar la conexión cuando ya no sea necesaria</span></strong>.</p>
<p align="justify">Pero <strong>el ejemplo anterior está incompleto</strong>. Tienes que tener en cuenta que cuando se encuentra con una&nbsp;<acronym title="Uniform Resource Locator" lang="en">URL</acronym> específica, DriverManager itera sobre la colección de <span lang="en">drivers</span> registrados hasta que uno de ellos reconoce la&nbsp;<acronym title="Uniform Resource Locator" lang="en">URL</acronym> especificada. Si no se encuentra ningún <span lang="en">driver</span> adecuado, se lanza una SQLException.</p>
<p align="justify">Veamos un ejemplo completo de conexión con una base de datos, donde dicha excepción se trata correctamente:</p>
<div class="highlighted-code language-java">
<div>
<pre>String url="jdbc:mysql://localhost/proyectobase?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf8";
String usuario="prueba";
String password="prueba";
try (Connection con = DriverManager.getConnection(url,usuario,password)) {
               
    /* Consultas a la base de datos. */                 
                                                
} catch (SQLException ex) {
   err.printf("No se pudo conectar a la base de datos (%s)\n", dbname);
   ex.printStackTrace();
}</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.6.1.- Configurar un conector JDBC en un proyecto NetBeans</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id23">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id23-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta23_73" class="block iDevice_content">
<p>En la siguiente presentación vamos a ver cómo descargarnos el conector o <span lang="en">driver</span> que necesitamos para trabajar con <span lang="en">MySQL</span>. Como verás, tan sólo consiste en descargar un archivo, descomprimirlo y desde <span lang="en">NetBeans</span> añadir el fichero .jar que constituye el conector que necesitamos.</p>
<div class="exe-figure exe-media position-center" style="width: 550px;">
<div class="figcaption header"><strong>Añadir el driver JDBC para MySQL en un proyecto de NetBeans</strong></div>
<span class="external-iframe-src" style="display:none"><a href="https://prezi.com/view/s1aBqRhibJDlU34glDRl/embed">https://prezi.com/view/s1aBqRhibJDlU34glDRl/embed</a></span><iframe width="550" height="400" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/embed.html" webkitallowfullscreen="1" mozallowfullscreen="1" allowfullscreen="1" class="external-iframe"></iframe><br>
<div class="credenciales elemento_centrado"><a title="Acceder al resumen textual de la presentación que muestra como añadir el driver JDBC de MySQL a NetBeans. (Se abre en una nueva ventana)" href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/descripcionvideoprezi1.1.html" target="_blank">Resumen textual alternativo para "Añadir <span lang="en">driver</span> <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> para <span lang="en"> MySQL</span> en NetBeans"</a></div>
</div>
<p>Recuerda que&nbsp;el conector <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> es un componente que se intercala entre el programa <span lang="en">Java</span> y el Sistema Gestor de la Base de Datos (<acronym title="Sistema Gestor de Bases de Datos.">SGBD</acronym>), y que implementa la funcionalidad necesaria para proporcionar comunicación entre la&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym> <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> y el&nbsp;<acronym title="Sistema Gestor de Bases de Datos.">SGBD</acronym>.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id24">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id24-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta24_54" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b24" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b24" class="block iDevice_content">
<p><strong>Para establecer una conexión con una base de datos se puede usar getConnection().</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b24"><input type="radio" name="option0b24" id="true0b24" class="exe-radio-option exe-radio-option-0-2-0b24-truefalse"> Verdadero</label> 
<label for="false0b24"><input type="radio" name="option0b24" id="false0b24" class="exe-radio-option exe-radio-option-1-2-0b24-truefalse"> Falso</label>
</p>
</form>
<div id="s0b24" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b24-result" class="right">Verdadero</strong></p>
<p>En efecto getConnection() se utiliza para conectarnos a una base de datos.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id157">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id157-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta157_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b157" class="block iDevice_content">
<p>¿Te atreverías a crear un proyecto <span lang="en">NetBeans</span> que incorpore el conector <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> para <span lang="en"> MySQL</span>? Seguro que sabes hacerlo.</p>
</div>
<form name="feedback-form-quesFeedback0b157" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b157text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b157" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b157" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>A continuación tienes un proyecto base de <span lang="en">NetBeans</span>, listo para usar, que incorpora ya el conector <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> para <span lang="en"> MySQL</span>:<span lang="en"></span></p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/UT10_ProyectoBaseMySQL.1.zip" title="Descargar proyecto base NetBeans que incluye el conector JDBC para MySQL. Se abre en una nueva ventana [zip - 2305093 B]" class="paquete" target="_blank">Proyecto base <span lang="en">NetBeans</span> que incorpora el conector&nbsp;<acronym title="Java Database Connectivity." lang="en">JDBC</acronym> para <span lang="en"> MySQL.</span></a><span class="exe-link-data file-size"> (zip - 2305093 <abbr title="Bytes" lang="en">B</abbr>)</span><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/UT10_ProyectoBaseMySQL.zip" title="Descargar proyecto base NetBeans que incluye el conector JDBC para MySQL."></a></p>
<p>Nota: la versión incluida del conector es la 8.0.20.</p></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.6.2.- Registrar el conector JDBC</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id25">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id25-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta25_73" class="block iDevice_content">
<div class="elemento_derecha">
<div class="elemento_centrado"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/PROG11_CONT_R15_libros.jpg" alt="Libros antiguos sobre un estante." title="Libros" style="float: right;"></div>
<div class="elemento_centrado credenciales"><a class="cc-by" title="Acceder a la licencia CC BY (Se abre en una nueva ventana)" href="http://creativecommons.org/licenses/by/3.0/deed.es" target="_blank"><span class="transparente">CC by</span></a>&nbsp;<a title=" Acceder a la imagen " libros"="" de="" "bruno="" cordioli"="" en="" flickr.="" (se="" abre="" una="" nueva="" ventana)"="" href="http://www.flickr.com/photos/br1dotcom/4166144897/" target="_blank"> Bruno Cordioli</a></div>
</div>
<p>A la hora de empezar a escribir código, ¿sabes si necesitas registrar el conector <acronym title="Java Database Connectivity." lang="en">JDBC</acronym>? Como se comentó en apartados anteriores, es necesario registrar el conector <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> si estamos trabajando con una versión de <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> anterior a la <acronym title="cuatro punto cero">4.0</acronym>.</p>
<p>En la práctica, es fácil saber cuándo tienes que registrar el conector, dado que solo las versiones anteriores a <acronym title="uno punto seis">1.6</acronym> del <acronym title="Java Delopment Kit">JDK</acronym> tienen una versión de&nbsp;<acronym title="Java Database Connectivity." lang="en">JDBC</acronym> inferior a la <acronym title="cuatro punto cero">4.0</acronym>. Esto quiere decir que:</p>
<p class="destacado"><strong>Solo tienes que registrar el conector si vas a usar un <acronym title="Java Development Kit" lang="en">JDK</acronym> anterior a 1.6. Versiones actuales como<strong>&nbsp;<acronym title="Java Development Kit" lang="en">JDK</acronym>&nbsp;</strong>1.7, <strong>&nbsp;<acronym title="Java Development Kit" lang="en">JDK</acronym>&nbsp;</strong>8 y posteriores, no necesitan registrar el conector, pero como se verá a continuación es una buena práctica.<br></strong></p>
<p>Para registrar el controlador primero, hay que consultar la documentación del conector que vamos a utilizar para conocer el nombre de la clase que hay que emplear, dado que cada conector es diferente.</p>
<p>En el caso del conector para <span lang="en">MySQL</span> la clase en cuestión es&nbsp;com.mysql.cj.jdbc.Driver. Se trata de una clase que implementa la interfaz&nbsp;java.sql.Driver definida por <acronym title="Java Database Connectivity." lang="en">JDBC</acronym>, y que es la interfaz que todo conector debe implementar. Dicha clase ya compilada se encontrará obviamente dentro de la librería .jar que instalamos en el paso anterior.</p>
<p>Las líneas de código necesarias para registrar el conector son tan sencillas como las siguientes:</p>
<div class="highlighted-code language-java">
<div>
<pre>boolean driverCargado=false;
String driver="com.mysql.cj.jdbc.Driver";
try {
      Class.forName(driver).newInstance();
      driverCargado=true;
} catch (ClassNotFoundException e) {
      err.printf("No se encuentra el driver de la base de datos (%s)\n",driver);
} catch (InstantiationException ex) {
      err.printf("No se ha podido iniciar el driver de la base de datos (%s)\n",driver);
} catch (IllegalAccessException ex) {
      err.printf("No se ha podido iniciar el driver de la base de datos (%s)\n",driver);
}

if (driverCargado) {

// podemos continuar, el driver se ha cargado correctamente

}</pre>
</div>
</div>
<p>Una vez cargado el conector, es posible hacer una conexión al <acronym title="Sistema Gestor de Bases de Datos">SGBD</acronym>. Fíjate que el proceso de carga puede producir hasta tres tipos de excepciones diferentes, hay que tener especial cuidado con eso, dado que el programa no debería continuar en caso de que dichas excepciones se produjeran.</p>
<p>Por último, toca hablar un poco de la distribución de la aplicación al cliente final. Los proyectos que hemos creado hasta ahora, donde hemos incluido la librería del conector al proyecto para poder desarrollar y probar nuestra aplicación, no generan proyectos listos para ejecutar en un cliente final. ¿Por qué? Por que el archivo .jar generado para nuestra aplicación no incluye en su interior el conector.&nbsp;</p>
<p>¿Y esto que significa? Significa que debemos copiar también el conector <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> en la máquina del cliente como parte del proceso de instalación. Como parte del proceso de instalación debemos, o bien añadir al CLASSPATH la localización del archivo&nbsp;.jar del conector, o bien indicar a la hora de ejecutar la aplicación donde está el archivo .jar del conector. Un ejemplo de esto último sería el siguiente:</p>
<div class="highlighted-code code-style-2 language-latex">
<div>
<pre>java -cp UT10_ProyectoBaseMySQL.jar;librerias\mysql-connector-java-8.0.20.jar ejemplo.Aplicacion</pre>
</div>
</div>
<p>En el código anterior el conector estaría en una carpeta llamada librerias.</p>
<div class="destacado">
<p><strong>Aunque el proceso de registro del conector no es necesario en muchos casos, es una buena práctica por dos motivos:</strong></p>
<ul class="lista_verificacion">
<li><strong>El primero es por asegurar compatibilidad con versiones anteriores del </strong><acronym title="Java Development Kit" lang="en">JDK</acronym><strong>, dado que en muchas ocasiones no sabemos que versión del&nbsp;</strong><acronym title="Java Development Kit" lang="en">JDK</acronym><strong> se usará en el cliente final.</strong></li>
<li><strong style="font-size: 1em;">El segundo es para controlar situaciones como la anterior. Si al ejecutar la aplicación en el cliente no se encuentra el conector, porque no se ha configurado bien el&nbsp;CLASSPATH o porque al ejecutar la aplicación no se ha indicado donde está la librería del conector, podremos mostrar por pantalla un mensaje amigable y evitar así una incómoda excepción.</strong></li>
</ul>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id160">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id160-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta160_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b160" class="block iDevice_content">
<p>¿Cómo sería el código necesario para registrar el conector <acronym title="Java Database Connectivity">JDBC</acronym> para la base de datos H2? Seguro que sabes hacerlo, consulta primero la documentación de H2 para hacerlo:</p>
<p style="text-align: center;"><a href="http://www.h2database.com/html/tutorial.html#connecting_using_jdbc" title="Acceder a la documentación de como conectar con H2 usando JDBC (en inglés). (Se abre en una nueva ventana)" target="_blank" class="html" hreflang="en">Conectar a una base de datos H2 usando <acronym title="Java Database Connectivity">JDBC</acronym>.</a></p>
</div>
<form name="feedback-form-quesFeedback0b160" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b160text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b160" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b160" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>El código es idéntico al antes mostrado, solo cambia la clase a indicar, que en este caso, sería org.h2.Driver:</p>
<div class="highlighted-code language-java">
<div>
<pre>boolean driverCargado=false;
String driver="org.h2.Driver";
try {
      Class.forName(driver).newInstance();
      driverCargado=true;
} catch (ClassNotFoundException e) {
      err.printf("No se encuentra el driver de la base de datos (%s)\n",driver);
} catch (InstantiationException ex) {
      err.printf("No se ha podido iniciar el driver de la base de datos (%s)\n",driver);
} catch (IllegalAccessException ex) {
      err.printf("No se ha podido iniciar el driver de la base de datos (%s)\n",driver);
}

if (driverCargado) {

// podemos continuar, el driver se ha cargado correctamente

}</pre>
</div>
</div></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.7.- Ejecución de consultas sobre la base de datos</h1></div></div>
<div class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id26">
<div class="iDevice emphasis_casopracticofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id26-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta26_66" class="block iDevice_content">
<div class="exe-figure exe-image float-left license-copyright" style="width: 128px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/CASO_PERSONAJES_24.png" alt="Foto de Ada mirando al frente." title="Foto de Ada." style="float: left;" width="128" height="192">
<div class="figcaption"><span class="author">Ministerio de Educación. Uso educativo-nc. Elaboración propia.</span><span class="license"><span><br></span></span></div>
</div>
<p><strong><br>Ada</strong> está muy satisfecha con el interés que <strong>Juan</strong> y <strong>María</strong> han puesto y el empeño en empezar a utilizar una tecnología que en breve van a usar. Los ve que están enfrascados en la creación de consultas para gestionar los productos, los tickets y demás.</p>
<p><strong>Ada</strong> es consciente de que hacer consultas es una de las facetas de la programación más delicadas. Por lo que, dada la importancia del proyecto, cuanto antes avancen y mejoren sus destrezas en ese aspecto, mucho mejor.</p>
<p><strong>María</strong> y <strong>Juan</strong>&nbsp;tienen experiencia en consultas <acronym title="Structured Query Language"><span lang="Structured Query Languege">SQL</span></acronym> y saben que, cuando se hace una consulta a una base de datos, hay que afinar y hacerla lo más eficiente posible, pues si se descuidan el sistema gestor puede tardar mucho en devolver los resultados.</p>
<p><strong>Ada</strong> se acerca discretamente a ver lo que está haciendo <strong>María</strong>, y se da cuenta de que está escribiendo código para crear tickets. Prefiere no molestarla, dado que parece muy concentrada.</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id27">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id27-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta27_73" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-pd" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/Consulta.jpg" width="250" height="133" alt="Ilustración 3D de un montón de muñecos sentados en círculo alrededor de una enorme interrogación" title="Consulta." style="float: right;">
<div class="figcaption"><a href="https://pixabay.com/es/illustrations/signo-de-interrogaci%C3%B3n-pregunta-mark-1722862/" target="_blank" class="author" title="Acceder a la imagen  " consulta",="" de="" "quimono",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">qimono</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>¿Crees que será sencillo ejecutar una consulta a través de <acronym title="Java Database Connectivity">JDBC</acronym>? Es más fácil de lo que parece.</p>
<p>Antes de continuar, repasemos lo que ya sabemos hasta ahora. Para operar con una base de datos y ejecutar&nbsp; las consultas necesarias, nuestra aplicación deberá hacer las operaciones siguientes:</p>
<ul class="lista_verificacion">
<li><strong>Registrar el conector</strong>.</li>
<li><strong>Establecer una conexión</strong> con la base de datos.</li>
<li><strong>Enviar consultas</strong> <acronym title="Structured Query Language." lang="en">SQL</acronym> y procesar el resultado.</li>
<li><strong>Liberar los recursos</strong> al terminar.</li>
<li><strong>Gestionar los errores</strong> que se puedan producir.</li>
</ul>
<p>Bien, una vez repasado lo anterior lo primero que debes saber es que <acronym title="Java Database Connectivity">JDBC</acronym> proporciona tres modelos de sentencias:</p>
<ul class="lista_verificacion">
<li>Statement: para lanzar consultas sencillas en <acronym title="Structured Query Language." lang="en">SQL</acronym>.</li>
<li>PreparedStatement: para lanzar consultas preparadas, es decir, consultas que tienen parámetros.</li>
<li>CallableStatement: para lanzar la ejecución de procedimientos almacenados en la base de datos.</li>
</ul>
<p>Además, tienes que tener en cuenta que la&nbsp;<acronym title="Application Programming Interface." lang="en">API</acronym> <acronym title="Java Database Connectivity." lang="en">JDBC</acronym> distingue dos tipos de consultas:</p>
<ul class="lista_verificacion">
<li><strong>Consultas que permiten obtener datos almacenados:</strong> SELECT. Para las consultas tipo&nbsp;SELECT, que obtienen datos de la base de datos, se emplea el método ResultSet executeQuery(String sql). El método anterior retorna un objeto de tipo ResultSet, el cual permitirá acceder a los datos resultantes de la ejecución de la consulta para su procesamiento.</li>
<li><strong>Consultas que permiten cambiar los datos almacenados</strong>: entre esas consultas tenemos INSERT, UPDATE, DELETE entre otras. Para estas consultas se utiliza el método executeUpdate(String sql). Este método retornará un entero indicando el número de filas afectadas, que serán, dependiendo de la consulta, las filas que se han insertado, actualizado o borrado de la tabla.</li>
</ul>
</div>
</div>
</div>
<div class="iDevice_wrapper DestacadofpdIdevice" id="id175">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id175-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div class="iDevice_destacadofpd">
<div id="ta175_151" class="block iDevice_content">
<p><strong>Es común, cuando se habla de bases de datos y programación en un mismo contexto, escuchar la expresión <em>"operaciones </em><acronym title="Create, Read, Update and Delete" lang="en">CRUD</acronym><em>"</em>. Esta expresión equivale en español a <em>"Crear, Leer, Actualizar y Borrar"</em> y hace referencia a las cuatro operaciones básicas que necesita hacer nuestra aplicación para manejar la información:</strong></p>
<ul class="lista_verificacion">
<li><strong>Creación de datos (consultas tipo INSERT).</strong></li>
<li><strong>Lectura de datos (consultas tipo SELECT).</strong></li>
<li><strong>Actualización de datos (consultas tipo UPDATE).</strong></li>
<li><strong>Borrado de datos (consultas tipo DELETE).</strong></li>
</ul>
<p><strong>A su vez, otro acrónimo muy común es <acronym title="Data Access Object">DAO</acronym>. Este hace referencia a componentes que usamos en nuestro <span lang="en">software</span>, como <acronym title="Java Database Connectivity">JDBC</acronym>, para hacer independiente a nuestra aplicación de la base de datos o sistema de almacenamiento de información usado. La idea detrás de este concepto es que un cambio en el almacenamiento afecte lo mínimo posible a nuestra aplicación, minimizando el número de líneas a modificar.</strong></p>
<p><strong>En esa línea, se recomienda enormemente también crear clases específicas para gestionar las operaciones <acronym title="Create, Read, Update and Delete">CRUD</acronym>, de tal forma que dichas clases concentren las operaciones con la base de datos. Tradicionalmente, es común ver que este tipo de clases tienen la terminación DAO para así expresar su propósito, por ejemplo.</strong></p>
<ul class="lista_verificacion">
<li><strong>ProductosDAO podría ser una clase que agrupara las operaciones <acronym title="Create, Read, Update and Delete">CRUD</acronym> con productos.</strong></li>
</ul>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id28">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id28-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta28_54" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b28" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b28" class="block iDevice_content">
<p><strong> Para poder enviar consultas a la base de datos hemos tenido que conectarnos a ella previamente.</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b28"><input type="radio" name="option0b28" id="true0b28" class="exe-radio-option exe-radio-option-0-2-0b28-truefalse"> Verdadero</label> 
<label for="false0b28"><input type="radio" name="option0b28" id="false0b28" class="exe-radio-option exe-radio-option-1-2-0b28-truefalse"> Falso</label>
</p>
</form>
<div id="s0b28" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b28-result" class="right">Verdadero</strong></p>
<p>Así es, hay que cargar el <span lang="en">driver</span> y establecer la conexión.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.7.1.- Adición de información</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id34">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id34-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta34_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-CC-BY-ND" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/puzzle-1020003_640.jpg" alt="Imagen en la que se muestra dos pesonas intentando insertar una pieza de puzzle en un hueco hecho a medida." title="Añadir una pieza al puzzle." style="float: right;" width="250" height="165"><figcaption class="figcaption"><span class="title"><em><a class="hover_opacity" href="https://pixabay.com/es/users/Peggy_Marco-1553824/" title="Acceder a la imagen  " añadir="" una="" pieza="" al="" puzzle.",="" de="" "peggy_marco",="" en="" pixabay.="" (se="" abre="" nueva="" ventana)"="">Peggy_Marco</a>.</em></span>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></figcaption></figure>
<p>¿Cómo añadirías un registro a una tabla en la base de datos?</p>
<p>Por lo que sabemos hasta ahora tendrás que crear una consulta INSERT INTO de <acronym title="Structured Query Language." lang="en">SQL</acronym>, usar un&nbsp;Statement o un PreparedStatement, y además debemos utilizar el método executeUpdate().</p>
<p>Debido a innumerables motivos, se aconseja usar un&nbsp;PreparedStatement, por lo que vamos a explicar en primer lugar su uso.</p>
<p>Un&nbsp;PreparedStatement&nbsp;necesita una consulta&nbsp;<acronym title="Structured Query Language." lang="en">SQL</acronym> que tenga parámetros, los parámetros se indican con "?":</p>
<div class="highlighted-code language-java">
<div>
<pre>String query = "INSERT INTO producto (nombre, barcode, precio) VALUES (?,?,?)";
</pre>
</div>
</div>
<p>La consulta anterior tendría 3 parámetros, y cada parámetro sería accesible por la posición que ocupa en la consulta, empezando a numerar el primero en uno (el primer&nbsp;"?" sería el parámetro número 1, el segundo&nbsp;"?" será el parámetro número 2, y así sucesivamente). Después se pueden reemplazar cómodamente con una serie de métodos que proporciona la clase PreparedStatement, veamos algunos de ellos:</p>
<ul class="lista_verificacion">
<li>setDouble (int pos, double value) para indicar el valor de un parámetro de tipo double.</li>
<li>setInt (int pos, int value)&nbsp;para indicar el valor de un parámetro tipo entero.</li>
<li>setString (int pos, String value)&nbsp;para indicar el valor de un parámeto tipo cadena de texto.</li>
<li>setDate (int pos, Date value)&nbsp;para indicar el valor de un parámetro tipo fecha (java.sql.Date).</li>
<li>setTime (int pos, Time value)&nbsp;para indicar el valor de un parámetro tipo hora (java.sql.Time).</li>
</ul>
<p>Veamos cómo se podría ejecutar entonces la sentencia paramétrica anterior:</p>
<div class="highlighted-code language-java">
<div>
<pre>public static void nuevoProducto(Connection con, String nombre, String barcode, double precio) {
        String query = "INSERT INTO producto (nombre, barcode, precio) VALUES (?,?,?)";
        if (con != null) {

            try ( PreparedStatement consulta = con.prepareStatement(query)) {

                consulta.setString(1, nombre);
                consulta.setString(2, barcode);
                consulta.setDouble(3, precio);

                int registrosAfectados = consulta.executeUpdate();
                if (registrosAfectados &gt; 0) {
                    System.out.println("Producto insertado correctamente.");
                } else {
                    System.out.println("El producto no ha podido ser insertado.");
                }
            } catch (SQLException ex) {
                System.err.printf("Se ha producido un error al ejecutar la consulta SQL.");
            }
        }
    }</pre>
</div>
</div>
<p>En el ejemplo anterior se muestra un método estático que recibe por parámetro la conexión (con) y los datos necesarios para almacenar el producto.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id137">
<div class="iDevice emphasis_debesconocerfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id137-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta137_129" class="block iDevice_content">
<p>En muchas tablas, como es el caso de la tabla&nbsp;Producto usada en la consulta anterior, el identificador usado como clave primaria se genera de forma automática. Es algo común en muchas tablas. Si necesitas obtener el identificador asignado al registro recién insertado, puedes hacerlo con el siguiente método:</p>
<p style="text-align: center;"><a href="https://docs.oracle.com/javase/7/docs/api/java/sql/Statement.html#getGeneratedKeys()" title="Acceder a la documentación del método getGeneratedKeys. (Se abre en una nueva ventana)" target="_blank" class="html" hreflang="en">Documentación del método getGeneratedKeys</a></p>
<p style="text-align: left;">Para poder ejecutarlo necesitas que la consulta tenga un parámetro (<code class="  language-java">Statement<span class="token punctuation">.</span>RETURN_GENERATED_KEYS</code>):</p>
<div class="highlighted-code language-java">
<div>
<pre>PreparedStatement consulta = con.prepareStatement(query, Statement.RETURN_GENERATED_KEYS)</pre>
</div>
</div>
<p style="text-align: left;">A continuación tienes el ejemplo anterior, modificado para que retorne el&nbsp;id del producto insertado en la base de datos:</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/EjemploINSERTProducto01.java" title="Descargar el archivo .java de ejemplo. Se abre en una nueva ventana [java - 1.75 KB]" class="binario" charset="UTF-8" type="text/plain" target="_blank">Inserción de un producto retornando el&nbsp;id del producto insertado.</a><span class="exe-link-data file-size"> (java - 1.75 <abbr lang="en" title="KiloBytes">KB</abbr>)</span>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id162">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id162-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta162_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b162" class="block iDevice_content">
<p>¿Recuerdas como era la tabla ticket expuesta en apartados anteriores?</p>
<p>¿Sabrías modificar el ejemplo anterior para crear un ticket con la fecha y la hora de hoy, y retornar el&nbsp;id autogenerado de dicho ticket?</p>
<p>Parece complicado, pero seguro que sabrás hacerlo.</p>
</div>
<form name="feedback-form-quesFeedback0b162" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b162text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b162" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b162" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Una solución posible es la siguiente, se parece bastante al ejemplo anterior, simplemente cambia la tabla y los tipos de datos con los que se trabaja:</p>
<div class="highlighted-code language-java">
<div>
<pre>public static long nuevoTicket(Connection con) {
        String query = "INSERT INTO ticket (fecha, hora, ticketcerrado) VALUES (?,?,false)";
        long id=-1;
        if (con != null) {

            try ( PreparedStatement consulta = con.prepareStatement(query,
                                      Statement.RETURN_GENERATED_KEYS)) {

                java.sql.Date fecha=java.sql.Date.valueOf(LocalDate.now());
                java.sql.Time hora=java.sql.Time.valueOf(LocalTime.now());
                consulta.setDate(1, fecha);
                consulta.setTime(2, hora);

                int registrosAfectados = consulta.executeUpdate();
                if (registrosAfectados&gt;0)
                {
                    ResultSet m=consulta.getGeneratedKeys();
                    if (m.next())
                    {
                        id=m.getLong(1);
                        System.out.printf("Ticket creado con ID=%d\n",id);                        
                    }
                } else {
                    System.out.println("El ticket no ha podido ser creado.");
                }

            } catch (SQLException ex) {
                System.err.printf("Se ha producio un error al ejecutar la consulta SQL.");
            }
        }
        return id;
    }</pre>
</div>
</div>
<p></p></div>
</form>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id35">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id35-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta35_54" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b35" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b35" class="block iDevice_content">
<p><strong>Para añadir registros a una tabla de una base de datos, tenemos que usar el método execute() de la clase Statement.<br></strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b35"><input type="radio" name="option0b35" id="true0b35" class="exe-radio-option exe-radio-option-0-2-0b35-truefalse"> Verdadero</label> 
<label for="false0b35"><input type="radio" name="option0b35" id="false0b35" class="exe-radio-option exe-radio-option-1-2-0b35-truefalse"> Falso</label>
</p>
</form>
<div id="s0b35" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b35-result" class="wrong">Falso</strong></p>
<p>La clase a emplear es la clase&nbsp;Statement o la clase PreparedStatement, pero el método a utilizar es executeUpdate.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.7.2.- Recuperación de información (I)</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id29">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id29-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta29_73" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-pd" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/RecuperarInformacion.png" width="250" height="261" alt="Ilustración de un libro con una i de información en la portada" title="Recuperar información." style="float: right;">
<div class="figcaption"><a href="https://pixabay.com/es/vectors/libro-conocimiento-info-ayuda-117596/" target="_blank" class="author" title="Acceder a la imagen  " recuperar="" información",="" de="" "openclipart-vectors",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">OpenClipart-Vectors</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>Y ahora, ¿cómo rescatamos la información ya almacenada en la base de datos?</p>
<p>Supongo que ya lo imaginas, tendremos que ejecutar consultas tipo SELECT. Tendremos que preparar una cadena de texto que contenga la consulta <acronym title="Structured Query Language." lang="en">SQL</acronym>, y ejecutar dicha consulta<acronym title="Structured Query Language." lang="en"></acronym>.</p>
<p>Las consultas tipo&nbsp;SELECT se lanzarán principalmente con el método&nbsp;executeQuery (aunque también se pueden lanzar con el método execute) de la clase&nbsp;Statement o <code>PreparedStatement</code>. En ambos casos se obtiene un ResultSet, que es una clase <span lang="en">Java</span> parecida a una lista en la que se aloja el resultado de la consulta. Cada elemento de la lista es uno de los registros de la base de datos que cumple con los requisitos de la consulta.</p>
<p>El ResultSet no contiene todos los datos, sino que los va obteniendo de la base de datos según se van pidiendo. La razón de esto es evitar que una consulta que devuelva una cantidad muy elevada de registros, tarde mucho tiempo en obtenerse y sature la memoria del programa.</p>
<p>Con el ResultSet hay disponibles una serie de métodos que permiten movernos hacia delante y hacia atrás en las filas, y obtener la información de cada fila. Vamos a ver un ejemplo sencillo en el que se obtiene el id, el&nbsp;nombre y el&nbsp;precio de todos los productos almacenados en la base de datos:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static void mostrarTodosLosProductos(Connection con) {
        if (con != null) {
            try ( Statement consulta = con.createStatement()) {
                ResultSet resultados = consulta.executeQuery("SELECT id,nombre,precio FROM producto");

                while (resultados.next()) {
                    long id = resultados.getLong("id");
                    String nombre = resultados.getString("nombre");
                    double precio = resultados.getDouble("precio");
                    System.out.printf("%5d %-15s %10.2f\n", id, nombre, precio);
                }

            } catch (SQLException ex) {
                System.err.printf("Se ha producido un error al ejecutar la consulta SQL.");
            }
        }
    }</pre>
</div>
</div>
<p>La clase&nbsp;ResultSet usa internamente un <a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#t146e2c77-4b99-5024-6a25-b0b9ad791def" id="link146e2c77-4b99-5024-6a25-b0b9ad791def" class="exe-tooltip definition-tt titled-tt" title="Cursor | Ver la definición">cursor</a> que permitirá ir accediendo a cada uno de los registros seleccionados. Inicialmente dicho cursor no apunta a ningún de registro.</p>
<p>En el ejemplo anterior, el método next() del ResultSet hace que dicho cursor avance al siguiente registro (o que se sitúe en el primer registro si es la primera invocación del método). Si lo consigue, el método next() devuelve true. Si no lo consigue, porque no haya más registros que leer, entonces devuelve false.</p>
<p>Para obtener cada una de las columnas de cada registro, se utilizan los métodos get. A dichos métodos habrá que pasar el nombre del campo cuyo valor se desea obtener ("id", "nombre", "precio" , <abbr title="etcétera">etc.</abbr>) o la posición del campo (empezando su numeración en uno). Veamos algunos de los métodos&nbsp;get más importantes:</p>
<ul class="lista_verificacion">
<li>getDouble para obtener un campo cuyo valor es de tipo double.</li>
<li>getInt para obtener un campo cuyo valor es de tipo entero.</li>
<li>getString&nbsp;para obtener un campo cuyo valor es de tipo cadena de texto.</li>
<li>getDate para obtener un campo cuyo valor es de tipo fecha (java.sql.Date).</li>
<li>getTime para obtener un campo cuyo valor es de tipo<strong> </strong>hora (java.sql.Time).</li>
</ul>
<p></p>
<div id="t146e2c77-4b99-5024-6a25-b0b9ad791def" class="exe-tooltip-text">
<p>Un cursor está formado por un conjunto de registros devueltos por una instrucción <acronym title="Structured Query Language">SQL</acronym> de tipo SELECT.</p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id30">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id30-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta30_47" class="block iDevice_content">
<p>Puedes consultar todos los métodos que soporta ResulSet, además de más información, en la documentación de <span lang="en">Oracle</span>:</p>
<div class="enlace_centrado"><a class="html" title="Acceder a la información de ResulSet en la página oficial de Oracle. (Se abre en una nueva ventana)" href="http://docs.oracle.com/javase/6/docs/api/java/sql/ResultSet.html" target="_blank"> ResulSet</a></div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper SeleccionmultiplefpdIdevice em_iDevice" id="id139">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id139-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div class="question">
<div id="actitity-139_136">
<form name="multi-select-form-139_136" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form multi-select-form">
<h3 class="js-sr-av">Pregunta</h3>
<div id="taquestion139_136" class="block question iDevice_content">
<p><strong>Tenemos la consulta siguiente:</strong></p>
<div class="highlighted-code language-sql">
<div>
<pre>SELECT id,nombre,precio FROM producto</pre>
</div>
</div>
<p><strong>Para obtener el campo precio, ¿cuáles de las siguientes líneas serían las más acertadas?</strong></p>
</div>
<div class="iDevice_answers">
<h4 class="js-sr-av">Respuestas</h4>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op139_1360" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-139_139">Opción 1</a></label><input type="checkbox" id="op139_1360" value="False">
</p>
<div class="iDevice_answer-content" id="answer-139_139"><a name="answer-139_139" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans139_139" class="block iDevice_content">
<p>getPrecio()</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-139_1360" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op139_1361" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-139_5074">Opción 2</a></label><input type="checkbox" id="op139_1361" value="False">
</p>
<div class="iDevice_answer-content" id="answer-139_5074"><a name="answer-139_5074" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans139_5074" class="block iDevice_content">
<p>getDouble(2)</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-139_1361" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op139_1362" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-139_5076">Opción 3</a></label><input type="checkbox" id="op139_1362" value="True">
</p>
<div class="iDevice_answer-content" id="answer-139_5076"><a name="answer-139_5076" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans139_5076" class="block iDevice_content">
<p>getDouble(3)</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-139_1362" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op139_1363" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-139_5078">Opción 4</a></label><input type="checkbox" id="op139_1363" value="False">
</p>
<div class="iDevice_answer-content" id="answer-139_5078"><a name="answer-139_5078" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans139_5078" class="block iDevice_content">
<p>getString("precio")</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-139_1363" style="display:none"></div>
</div>
</div>
<div class="block iDevice_buttons feedback-button js-required">
<p>
<input type="button" name="submitSelect" class="feedbackbutton multi-select-feedback-toggler" value="Mostrar retroalimentación" id="multi-select-feedback-toggler-4-139_136"> 
</p>
</div>
<div id="f139_136" class="js-hidden js-feedback" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>

<div id="tafeedback139_136" class="feedback iDevice_content">
<p>De todas las opciones antes indicadas, realmente la única opción correcta es&nbsp;getDouble(3) dado que estaría rescatando el valor de la tercera columna y lo estaría convirtiendo a double. También podrías usar&nbsp;getString("precio"), pero no estaría convirtiendo el tipo de dato a double.</p>
</div>
</div>
</form>
<div class="iDevice_solution feedback js-hidden">
<h4>Solución</h4>
<ol>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-139_139" class="wrong">Incorrecto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-139_5074" class="wrong">Incorrecto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-139_5076" class="right">Correcto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-139_5078" class="wrong">Incorrecto</a></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.7.1.2.- Recuperación de información (II)</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id31">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id31-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta31_73" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-pd" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/RecuperarInformacion_2.jpg" width="250" height="133" alt="Ilustración 3D de un montón de interrogaciones de color blanco, sobre las que destaca una única interrogación en color rojo" title="Recuperando la información buscada" style="float: right;">
<div class="figcaption"><a href="https://pixabay.com/es/illustrations/signo-de-interrogaci%C3%B3n-pila-pregunta-1495858/" target="_blank" class="author" title="Acceder a la imagen  " recuperando="" la="" información="" buscada",="" de="" "quimono",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">quimono</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>¿Y si necesitas realizar una consulta en la que se seleccione solo los registros que cumplan unas determinadas condiciones?</p>
<p>En ese caso, necesitas una consulta paramétrica. Imagina que necesitas obtener todos los productos de la base de datos que tienen un precio mayor a uno pasado por parámetro. Necesitarías una consulta como la siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>String query="SELECT id,nombre,precio FROM producto WHERE precio&gt;=?";
</pre>
</div>
</div>
<p>El procedimiento de ejecución de la consulta anterior necesita hacer uso de las consultas tipo PreparedStatement, vistas en apartados anteriores. Veamos un pequeño ejemplo donde se muestran por pantalla los productos cuyo precio es superior a uno dado por parámetro:</p>
<div class="highlighted-code language-java">
<div>
<pre>public static void mostrarProductosPrecioMinimo (Connection con, double precioMinimo)
    {
        String query="SELECT id,nombre,precio FROM producto WHERE precio&gt;=?";
        if (con!=null) {
         try ( PreparedStatement consulta = con.prepareStatement(query)) {
                consulta.setDouble(1, precioMinimo);
                if (consulta.execute()) {
                    ResultSet resultados = consulta.getResultSet();
                    while (resultados.next()) {
                        long id = resultados.getLong("id");
                        String nombre = resultados.getString("nombre");
                        double precio = resultados.getDouble("precio");
                        System.out.printf("%5d %-15s %10.2f\n", id, nombre, precio);
                    }
                }
            } catch (SQLException ex) {
                System.err.printf("Se ha producido un error al ejecutar la consulta SQL.");
            }
        }
    }</pre>
</div>
</div>
<p>Igual que en el caso de inserción de registros en la base de datos, aquí se utilizan los métodos&nbsp;set para establecer el valor de los parámetros de la consulta, en este caso, el método setDouble, dado que el precio es de tipo&nbsp;DOUBLE en la tabla de la base de datos.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id142">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id142-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta142_128" class="block iDevice_content">
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta141_129" class="block iDevice_content">
<p>Cuando creamos una tabla podemos indicar que un campo debe ser NOT NULL. Si establecemos esa opción, dicho campo no podrá estar vacío en un registro.</p>
<p>Cuando un campo puede estar vacío, si no tiene valor, almacenará un valor conocido como NULL. Cuando contiene NULL, por tanto, significará que en dicho campo no hay datos.</p>
<p>Un método interesante que tiene la clase&nbsp;ResultSet es <code>wasNull()</code>. Este método nos informa de si el último valor leído con un método get fue NULL. En la siguiente página tienes un ejemplo de su uso:</p>
<p style="text-align: center;"><a href="http://www.java2s.com/Tutorials/Java/java.sql/ResultSet/Java_ResultSet_wasNull_.htm" title="Acceder a ejemplo de uso de wasNull (en inglés).(Se abre en una nueva ventana)" class="html" hreflang="en" target="_blank">Ejemplo de uso de wasNull()</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id32">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id32-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta32_54" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b32" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b32" class="block iDevice_content">
<p><strong>Para obtener un entero almacenado en uno de los campos de un registro, trabajando con el ResulSet emplearemos el método getInt().</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b32"><input type="radio" name="option0b32" id="true0b32" class="exe-radio-option exe-radio-option-0-2-0b32-truefalse"> Verdadero</label> 
<label for="false0b32"><input type="radio" name="option0b32" id="false0b32" class="exe-radio-option exe-radio-option-1-2-0b32-truefalse"> Falso</label>
</p>
</form>
<div id="s0b32" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b32-result" class="right">Verdadero</strong></p>
<p>Eso es. Hay un getString() para cadenas, getDate() para fechas,<abbr title="etcétera."> etc.</abbr></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id166">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id166-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta166_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b166" class="block iDevice_content">
<p>Te proponemos ahora un pequeño reto.</p>
<p>¿Te has fijado en la tabla de <span lang="en">tickets</span> expuesta en apartados anteriores?</p>
<p>Los <span lang="en">tickets</span> tienen un campo&nbsp;BOOLEAN llamado&nbsp;TICKETCERRADO. La idea de ese campo es que sea solo&nbsp;true cuando el <span lang="en">ticket </span>se ha cerrado, y si el <span lang="en">ticket</span> está cerrado, no podrán añadirse líneas de <span lang="en">ticket</span> al mismo.</p>
<p>¿Serías capaz de crear un método que muestre la lista de <span lang="en">tickets</span> que todavía no han sido cerrados?</p>
</div>
<form name="feedback-form-quesFeedback0b166" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b166text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b166" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b166" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Seguro que te ha sido fácil. Aquí te proponemos una solución al problema anterior:</p>
<div class="highlighted-code language-java">
<div>
<pre>    /**
     * Método que ejecuta una consulta tipo SELECT para mostrar todos los 
     * tickets que no están cerrados.
     * @param con Conexión con la base de datos. 
     */
    public static void mostrarTicketsNoCerrados (Connection con)
    {
        String query="SELECT id,fecha,hora FROM ticket WHERE TICKETCERRADO=false";
        if (con!=null) {
         try ( Statement consulta = con.createStatement()) {                
                    ResultSet resultados = consulta.executeQuery(query);                    
                    while (resultados.next()) {
                        long id = resultados.getLong("id");
                        LocalDate fecha = resultados.getDate("fecha").toLocalDate();
                        LocalTime hora = resultados.getTime("hora").toLocalTime();
                        System.out.printf("%5d %-15s %-15s\n", id, fecha.toString(), hora.toString());
                    }
            } catch (SQLException ex) {
                System.err.printf("Se ha producido un error al ejecutar la consulta SQL.");
            }
        }
    }</pre>
</div>
</div></div>
</form>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id178">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id178-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta178_128" class="block iDevice_content">
<p>En apartados anteriores se ha indicado que era muy "conveniente" utilizar objetos PreparedStatement, es decir, sentencias "preparadas" o "parametrizadas" en lugar de objetos convencionales de tipo&nbsp;Statement. Recuerda que la diferencia fundamental es que en este último caso se construye una cadena de caracteres a partir de los elementos estructurales de la sentencia combinados con los valores que podrían haberse proporcionado desde la interfaz de usuario.</p>
<p>Se aconseja el uso de sentencias "preparadas" por lo siguiente:</p>
<ol>
<li>las consultas preparadas <strong>mejoran el rendimiento</strong>, reduciendo el tiempo de análisis, pues la preparación de la consulta se realiza una sola vez;</li>
<li>los parámetros vinculados <strong>minimizan el ancho de banda del servidor</strong>, pues cada vez que se quiera ejecutar la sentencia solo se necesita enviar los parámetros y no el texto de la consulta completa;</li>
<li>desde el punto de vista de la <strong>seguridad</strong>, son muy útiles para defendernos frente a "<strong>inyecciones <acronym title="Structured Query Language" lang="en">SQL</acronym></strong>".</li>
</ol>
<p>En este enlace se describe detalladamente el funcionamiento y las ventajas del uso de este tipo de sentencias parametrizadas en lugar de que nuestro código construya la sentencia uniendo los distintos elementos en una cadena de caracteres:</p>
<p style="text-align: center;"><a href="https://www.ionos.es/digitalguide/paginas-web/desarrollo-web/prepared-statements/" title="Enlace a la web " prepared="" statements:="" introducción="" y="" ejemplos"="" (se="" abre="" en="" una="" nueva="" ventana)"="" target="_blank" class="html">Prepared statements: introducción y ejemplos</a></p>
<p>En este otro enlace de la <em>Wikipedia</em> tienes una descripción básica del concepto de "<strong>inyección <acronym title="Structured Query Language" lang="en">SQL</acronym></strong>", cuyos efectos debemos evitar por todos los medios en nuestro código si queremos que éste resulte seguro:</p>
<p style="text-align: center;"><a href="https://es.wikipedia.org/wiki/Inyecci%C3%B3n_SQL" title="Enlace al artículo de la Wikipedia sobre Inyección SQL (se abre en una nueva ventana)" target="_blank" class="html">Inyección&nbsp;<acronym title="Structured Query Language" lang="en">SQL</acronym> (<span lang="en">Wikipedia</span>)</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.7.3.- Actualización de información</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id33">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id33-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta33_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-CC-BY-ND" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/update-4223736_640.jpg" alt="Imagen que muestra un teclado donde la tecla " enter"="" tiene="" el="" texto="" encima="" "update"."="" title="Actualizar datos." style="float: right;" width="250" height="125"><figcaption class="figcaption"><a href="https://pixabay.com/es/illustrations/actualizaci%C3%B3n-software-de-app-4223736/" target="_blank" class="author" title="Acceder a la imagen  " actualiar="" datos",="" de="" "tumisu",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">Tumisu</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></figcaption></figure>
<p>Ya sabes cómo insertar registros en la base de datos, y también, cómo rescatarlos. Ahora toca otra operación muy común: la actualización de datos. ¿Crees que serías capaz de hacerlo?</p>
<p>Las consultas de actualización son las consultas tipo UPDATE, y tal y como se comentó en apartados anteriores, es necesario ejecutarlas usando el método executeUpdate. Ese método, como ya sabes, retorna el número de registros insertados, actualizados o eliminados, dependiendo del tipo de consulta que se trate.</p>
<p>Imagina la siguiente consulta que cambia el precio de un producto concreto:</p>
<div class="highlighted-code language-java">
<div>
<pre>String query = "UPDATE producto SET precio=? WHERE id=?;";</pre>
</div>
</div>
<p>Ejecutar la consulta anterior es similar a una inserción, veamos como podría ser:</p>
<div class="highlighted-code language-java">
<div>
<pre>public static void actualizarPrecioProducto(Connection con, long id,double precio) {
        String query = "UPDATE producto SET precio=? WHERE id=?;";
        if (con != null) {

            try ( PreparedStatement consulta = con.prepareStatement(query)) {

                consulta.setDouble(1, precio);
                consulta.setLong(2, id);

                int registrosAfectados = consulta.executeUpdate();
                if (registrosAfectados&gt;0)
                {
                    System.out.println("El precio del producto se ha modificado." + precio);
                } else {
                    System.out.println("El precio del producto no se ha modificado, producto no encontrado.");
                }

            } catch (SQLException ex) {
                System.err.printf("Se ha producio un error al ejecutar la consulta SQL.");
            }
        }
    }</pre>
</div>
</div>
<p>Fíjate en el uso del valor retornado por el método&nbsp;executeUpdate, gracias a dicho valor podemos determinar si la inserción se pudo realizar o no, dado que sabríamos el número de registros que han sido modificados.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id167">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id167-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta167_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b167" class="block iDevice_content">
<p>Te proponemos ahora un pequeño ejercicio. Como ya sabes, los <span lang="en">tickets</span> tienen un campo llamado&nbsp;ticketcerrado que indica si al <span lang="en">ticket</span> se le pueden añadir más líneas de <span lang="en">ticket </span>o si por el contrario, ya no se le pueden añadir más. ¿Sabrías hacer un método que admitiera la conexión y el&nbsp;id del <span lang="en">ticket</span> y que pusiera&nbsp;ticketcerrado a <code>true</code>?</p>
</div>
<form name="feedback-form-quesFeedback0b167" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b167text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b167" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b167" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Una solución para el ejercicio anterior podría ser la siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static void cerrarTicket(Connection con, long id) {
        String query = "UPDATE ticket SET ticketcerrado=true WHERE id=?";
        if (con != null) {

            try ( PreparedStatement consulta = con.prepareStatement(query)) {

                consulta.setLong(1, id);

                int registrosAfectados = consulta.executeUpdate();
                if (registrosAfectados&gt;0)
                {
                    System.out.printf("El ticket con id %d ha sido cerrado.\n",id);                   
                } else {
                    System.out.printf("El ticket con id %d no ha podido ser cerrado, no existe.\n",id);
                }

            } catch (SQLException ex) {
                System.err.printf("Se ha producio un error al ejecutar la consulta SQL.\n");
            }
        }
    }</pre>
</div>
</div>
<p></p></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.7.4.- Borrado de información</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id36">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id36-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta36_73" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-pd" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/Borrar.jpg" width="250" height="141" alt="Goma de borrar" title="Borrar información" style="float: right;">
<div class="figcaption"><a href="https://pixabay.com/es/photos/goma-de-borrar-abrasi%C3%B3n-papeler%C3%ADa-3822402/" target="_blank" class="author" title="Acceder a la imagen  " borrar="" información",="" de="" "mastertux",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">MasterTux</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>Hay que eliminar información, ¿te atreves?</p>
<p>Siempre da un poco de miedo eliminar datos, pero hay veces que es necesario hacerlo.</p>
<p>Cuando nos interese eliminar registros de una tabla de una base de datos, emplearemos la sentencia <acronym title="Structured Query Language." lang="en">SQL</acronym> DELETE. Para eliminar registros de la base de datos recomendamos utilizar PreparedStatement, dado que lo más habitual es que haya que pasar algún parámetro a la consulta. Imagina que necesitamos eliminar un producto concreto de la base de datos, deberíamos utilizar una consulta similar a la siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>String queryDelete = "DELETE FROM producto WHERE id=?";
</pre>
</div>
</div>
<p>En el código anterior se eliminaría un producto con un&nbsp;id interno concreto. En las sentencias de este tipo, normalmente, siempre se usa la clave primaria para especificar qué registro concreto se desea eliminar, y no eliminar otro por error.</p>
<p>Veamos un ejemplo de la ejecución de la sentencia anterior:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static void borrarProducto(Connection con, long id) {
        String queryDelete = "DELETE FROM producto WHERE id=?";
        if (con != null) {
            try ( PreparedStatement consultaDelete = con.prepareStatement(queryDelete)) {
                consultaDelete.setLong(1, id);
                int registrosAfectados = consultaDelete.executeUpdate();
                if (registrosAfectados &gt; 0) {
                    System.out.println("El producto ha sido eliminado correctamente");
                } else {
                    System.out.println("El producto no ha sido eliminado, porque no existe.");
                }
            } catch (SQLException ex) {
                System.err.printf("Se ha producio un error al ejecutar la consulta SQL.");
            }
        }
    }</pre>
</div>
</div>
<p>Fíjate que tal y como ocurría en otros casos anteriores, aprovechamos el valor retornado por el método&nbsp;executeUpdate para saber si el registro se eliminó o no.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id37">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id37-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta37_54" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b37" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b37" class="block iDevice_content">
<p><strong>Al ejecutar el borrado de un registro mediante executeUpdate(…), no podemos saber si el borrado eliminó alguna fila o no.</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b37"><input type="radio" name="option0b37" id="true0b37" class="exe-radio-option exe-radio-option-0-2-0b37-truefalse"> Verdadero</label> 
<label for="false0b37"><input type="radio" name="option0b37" id="false0b37" class="exe-radio-option exe-radio-option-1-2-0b37-truefalse"> Falso</label>
</p>
</form>
<div id="s0b37" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b37-result" class="wrong">Falso</strong></p>
<p>Efectivamente podemos saberlo porque se devuelve el número de registros borrados, como hemos visto en el código del ejemplo anterior.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id168">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id168-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta168_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b168" class="block iDevice_content">
<p>En realidad, un producto no debería borrarse si ya está siendo usado en alguna línea de algún <span lang="en">ticket</span>. Esto quiere decir, que si el&nbsp;id de producto aparece en algún registro de la tabla LINEATICKET, dicho producto no debería borrarse porque entonces crearía inconsistencia en la base de datos. ¿Sabrías modificar el código anterior para solucionar ese problema?</p>
</div>
<form name="feedback-form-quesFeedback0b168" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b168text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b168" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b168" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Existen varias soluciones, algunas mejores y otras peores. La solución que te proponemos a continuación no es la mejor, pero la ventaja es que es sencilla de entender: primero comprobamos cuántas líneas de <span lang="en">ticket</span> tienen el producto en cuestión, y luego, si el número de líneas de <span lang="en">tickets</span> donde aparece el producto es 0, podemos borrar dicho producto. Veamos el código, como verás, es necesario ejecutar dos consultas:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static void borrarProductoConVerificacion(Connection con, long id) {
        /*Consulta 1: Comprobar que no hay ninguna lineaticket que esté usando el producto. */
        String querySelect = "SELECT count(*) FROM lineaticket WHERE producto_id=?";
        /*Consulta 2: Eliminar el producto */
        String queryDelete = "DELETE FROM producto WHERE id=?";
        int recuento=-1;
        if (con != null) {            
            try ( PreparedStatement consultaSelect = con.prepareStatement(querySelect)) {
                
                consultaSelect.setLong(1, id);

                ResultSet result=consultaSelect.executeQuery();
                if (result.next())
                {
                    recuento=result.getInt(1);
                }                                
            } catch (SQLException ex) {
                System.err.printf("Se ha producio un error al ejecutar la consulta SQL.");
            }
            
            if (recuento==0)
            {
                try ( PreparedStatement consultaDelete = con.prepareStatement(queryDelete)) {
            
                    consultaDelete.setLong(1, id);
                    int registrosAfectados = consultaDelete.executeUpdate();
                    if (registrosAfectados&gt;0)
                    {
                        System.out.println("El producto ha sido eliminado correctamente");
                    } else {
                        System.out.println("El producto no ha sido eliminado, porque no existe.");
                    }
                } catch (SQLException ex) {
                    System.err.printf("Se ha producido un error al ejecutar la consulta SQL.");
                 }
            }
            else if (recuento!=-1)
            {
                System.out.println("El producto no se puede eliminar porque ya aparece en líneas de ticket.");
            }           
        }
    }</pre>
</div>
</div>
<p>Nota: cuando se trabaja con bases de datos que reciben múltiples consultas simultáneamente, al ejecutar código como el anterior hay que tener ciertas precauciones extra, como bloquear tablas o realizar transacciones con un nivel de aislamiento adecuado.</p>
<p></p>
<p></p></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.7.5.- Cierre de conexiones</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id38">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id38-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta38_73" class="block iDevice_content">
<figure class="exe-figure exe-image float-left license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/cleaning-2055336_640.jpg" alt="Imagen que muestra dos personas limpiando los restos de sacapuntas encima de una libreta abierta." title="Cerrar las conexiones es importante para limpiar la memoria." width="250" height="145"><figcaption class="figcaption"><a href="https://pixabay.com/es/illustrations/limpieza-l%C3%A1piz-barrido-notas-2055336/" target="_blank" class="author" title="Acceder a la imagen  " cerrar="" las="" conexiones="" es="" importante="" para="" limpiar="" la="" memoria",="" de="" "axxlc",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">AxxLC </a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></figcaption></figure>
<p align="justify">¿Crees que es importante cerrar una conexión?</p>
<p align="justify">Las conexiones a una base de datos consumen muchos recursos en el sistema gestor de bases de datos y también en la misma memoria del sistema donde se ejecuta la aplicación.</p>
<p align="justify">Si realizamos un programa que realiza múltiples conexiones a la base de datos, y luego no las cerramos adecuadamente, estaremos ocupando memoria innecesariamente.</p>
<p align="justify">Por ello, conviene cerrar las conexiones con el método close() siempre que vayan a dejar de ser utilizadas, en lugar de esperar a que el recolector de basura de <span lang="en">Java</span> (<span lang="en">garbage collector</span>) las elimine.</p>
<p align="justify">Veamos un ejemplo de cómo cerrar una conexión a una base de datos de forma adecuada:</p>
<div class="highlighted-code language-java">
<div>
<pre>String url="jdbc:mysql://localhost/proyectobase?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf8";
String usuario="prueba";
String password="prueba";
Connection con = null
try {
    con = DriverManager.getConnection(url,usuario,password);         &lt;br /&gt;  
    /* Consultas a la base de datos. */                 
                                                
} catch (SQLException ex) {
   err.printf("No se pudo conectar a la base de datos (%s)\n", dbname);
   ex.printStackTrace();
} finally {
  if (con!=null) con.close();
}</pre>
</div>
</div>
<p align="justify">El código anterior puede ser reemplazado por un try-with-resources, tal y como se ha hecho en ejemplos anteriores. Esto tiene una gran ventaja, y es que nos libera de tener que invocar el método .close(), dado que esta estructura garantiza el cierre de recursos de forma automática y segura.</p>
<p align="justify">También es necesario cerrar las sentencias (Statement y <code>PreparedStatement</code>). De esa forma también liberamos memoria y recursos del sistema. No es un problema en programas que ejecutan pocas consultas, pero en programas que ejecutan miles o millones de consultas se convierte en un problema grave. Como hemos visto en ejemplos anteriores, con esas sentencias también se puede usar un&nbsp;try-with-resources, por lo que vamos a poner un ejemplo alternativo donde no se utiliza dicha estructura:</p>
<div class="highlighted-code language-java">
<div>
<pre>  Statement consulta=null;
  try {
      consulta = con.createStatement();
      if (consulta.execute("SELECT id,nombre,precio FROM producto")) {
          ResultSet resultados = consulta.getResultSet();
          while (resultados.next()) {
             long id = resultados.getLong("id");
             String nombre = resultados.getString("nombre");
             double precio = resultados.getDouble("precio");
             System.out.printf("%5d %-15s %10.2f\n", id, nombre, precio);
          }
      }
  } catch (SQLException ex) {
      System.err.printf("Se ha producio un error al ejecutar la consulta SQL.");
  } finally {
      if (consulta!=null) 
         consulta.close();
 }</pre>
</div>
</div>
<p align="justify">A veces, incluso es conveniente liberar los resultados (ResultSet). No obstante, cuando se cierra la consulta, también se liberan los&nbsp;ResultSet asociados.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper CitasparapensarfpdIdevice em_iDevice" id="id39">
<div class="iDevice emphasis_citasparapensarfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_citasparapensarfpd.png)"><h2 class="iDeviceTitle">Citas para pensar</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id39-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta39_49" class="block iDevice_content">
<blockquote class="exe-quote-cite styled-qc">
<p>Noble cosa es, aun para un anciano, el aprender.</p>
<cite>Sófocles.</cite></blockquote>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id40">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id40-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta40_47" class="block iDevice_content">
<p>En el siguiente enlace puedes ver cómo se realiza una gestión de la conexión con <span lang="en">Oracle</span>, desde el registro del conector hasta el cierre de la misma.</p>
<div class="enlace_centrado"><a class="pdf" title="Acceder a una web con información sobre la gestión de la conexión en Oracle. (Se abre en una ventana nueva)" href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/devjoker.pdf" target="_blank"> Gestión de la conexión en <span lang="en">Oracle</span>.</a></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">1.7.6.- Excepciones en JDBC</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id41">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id41-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta41_73" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-pd" style="width: 113px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/CaptuarExcepciones.jpg" alt="Ilustración de un niño capturando una nube con un cazamariposas." title="Capturar Excepciones JDBC" style="float: right;" width="113" height="200">
<div class="figcaption"><a href="https://pixabay.com/es/illustrations/pintura-creatividad-paisaje-nube-4812544/" target="_blank" class="author" title="Acceder a la imagen  " capturar="" excepciones="" jdbd",="" de="" "cdd20",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">Cdd20</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>En todas las aplicaciones en general, y por tanto en las que acceden a bases de datos en particular, nos puede ocurrir con frecuencia que la aplicación no funciona, no muestra los datos de la base de datos que deseábamos, <abbr title="etcétera.">etc.</abbr></p>
<p>Es importante capturar las excepciones que puedan ocurrir para que el programa no aborte de manera abrupta. Además, es conveniente tratarlas para que nos den información sobre si el problema es que se está intentando acceder a una base de datos que no existe, o que el servicio <span lang="en">MySQL</span> no está arrancado, o que se ha intentado hacer alguna operación no permitida sobre la base de datos, como acceder con un usuario y contraseña no registrados, ...</p>
<p>Cuando alguna de las clases que usamos de <acronym title="Java Database Connectivity" lang="en">JDBC</acronym> se encuentra con un error, generará una excepción tipo&nbsp;SQLException que incluye información muy útil. En especial, cuando se trata de consultas, dado que nos puede dar detalles importantes de cuál es el problema en la consulta.</p>
<div class="destacado"><strong>Es importante que <em>las operaciones de acceso a base de datos </em>estén <em>dentro de un bloque </em>&lt;em&gt;try-catch&lt;/em&gt; que gestione las excepciones.</strong></div>
<p>Los dos métodos más útiles&nbsp;de SQLException <code></code> son el método getMessage(), que permite recoger y mostrar el mensaje de error que ha generado <span lang="en">la base de datos (generalmente en inglés), y también el método </span>getSQLState(), que permite obtener un código que identifica el error que se ha producido. También es útil el método getErrorCode(), el cual devuelve un número entero que representa el código de error asociado.</p>
<p>Aunque cada base de datos hace sus propias adaptaciones y sigue sus propios criterios, los códigos obtenidos por el método&nbsp;getSQLState() generalmente suelen seguir el convenio de los estándares <acronym title="Structured Query Language">SQL</acronym> publicados por organizaciones como <acronym title="International Organization for Standardization" lang="en">ISO</acronym> y <acronym title="American National Standards Institute" lang="en">ANSI</acronym>. En la siguiente página puedes ver los códigos de error que genera<span lang="en"> MySQL</span> y su significado:</p>
<p style="text-align: center;"><a href="https://dev.mysql.com/doc/mysql-errors/8.0/en/server-error-reference.html" title="Acceder a página que contiene información sobre los códigos de error del servidor MySQL (en inglés). (Se abre en una nueva ventana)" class="html" hreflang="en" target="_blank">Códigos de error en <span lang="en">MySQL</span> 8.0.</a></p>
<p><span>El que estos códigos estén medianamente estandarizados permite que podamos dar una respuesta desde la programación frente a determinados fallos.</span></p>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id42">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id42-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta42_54" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b42" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b42" class="block iDevice_content">
<p><strong>El cierre de las conexiones y la gestión de excepciones sólo hay que efectuarla con bases de datos <span lang="en">MySQL</span>.</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b42"><input type="radio" name="option0b42" id="true0b42" class="exe-radio-option exe-radio-option-0-2-0b42-truefalse"> Verdadero</label> 
<label for="false0b42"><input type="radio" name="option0b42" id="false0b42" class="exe-radio-option exe-radio-option-1-2-0b42-truefalse"> Falso</label>
</p>
</form>
<div id="s0b42" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b42-result" class="wrong">Falso</strong></p>
<p>Siempre hay que gestionarlos con cualquier base de datos.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id169">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id169-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta169_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b169" class="block iDevice_content">
<p>Te proponemos ahora un ejercicio un tanto más complicado que los anteriores. En la tabla&nbsp;LINEATICKET se almacenan las diferentes líneas de <span lang="en">ticket</span> de un<span lang="en"> ticket</span>, y se utilizan dos atributos para determinar a qué t<span lang="en">icket</span>&nbsp; pertenece la línea de <span lang="en">ticket</span> y el producto al que refiere la línea de <span lang="en">ticket</span>.</p>
<p>Échale un vistazo al siguiente método encargado de insertar una nueva línea de ticket en la tabla LINEATICKET:</p>
<div class="highlighted-code language-java">
<div>
<pre class="  language-java"><code class="  language-java"> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">nuevaLineaTicket</span><span class="token punctuation">(</span>Connection con<span class="token punctuation">,</span> <span class="token keyword">int</span> cantidad<span class="token punctuation">,</span> <span class="token keyword">double</span> precio<span class="token punctuation">,</span> <span class="token keyword">long</span> idproducto<span class="token punctuation">,</span> <span class="token keyword">long</span> idticket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String query <span class="token operator">=</span> <span class="token string">"INSERT INTO LINEATICKET (CANTIDAD,PRECIOVENTA,PRODUCTO_ID,TICKET_ID) VALUES (?,?,?,?);"</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>con <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">try</span> <span class="token punctuation">(</span> PreparedStatement consulta <span class="token operator">=</span> con<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span>
                                      Statement<span class="token punctuation">.</span>RETURN_GENERATED_KEYS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                consulta<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> cantidad<span class="token punctuation">)</span><span class="token punctuation">;</span>
                consulta<span class="token punctuation">.</span><span class="token function">setDouble</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> precio<span class="token punctuation">)</span><span class="token punctuation">;</span>
                consulta<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> idproducto<span class="token punctuation">)</span><span class="token punctuation">;</span>
                consulta<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> idticket<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">int</span> registrosAfectados <span class="token operator">=</span> consulta<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>registrosAfectados<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    ResultSet m<span class="token operator">=</span>consulta<span class="token punctuation">.</span><span class="token function">getGeneratedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        id<span class="token operator">=</span>m<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"LineaTicket creada con ID=%d\n"</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>                        
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"La línea de ticket no ha podido ser creada."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>                
                System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Se ha producio un error al ejecutar la consulta SQL.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SQLState: %s\n"</span><span class="token punctuation">,</span>ex<span class="token punctuation">.</span><span class="token function">getSQLState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SQLError: %s\n"</span><span class="token punctuation">,</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
</div>
</div>
<p>El código anterior permite insertar una nueva línea de ticket en la base de datos. La consulta anterior puede funcionar, pero puede que falle si el&nbsp;id del ticket o el&nbsp;id del producto al que está asociada la línea de ticket anterior no existe. Esto provocaría un mensaje en consola como el siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>Se ha producio un error al ejecutar la consulta SQL.
SQLState:23506
SQLError:Violación de una restricción de Integridad Referencial: "CONSTRAINT_B5: PUBLIC.LINEATICKET FOREIGN KEY(PRODUCTO_ID) REFERENCES PUBLIC.PRODUCTO(ID) (1000)"
Referential integrity constraint violation: "CONSTRAINT_B5: PUBLIC.LINEATICKET FOREIGN KEY(PRODUCTO_ID) REFERENCES PUBLIC.PRODUCTO(ID) (1000)"; SQL statement:
INSERT INTO LINEATICKET (CANTIDAD,PRECIOVENTA,PRODUCTO_ID,TICKET_ID) VALUES (?,?,?,?); [23506-197]</pre>
</div>
</div>
<p>Si te fijas en el valor generado por getSQLState y lo buscas en la documentación de la base de datos H2, comprobarás que se trata de un error perfectamente tipificado, sobre el cual podemos actuar. ¿Podrías modificar el código anterior para que indique exactamente el error que se ha producido?</p>
</div>
<form name="feedback-form-quesFeedback0b169" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b169text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b169" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b169" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Una solución es simplemente procesar el código retornado por&nbsp;getSQLState en la excepción y ofrecer una respuesta a medida. Para hacer una respuesta que sirviera tanto para la base de datos H2 como para la base de datos <span lang="en">MySQL</span> se podría realizar lo siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>            } catch (SQLException ex) {                
                if (ex.getSQLState().matches("23[0-9]{3}")) {
                    System.err.printf("La línea de ticket no se ha podido insertar porque no existe el ticket o el producto.\n");    
                }
                else
                    System.err.printf("Se ha producido un error no esperado al ejecutar la consulta SQL.\n");                    
            }</pre>
</div>
</div></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.- Persistencia de objetos</h1></div></div>
<div class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id78">
<div class="iDevice emphasis_casopracticofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id78-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta78_66" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-copyright" style="width: 200px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/CASO_PERSONAJES_08.jpg" alt="Antonio mirando de frente sonriente con camiseta amarilla." title="Antonio mirando de frente." style="float: right;" width="200" height="132">
<div class="figcaption"><span class="author">Ministerio de Educación. Uso educativo-nc. Elaboración propia.</span><span class="license"><span class="sep"></span></span></div>
</div>
<p><strong><span>Antonio</span></strong><span> esta mañana está muy contento y todo es porque una aplicación que estaba haciendo le ha funcionado. Es una aplicación donde está utilizando bases de datos con <acronym title="Java Persistence API" lang="en">JPA</acronym>, y se siente orgulloso por haber sido capaz de hacerlo.<br></span></p>
<p><span><strong>Juan</strong> y <strong>Antonio</strong> se encuentran por el pasillo y comienza a hablar:</span></p>
<p><span><span>—</span>¿Dónde vas tan contento? <span>—</span>pregunta <strong>Juan</strong> a <strong>Antonio</strong>.</span></p>
<p><span><span>—</span>Pues voy a tomarme un café, que desde que llegue esta mañana estoy sentado tecleando sin parar. ¿Te apuntas?</span></p>
<p><span><span>—</span>Sí claro, si me cuentas en que estás trabajando, ¿tan interesante es?</span></p>
<p><span><span>—</span>No es solo que sea interesante, es que es algo que no había hecho antes, y claro, para mí es un reto superado. Estoy trabajando en un proyecto que utiliza <acronym title="Java Persistence API" lang="en"><span>JPA</span></acronym> para almacenar datos en la base de datos, y aunque cuesta arrancar un poco, luego te das cuenta de la gran potencia que tiene.</span></p>
<p><span>—Dirás <acronym title="Java Database Connectivity" lang="en">JDBC</acronym>&nbsp;—replica <strong>Juan</strong>, convencido de que <strong>Antonio</strong> estaba confundiendo términos.</span></p>
<p><span>—No, que va. Es otra tecnología diferente. Si tuviera que hacer lo mismo que estoy haciendo con <span> <acronym title="Java Database Connectivity" lang="en">JDBC</acronym> </span>tardaría el triple.</span></p>
<p><span>—¿En serio? —pregunta <strong>Juan</strong> asombrado—. Cuéntame un poco como es, <strong>María</strong> y yo estamos en un proyecto donde quizás nos venga bien.</span></p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id79">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id79-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta79_69" class="block iDevice_content">
<div class="elemento_derecha">
<div class="elemento_centrado"><img class="elemento_derecha" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/PROG11_CONT_R25_discoduro.jpg" alt="Disco duro color gris metálico abierto." title="Disco duro" style="float: right;"></div>
<div class="elemento_centrado credenciales"><a class="cc-by-nc-sa" title="Acceder a la licencia CC BY-NC-SA. (Se abre en una nueva ventana)" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.es" target="_blank"><span class="transparente">CC by-nc-sa</span></a>&nbsp;<a title="Acceder a la imagen " disco="" duro"="" de="" "ken="" fager"="" en="" flickr.="" (se="" abre="" una="" nueva="" ventana)"="" href="https://www.flickr.com/photos/kenfagerdotcom/6813531077/sizes/s/in/photolist-bo68pK-bo68fx-5KBK3Z-5KFZ3d-5KBJWa-5KBJUP-5KFYUJ-9SZzCU-9SZAfA-9SZyGy-9SWKPk-5KBK8F-5KBK1r-5KFYZJ-5KFZ4A-5KBJZr-5KFYPw-5KBJTD-5KFYWs-9RPRwV-9RQ6rP-9RPmCF-9RSywC-9RPMjn-9RNWKF-9RPwWg-9RQ2bz-9RS3Mu-9RQeor-9RU9So-cDRX2s-9RSX7q-9RNEx4-9RNM7V-9RSiGv-9RRgfe-9RNtXR-9RRBek-9RVjwb-9RMHNa-9RMVoz-9RPJPo-9RMd7z-9RR5r5-bmcCX5-6wJbuC-9kUnFc-2hSWvQ-9RMyKe-9RQXVS/" target="_blank">Ken Fager</a></div>
</div>
<p>En el apartado anterior se hablaba del desfase objeto-relacional, y los inconvenientes entre usar un modelo de datos en nuestro <span lang="en">software</span>, y un modelo diferente en la base de datos. Pero, ¿y si fuera posible almacenar los objetos directamente? Entonces, ya no existiría dicho desfase. ¿Sería posible?</p>
<p>La realidad es que hoy en día sí es posible. Existen una variedad de opciones, aquí vamos a presentar unas cuantas y a explorar una de ellas.</p>
<p>A la hora de almacenar los datos de una organización, vamos a hacer una pequeña generalización. El lugar donde se almacenen los datos vamos a denominarlo <strong><span class="resaltado_inline">almacén de datos</span></strong>. Esto nos dará cierta independencia, porque cuando hablamos de base de datos en cierta medida damos por sentado que la base de datos tiene que ser relacional, pero existen otras opciones para implementar un almacén de datos.</p>
<p>Vamos a revisar algunas de las opciones disponibles:</p>
<ul class="lista_verificacion">
<li><strong>Almacenamiento de objetos en archivos de forma serializada.</strong> Almacenar los objetos de forma serializada es algo que ya conoces de unidades anteriores. Es válido para un conjunto de datos pequeño, pero cuando el volumen de datos es grande, la serialización de datos presenta problemas que son difíciles de solventar<strong>.</strong></li>
<li><strong>Usar un sistema gestor de bases datos relacional (<acronym title="Sistema Gestor de Bases de Datos Relacional.">SGDBR</acronym>)</strong>. Es una de las soluciones más recurridas, pero como ya sabes, para almacenar objetos hay que realizar consultas <acronym title="Structured Query Language." lang="en">SQL</acronym> y los tipos de datos de la base de datos no coinciden con los tipos de datos del lenguaje de programación. Esta barrera hace que no sea posible almacenar objetos directamente, sino que haya que transformar la información para poder almacenarla.</li>
<li><strong>Extensiones de lenguajes de programación tradicionales para facilitar el acceso a datos</strong>. Este tipo de técnicas amplían la funcionalidad de los lenguajes de programación tradicionales, como Cobol, C, <abbr title="C plus plus.">C++</abbr>, <abbr title="C Sharp.">C#</abbr> o <span lang="en">Java</span>, para hacer más sencillo el acceso a los datos. <acronym title="Structured Query Language Java." lang="en">SQLJ</acronym> o PRO*C son algunos ejemplos de extensiones de los lenguajes <span lang="en">Java</span> y C respectivamente. Algunas de estas extensiones, como <acronym title="Language-Integrated Query." lang="en">LINQ</acronym>, están pensadas para varios lenguajes de programación.</li>
<li><strong>Usar un sistema gestor de bases de datos orientado a objetos (<acronym title="Sistema gestor de bases de datos orientadas a objetos." lang="es">SGBDOO</acronym>)</strong>. Se trata de sistemas donde el modelo de datos usado para almacenar los datos es también orientado a objetos. El objetivo de este tipo de sistemas es precisamente que no exista el desfase objeto-relacional.</li>
<li><strong>Usar un sistema gestor de bases de datos objeto-relacional (<acronym title="Sistema gestor de  bases de datos objeto relacional.">SGBDOR</acronym>).</strong> Se trata de bases de datos que implementan un modelo híbrido o "post-relacional". En este tipo de sistemas de almacenamiento conviven el modelo relacional y el orientado a objetos. La idea aquí, nuevamente, es reducir el desfase objeto-relacional.</li>
<li><strong>Mapeado de objetos</strong>. El mapeado de objetos permite almacenar objetos directamente en el almacén de datos con independencia de la naturaleza del mismo. Se trata básicamente de técnicas que permiten almacenar objetos de un lenguaje de programación directamente en la base de datos, sea esta del tipo que sea. Inicialmente la idea era poder almacenar objetos de forma pseudo-transparente en una base de datos relacional, pero también se ha extendido a algunas bases de datos de otra naturaleza.</li>
</ul>
<p>Las bases de datos orientadas a objetos estarían englobadas dentro de lo que se conoce como bases de datos <abbr title="Non SQL" lang="en">NoSQL</abbr>. Las bases de datos NoSQL pretenden escapar del tradicional modelo relacional, ofreciendo otros modelos de datos alternativos para gestionar la información. Dos de los tipos de bases de datos NoSQL más usados son las<strong> bases de datos documentales</strong> y las <strong>bases de datos clave-valor</strong>.</p>
<p>Hoy día es normal que en un almacén de datos de una organización existan varios tipos de bases de datos, aprovechando así las capacidades que aporta cada una de ellas.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id147">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id147-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta147_135" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b147" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b147" class="block iDevice_content">
<p><strong>El objetivo de cualquier almacén de datos es reducir desfase objeto-relacional.</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b147"><input type="radio" name="option0b147" id="true0b147" class="exe-radio-option exe-radio-option-0-2-0b147-truefalse"> Verdadero</label> 
<label for="false0b147"><input type="radio" name="option0b147" id="false0b147" class="exe-radio-option exe-radio-option-1-2-0b147-truefalse"> Falso</label>
</p>
</form>
<div id="s0b147" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b147-result" class="wrong">Falso</strong></p>
<p>No es completamente cierto, los&nbsp;<strong><acronym title="Sistema Gestor de Bases de Datos Relacional.">SGDBR</acronym></strong> no persiguen ese objetivo.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.1.- ¿Qué son las bases de datos orientadas a objetos?</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id109">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id109-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta109_73" class="block iDevice_content">
<div class="elemento_izquierda">
<div class="elemento_centrado"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/PROG11_CONT_R26_googleEarth.jpg" target="_blank" title="Ampliar imagen " programa="" googleearth".="" (se="" abre="" en="" una="" nueva="" ventana)"=""><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/PROG11_CONT_R26_googleEarth_miniatura.jpg" alt="Foto de una pantalla de ordenador mostrando  una aplicación informática en la que se visualiza el programa Google Earth." title="Programa GoogleEarth" class="imagen_ampliable" width="200" height="160"></a></div>
<div class="elemento_centrado credenciales"><a class="cc-by-nc-sa" title="Acceder a la licencia CC BY-NC-SA. (Se abre en una nueva ventana)" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.es" target="_blank"><span class="transparente">CC by-nc-sa</span></a>&nbsp;<a title="Acceder a la imagen " programa="" googleearth"="" de="" "agustín="" díaz"="" en="" flickr.="" (se="" abre="" una="" nueva="" ventana)"="" href="http://www.flickr.com/photos/yonmacklein/22105978/" target="_blank">Agustín Díaz.</a></div>
</div>
<p>¿Cómo son las aplicaciones actuales?</p>
<p>La aplicaciones de hoy día tienden a crecer de forma exponencial, no como las aplicaciones de antaño, donde la estructura de datos variaba poco o sufría pocos cambios.&nbsp; Hoy día, tenemos que estar preparados para desarrollar aplicaciones que evolucionan rápidamente, y donde almacenar objetos multimedia, como imágenes o sonidos, sea relativamente sencillo.</p>
<p>Hablamos de aplicaciones con estructuras de datos complejas y relaciones que son factibles a nivel de programación orientada a objetos, pero complejas de llevar a la práctica en una base de datos relacional.</p>
<p>Para solucionar este problema, han surgido multitud de alternativas, como se ha visto con anterioridad. Una de las más notables, por su respercusión académica, han sido las <strong>Bases de Datos Orientadas a Objetos</strong> (<acronym title="Bases de Datos Orientadas a Objetos.">BDOO</acronym>) o Bases de Objetos.</p>
<p>Estas se integran directamente y sin problemas con las aplicaciones desarrolladas en lenguajes orientados a objetos, ya que <strong>soportan un modelo de objetos puro</strong> y son ideales para almacenar y recuperar datos complejos permitiendo a los usuarios su <a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#t96616a0e-4e04-2847-a2d6-8981858766d2" id="link96616a0e-4e04-2847-a2d6-8981858766d2" class="exe-tooltip definition-tt titled-tt" title="Navegación | Ver la definición de Navegación">navegación</a>&nbsp;directa (sin un mapeo entre distintas representaciones).</p>
<div class="exe-figure exe-image float-right license-pd" style="width: 188px;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/PROG11_CONT_R28_ventajaBDOO.jpg" title="Ampliar imagen " características="" de="" las="" bases="" objetos".="" (se="" abre="" en="" una="" nueva="" ventana)"=""><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/PROG11_CONT_R28_ventajaBDOO_miniatura.jpg" width="188" height="160" alt="Dibujo que representa con tres rectángulos una base de objetos, un servidor y una aplicacición en una columna, y de abajo arriba. Otra columna paralela muestra dibujos de una rede de objetos tanto a nivel de la plicación como de la base de datos." title="Características de las bases de objetos" class="imagen_ampliable" style="float: right;"></a>
<div class="figcaption"><span class="author">Elaboración propia.</span> <span class="license"><span class="sep">(</span><span>Dominio público</span><span class="sep">)</span></span><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/PROG11_CONT_R28_ventajaBDOO.jpg" title="Ampliar imagen " características="" de="" las="" bases="" objetos".="" (se="" abre="" en="" una="" nueva="" ventana)"=""></a></div>
</div>
<p><strong><br>En una <acronym title="Base de datos orientada a objetos.">BDOO</acronym>, los datos se almacenan como objetos</strong>. Un <strong>objeto</strong> es, al igual que en la programación orientada a objetos, una entidad que se puede identificar unívocamente y que describe tanto el <a class="exe-tooltip definition-tt titled-tt glosario" id="linka8b3aec0-b86e-23ff-c038-42242c2689bd" href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#ta8b3aec0-b86e-23ff-c038-42242c2689bd" title="Estado | Ver la definición de Estado">estado</a> como el <a class="exe-tooltip definition-tt titled-tt glosario" id="link1514d806-0a82-f94f-fdc9-70997e05fcc9" href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#t1514d806-0a82-f94f-fdc9-70997e05fcc9" title="Comportamiento | Ver la definición de Comportamiento">comportamiento</a> de una entidad del "mundo real". El estado de un objeto se describe mediante atributos y su comportamiento es definido mediante procedimientos o métodos.</p>
<p><strong>Las <acronym title="Base de datos orientada a objetos.">BDOO</acronym> soportan características propias de la orientación a objetos, como agregación, encapsulamiento, polimorfismo y herencia.</strong> Los objetos pueden tener una complejidad arbitraria, a fin de contener toda la información necesaria que describe el objeto.</p>
<p>Todo esto hace que las <acronym title="Base de datos orientada a objetos.">BDOO</acronym> sean, en esencia, el sueño de cualquier programador o programadora. Sin embargo, a pesar de sus bondades y de los años, no han logrado imponerse en el mercado, los motivos principales son:</p>
<ul class="lista_verificacion">
<li><strong>Carencia de un modelo de datos universal</strong>. No hay ningún modelo de datos aceptado universalmente, y la mayor parte de los modelos carecen de una base teórica.</li>
<li><span style="left: 538.2px; top: 516.984px; font-size: 17.6033px; font-family: sans-serif; transform: scaleX(0.937427);"></span><span style="left: 508.198px; top: 697.71px; font-size: 16.7px; font-family: sans-serif; transform: scaleX(0.974461);"></span><strong>No hay un lenguaje de consulta común a todas las <acronym title="Base de datos orientada a objetos.">BDOO</acronym></strong>. A pesar de que incluso la <acronym title="Object Data Management Group" lang="en">ODMG</acronym> se esforzó por estandarizar <acronym title="Object Query Language" lang="en">OQL</acronym> (<span lang="en">Object Query Language</span>), dicho lenguaje de consulta no está disponible en muchas <acronym title="Base de datos orientada a objetos.">BDOO</acronym>. <acronym title="Object Query Language" lang="en">OQL</acronym> no tiene el mismo respaldo que <acronym title="Structured Query Language" lang="en">SQL </acronym>y las empresas detrás de cada <acronym title="Base de datos orientada a objetos.">BDOO </acronym>ofrecen sus propias alternativas.</li>
<li><strong>Competencia con los modelos ya asentados</strong>. Las bases de datos relacionales y objeto-relacionales están muy asentadas y extendidas. Además, las soluciones de mapeado objeto-relacional se han hecho fuertes, y ahora permiten hacer aplicaciones que se desarrollan rápido y que crecen con rapidez.</li>
<li><strong>Aparición de otros modelos de bases de datos NoSQL más sencillos y flexibles. </strong>Hoy día es común escuchar hablar de bases de datos documentales tales como <span lang="en">MongoDB</span> o de bases de datos clave-valor como Redis, que han ocupado el espacio destinado a las bases de datos orientadas a objetos. La flexibilidad y escalabilidad de estos modelos de datos han desplazado a las bases de datos orientadas a objetos.</li>
</ul>
<div class="elemento_derecha">&nbsp;</div>
<div id="ta8b3aec0-b86e-23ff-c038-42242c2689bd" class="exe-tooltip-text">
<p>El estado de un objeto es el conjunto de valores que toman sus propiedades (atributos y relaciones).</p>
</div>
<div id="t1514d806-0a82-f94f-fdc9-70997e05fcc9" class="exe-tooltip-text">
<p>El comportamiento de un objeto se refiere al conjunto de operaciones que se pueden realizar sobre un objeto.</p>
</div>
<div id="t96616a0e-4e04-2847-a2d6-8981858766d2" class="exe-tooltip-text">
<p>Se refiere en el contexto de orientación a objetos, a descender por los diferentes nodos de la red o grafo de objetos.</p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id80">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id80-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta80_47" class="block iDevice_content">
<p>En el siguiente enlace puedes visitar un <span lang="en">ranking </span>con los motores de base de datos más usados hoy día.</p>
<p class="enlace_centrado"><a class="html" title="Acceder a la web con el ranking actualizado de los motores de bases de datos más usados hoy día. (Se abre en una nueva ventana)" href="https://db-engines.com/en/ranking" target="_blank" hreflang="en"><span lang="en">Ranking</span> de motores de bases de datos más usados.</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper SeleccionmultiplefpdIdevice em_iDevice" id="id97">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id97-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div class="question">
<div id="actitity-97_55">
<form name="multi-select-form-97_55" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form multi-select-form">
<h3 class="js-sr-av">Pregunta</h3>
<div id="taquestion97_55" class="block question iDevice_content">
<p>
<strong>Señala las opciones correctas. Las bases de datos orientadas a objetos:</strong>
</p>

</div>
<div class="iDevice_answers">
<h4 class="js-sr-av">Respuestas</h4>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op97_550" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-97_58">Opción 1</a></label><input type="checkbox" id="op97_550" value="True">
</p>
<div class="iDevice_answer-content" id="answer-97_58"><a name="answer-97_58" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans97_58" class="block iDevice_content">
<p>Soportan conceptos de orientación a objetos como la herencia.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-97_550" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op97_551" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-97_85">Opción 2</a></label><input type="checkbox" id="op97_551" value="True">
</p>
<div class="iDevice_answer-content" id="answer-97_85"><a name="answer-97_85" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans97_85" class="block iDevice_content">
<p>Permiten la manipulación navegacional.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-97_551" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op97_552" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-97_87">Opción 3</a></label><input type="checkbox" id="op97_552" value="False">
</p>
<div class="iDevice_answer-content" id="answer-97_87"><a name="answer-97_87" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans97_87" class="block iDevice_content">
<p>Tienen el mismo tipo de problemas que las relacionales para gestionar objetos complejos.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-97_552" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op97_553" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-97_89">Opción 4</a></label><input type="checkbox" id="op97_553" value="True">
</p>
<div class="iDevice_answer-content" id="answer-97_89"><a name="answer-97_89" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans97_89" class="block iDevice_content">
<p>Cada objeto se puede identificar unívocamente.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-97_553" style="display:none"></div>
</div>
</div>
<div class="block iDevice_buttons feedback-button js-required">
<p>
<input type="button" name="submitSelect" class="feedbackbutton multi-select-feedback-toggler" value="Mostrar retroalimentación" id="multi-select-feedback-toggler-4-97_55"> 
</p>
</div>
<div id="f97_55" class="js-hidden js-feedback" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>

<div id="tafeedback97_55" class="feedback iDevice_content">
<p>Las bases de datos orientadas a objetos permiten usar conceptos de programación orientada a objetos como la herencia. Además permiten la manipulación navegacional donde cada objeto se puede identificar unívocamente.</p>
</div>
</div>
</form>
<div class="iDevice_solution feedback js-hidden">
<h4>Solución</h4>
<ol>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-97_58" class="right">Correcto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-97_85" class="right">Correcto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-97_87" class="wrong">Incorrecto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-97_89" class="right">Correcto</a></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id108">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id108-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta108_54" class="block iDevice_content">
<strong>Señala si la siguiente afirmación es verdadera o falsa.</strong>

</div>
<div class="question">
<form name="true-false-form-0b108" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b108" class="block iDevice_content">
<p><strong>En una <acronym title="Base de Datos Orientada a Objetos">BDOO</acronym> el resultado de una consulta son objetos, por lo que no es necesario reensamblar los objetos cada vez que se accede a la base de datos.</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b108"><input type="radio" name="option0b108" id="true0b108" class="exe-radio-option exe-radio-option-0-2-0b108-truefalse"> Verdadero</label> 
<label for="false0b108"><input type="radio" name="option0b108" id="false0b108" class="exe-radio-option exe-radio-option-1-2-0b108-truefalse"> Falso</label>
</p>
</form>
<div id="s0b108" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b108-result" class="right">Verdadero</strong></p>
Es verdadero, precisamente ésta es una de las ventajas de estos sistemas de almacenamiento.

</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.2.- ¿Qué es el mapeado de objetos?</h1></div></div>
<div class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id114">
<div class="iDevice emphasis_casopracticofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id114-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta114_66" class="block iDevice_content">
<div class="exe-figure exe-image float-left license-copyright" style="width: 200px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/CASO_PERSONAJES_09.1.jpg" alt="Ana mirando de frente." title="Ana." style="float: left;" width="200" height="134">
<div class="figcaption"><span class="author">Ministerio de Educación. Uso educativo-nc. Elaboración propia.</span></div>
</div>
<p><strong><br><span>María</span></strong><span> está liada tratando de resolver un problema en la aplicación que están haciendo, cuando <strong>Juan</strong> llega y le comenta:<br></span></p>
<p><span><span>—</span>¿Sabes lo que me ha dicho <strong>Antonio</strong>? Que ha empezado a usar <acronym title="Java Persistence API" lang="en">JPA</acronym> en uno de sus proyectos.</span></p>
<p><span><span>—</span>Pues en eso estaba pensando ahora <span>—</span>replica <strong>María</strong>. Ahora que ya hemos cubierto una primera etapa de la aplicación, me he dado cuenta de que hacer que crezca la aplicación es complicado. He pensado en meter más información en la base de datos, como por ejemplo la posibilidad de que cada compra se envíe a casa, y me estoy dando cuenta de que la cantidad de código que hay que modificar es enorme. </span></p>
<p><span><span>—</span>Sí, la verdad es que tienes razón. Cualquier modificación supone ahora navegar por un montón de líneas de código para buscar qué hay que cambiar aquí y allí. Creo que deberíamos contemplar otras opciones que hagan el trabajo más productivo, así podremos centrarnos en otros aspectos de la aplicación que no solo sea guardar datos.</span></p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id113">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id113-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta113_154" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-pd" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/MapeoDeDatos.png" width="250" height="250" alt="Ilustración esquemática de una bola del mundo, sobre la que hay una lupa de búsqueda, y un icono de localización en mapa." title="Mapeo de objetos" style="float: right;">
<div class="figcaption"><a href="https://pixabay.com/es/vectors/ubicaci%C3%B3n-la-tierra-mapa-mundo-4496459/" target="_blank" class="author" title="Acceder a la imagen  " mapeo="" de="" objetos",="" "megan_rexazin",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">Megan_Rexazin</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>¿Te atreverías a usar una base de datos orientada a objetos en tu proyecto?<span style="background-color: #ffffff;"> </span></p>
<p><span style="background-color: #ffffff;">Con la perspectiva dada en apartados anteriores, seguro que estás dudando.</span> Hay que valorar mucho la base de datos a usar hoy día, analizar bien sus pros y sus contras, especialmente si vamos a vincular&nbsp; nuestro <span lang="en">software</span> a una misma base de datos "de por vida".</p>
<p>No obstante, todavía tenemos una alternativa, flexible y relativamente sencilla para persistir objetos: usar técnicas de <strong>mapeado de objetos</strong>. <span style="background-color: #ffffff;">Ahora seguro que te preguntarás, ¿qué tiene que ver esto con las bases de datos orientadas a objetos? ¿Es posible utilizar el mapeado de objetos con bases de datos orientadas a objetos? ¿No se supone que una base de datos orientada a objetos ya pueden almacenar objetos directamente?</span></p>
<p><span style="background-color: #ffffff;">Efectivamente es así, no es necesario un mapeado de objetos en tal caso. Pero el mapeado de objetos aporta dos ventajas clave:</span></p>
<ul class="lista_verificacion">
<li><strong>Podemos cambiar la base de datos que se está utilizando sin tener que aferrarnos a una de por vida.</strong> Si escogemos la solución de mapeado de objetos adecuada, podemos elegir entre múltiples bases de datos relacionales, e incluso optar por algunas orientadas a objetos y de otros tipos.</li>
<li><strong>Usamos siempre las mismas técnicas para almacenar los objetos</strong>, independientemente de la base de datos usada.</li>
</ul>
<p>El mapeado de objetos aporta por tanto ciertas ventajas que no se deben menospreciar y permiten almacenar objetos directamente; y ese es el objetivo real de la persistencia de objetos, ¿verdad?</p>
<p>El mapeado de objetos se consigue a través de librerías y <a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#t5b237332-4ad0-5a2b-03bb-8adc3fcc995e" id="link5b237332-4ad0-5a2b-03bb-8adc3fcc995e" title="Framework | Ver la definición de framework" class="exe-tooltip definition-tt titled-tt"><span lang="en">frameworks</span></a> específicos. Este tipo de técnicas se denominan "Mapeado Objeto-Relacional" (<acronym title="Object-Relational Mapping" "="" lang="en">ORM</acronym>, son las siglas en inglés), porque están fuertemente ligadas a permitir persistir objetos de forma sencilla en bases de datos relacionales. Las bases de datos relacionales siguen siendo las más usadas con notable diferencia y eso hay que tenerlo en cuenta.</p>
<p>En <span lang="en">Java</span>, tenemos la suerte de contar con un <span lang="en">framework</span> de persistencia de objetos muy bueno conocido como <acronym title="Java Persistencie API" lang="en">JPA</acronym> (<span lang="en">Java Persistence</span> <acronym title="Application Programming Interface" lang="en">API</acronym>). Este <span lang="en">framework</span>, que se explicará y desarrollará en los apartados siguientes, persigue lo mismo que otros <acronym title="Object-Relational Mapping" "="" lang="en">ORM</acronym>, y se fundamenta como verás en el modelo Entidad-Relación.</p>
<p>Su estructura es tal que puede usarse con innumerables bases de datos relacionales. Pero es tan flexible que puede incluso usarse con algunas bases de datos orientadas a objetos tales como <span lang="en">InterSystem Caché</span> y <span lang="en">ObjectDB</span>, e incluso con bases de datos documentales tales como <span lang="en">MongoDB</span>, además de con otros modelos de bases de datos <abbr title="Non SQL" lang="en"><span>NoSQL</span></abbr>.</p>
<p>Para <span lang="en">Java</span>, aparte de <acronym title="Java Persistencie API" lang="en">JPA</acronym>, existe otro <span lang="en">framework </span>de persistencia de objetos: <acronym title="Java Data Objects" lang="en">JDO</acronym> (<span lang="en">Java Data Objects</span>). <acronym title="Java Data Objects" lang="en">JDO</acronym> es un <span lang="en">framework</span> más ambicioso que <acronym title="Java Persistencie API" lang="en">JPA</acronym>, dado que la idea del mismo es permitir almacenar objetos en cualquier almacén de datos, independientemente del tipo, se trate de una base de datos relacional o de cualquier otro modelo.&nbsp;</p>
<p>Sin embargo, aunque&nbsp;<acronym title="Java Data Objects">JDO</acronym> parezca el <span lang="en">framework </span>ideal para persistir datos, la realidad es que <acronym title="Java Persistencie API">JPA</acronym> es el <span lang="en">framework</span> más usado y extendido con diferencia, y ese es el motivo por el que vamos a profundizar en él.</p>
<div id="t5b237332-4ad0-5a2b-03bb-8adc3fcc995e" class="exe-tooltip-text">
<p>En el campo del desarrollo de <span lang="en">software</span>, la palabra <span lang="en">framework</span> hace referencia a un conjunto de elementos tecnológicos pensados o diseñados para resolver algún tipo de problema o situación muy habitual dentro del <span lang="en">software</span>. Los <span lang="en">frameworks</span> comúnmente requieren estructurar y organizar el código de determinada forma, siguiendo una serie de pautas, y habitualmente, requieren el uso de un conjunto de librerías o componentes diseñados específicamente con el objetivo de dar soporte al problema o situación habitual que se pretende resolver.</p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id116">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id116-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta116_128" class="block iDevice_content">
<p>A continuación te ofrecemos una serie de páginas que pueden serte de interés si quieres profundizar en <acronym title="Java Data Objects" lang="en">JDO</acronym>, dado que no será tratado en esta unidad:</p>
<p style="text-align: center;"><a href="https://db.apache.org/jdo/index.html" title="Acceder a la web oficial de Apache de JDO. (Se abre en una nueva ventana)" target="_blank" class="html" hreflang="en">Página oficial de Apache del proyecto <acronym title="Java Data Objects">JDO</acronym>.</a></p>
<p style="text-align: center;"><a href="https://db.apache.org/jdo/jdo_v_jpa.html" title="Acceder a tabla comparativa entre JDO y JPA.  (Se abre en una nueva ventana)" target="_blank" class="html" hreflang="en">Tabla comparativa entre <acronym title="Java Persistencie API">JPA</acronym> y <acronym title="Java Data Objects">JDO</acronym>.</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id117">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id117-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta117_128" class="block iDevice_content">
<p>A continuación te ofrecemos un enlace que ilustra los almacenes de datos soportados por <span lang="en">Datanucleus</span>, algunos almacenes de datos verás que son bases de datos relacionales y otros no. <span lang="en">Datanucleus</span> es una de las muchas implementaciones de <acronym title="Java Persistence API" lang="en">JPA</acronym> y <acronym title="Java Data Objects" lang="en"><span>JDO</span></acronym> existentes en el mercado:</p>
<p style="text-align: center;"><a href="https://www.datanucleus.org/products/accessplatform_5_0/datastores/datastores.html" title="Acceder a la tabla con las bases de datos soportadas por DataNucleus. (Se abre en una nueva ventana)" target="_blank" class="html">Almacenes de datos soportados por <span title="Acceder a la tabla con las bases de datos soportadas por DataNucleus." lang="en">DataNucleus</span> en la versión 5</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.3.- ¿Cómo empiezo a usar JPA?</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id68">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id68-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta68_154" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/space-shuttle-774_640.jpg" alt="Imagen que muestra una nave espacial de la NASA despegando." title="¡¡Despegamos!!" style="float: right;" width="250" height="166">
<div class="figcaption"><a href="https://pixabay.com/es/photos/transbordador-espacial-cohete-774/" target="_blank" class="author" title="Acceder a la imagen  " ¡¡despegamos!!",="" de="" "nasa-imagery",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">NASA-Imagery</a>.&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>Seguro que ahora te estás preguntando por dónde empezar si quieres hacer un proyecto que use <acronym title="Java Persistence API" lang="en">JPA</acronym>. Pues vamos a ello. Pero antes hay un par de cosas que debes saber sobre <acronym title="Java Persistence API" lang="en">JPA</acronym>.</p>
<p>La primera es que <acronym title="Java Persistence API" lang="en">JPA</acronym> engloba un conjunto de librerías incluidas tanto en <span lang="en">Java</span> <acronym title="Standard Edition" lang="en">SE</acronym> como en <span lang="en">Java</span> <acronym title="Enterprise Edition" lang="en">EE</acronym>, esto quiere decir que si tenemos instalado en nuestro equipo un <acronym title="Java Development Kit" lang="en"><span title="Java Development Kit">JDK</span></acronym>, ya tenemos <acronym title="Java Persistence API" lang="en">JPA</acronym>. <acronym title="Java Persistence API" lang="en">JPA</acronym> contiene un conjunto de clases, conocidas como <strong><acronym title="Java Persistence API" lang="en">JPA</acronym> <acronym title="Application Programming Interface" lang="en">API</acronym></strong>, que son las que usaremos para persistir datos. Usaremos siempre las mismas clases y métodos independientemente del almacén de datos donde estemos almacenando la información.</p>
<p>La segunda cosa que debes saber es que <acronym title="Java Persistence API" lang="en">JPA</acronym> no funciona solo. Obviamente se necesitará un almacén de datos para almacenar la información (<span lang="en">MySQL</span>, H2, <abbr title="etcétera">etc.</abbr>), pero también necesitaremos lo que denominamos un <strong>proveedor de persistencia</strong>. El proveedor de persistencia, también llamado <strong>motor de persistencia</strong> e <strong>implementación de <acronym title="Java Persistence API" lang="en">JPA</acronym></strong>, es una librería que implementa en su interior la lógica de funcionamiento real de <acronym title="Java Persistence API" lang="en">JPA</acronym>.</p>
<p><acronym title="Java Persistence API" lang="en">JPA </acronym>es solo una fachada que usaremos en nuestro programa, de forma que siempre usemos las mismas clases y métodos, pero quien hará el "trabajo sucio" será el proveedor de persistencia. Existen muchos proveedores de persistencia, es decir, muchas implementaciones de <acronym title="Java Persistence API" lang="en">JPA</acronym>, entre las que podemos destacar <acronym lang="en"><span lang="en"></span></acronym><span lang="en"><span lang="en"></span></span><span lang="en"><span lang="en"><span lang="en">Hibernate</span></span>, <span lang="en">TopLink</span>, <span lang="en">DataNucleus AccessPlatform</span></span><span lang="en"></span> y <span lang="en">EclipseLink</span>. De todas las anteriores usaremos <span lang="en">EclipseLink</span>, no por ser la mejor, sino por ser la <a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#ta7e5d8e9-29c2-3308-0858-701ce8a7c50c" id="linka7e5d8e9-29c2-3308-0858-701ce8a7c50c" class="exe-tooltip definition-tt titled-tt">implementación de referencia</a>.</p>
<p>Y ahora vamos al meollo de la cuestión: <strong>cómo usar <acronym title="Java Persistence API" lang="en">JPA</acronym> en un proyecto<span lang="en">NetBeans</span></strong>. Lo primero que haremos será crear un proyecto como de costumbre, y a continuación, indicarle que necesitaremos una librería específica, la de <span lang="en">EclipseLink</span>:</p>
<div class="exe-figure exe-image position-center" style="width: 300px;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/dibujo_insertar_libreria_eclipselink.png" title="Ampliar imagen " pasos="" para="" incluir="" eclipselink="" en="" un="" proyecto="" netbeans.".="" (se="" abre="" una="" nueva="" ventana)"="" target="_blank"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/dibujo_insertar_libreria_eclipselink_mini.png" alt="Imagen que ilustra el proceso de incorporación de EclipseLink a un proyecto NetBeans. En primer lugar la imagen indica que hay que seleccionar la opción añadir librería, después, se muestra como se selecciona la librería EclipseLink y se pulsa el botón añadir. Posteriormente, aparecen todos los archivos jar necesarios en la lista de archivos." title="Pasos para incluir EclipseLink en un proyecto NetBeans." class="imagen_ampliable" width="297" height="97"></a>
<div class="figcaption"><span class="title"><em>Elaboración propia. Pasos para incluir <span lang="en">EclipseLink</span> en proyecto <span lang="en">NetBeans</span>.</em></span></div>
</div>
<p>Como se muestra en la imagen anterior, simplemente hay que ir a las librerías del proyecto, seleccionar la opción <em><span lang="en">Add Library</span></em> (añadir librería), después seleccionar la librería <em><span lang="en">EclipseLink</span> (<span title="Java Persistence API" lang="en">JPA</span> 2.1)</em> y hacer clic en el botón <em><span lang="en">Add Library</span></em> (añadir librería) de la ventana emergente.</p>
<p>Añadir las librerías del proveedor de persistencia sería lo primero, lo segundo es añadir el archivo&nbsp;persistence.xml. Se trata de un archivo que cualquier aplicación que utilice <acronym title="Java Persistence API" lang="en">JPA</acronym>, ya sea <span lang="en">Java</span> <acronym title="Enterprise Edition" lang="en">EE</acronym> o <span lang="en">Java</span> <acronym title="Standard Edition" lang="en">SE</acronym>, necesitará tener. Este archivo contendrá la configuración necesaria para poder persistir objetos en el almacén de datos.</p>
<p>Para empezar, vamos a partir de un archivo persistence.xml como el siguiente. Como ya imaginas es un archivo <acronym title="Extensible Markup Language" lang="en">XML</acronym> que todavía no contiene gran cosa:</p>
<div class="highlighted-code language-markup">
<div>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.1" xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
 
&lt;/persistence&gt;</pre>
</div>
</div>
<p>Dentro de la etiqueta &lt;persistence&gt;...&lt;/persistence&gt; irémos añadiendo la información necesaria para usar <acronym title="Java Persistence API" lang="en">JPA</acronym>, tal y como veremos en próximos apartados. Este archivo debe ir incluido en el programa a distribuir al usuario final, es decir, debe ir dentro del archivo .jar que entregaremos al cliente. Para lograr esto es necesario crear el archivo persistence.xml en la carpeta&nbsp; META-INF, tal y como muestran las siguientes imágenes:</p>
<div class="texto_centrado">
<div style="width: 40%; display: inline-block;">
<div class="exe-figure exe-image license-pd position-center" style="width: 268px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/DondeDebeEstarPersistenceXML.png" alt="Ejemplo de localización del archivo persistence.xml en NetBeans." title="Vista de un proyecto NetBeans Java SE con un archivo persistence.xml." width="268" height="160"><br>
<div class="figcaption"><span class="author">Salvador Romero Villegas</span>. <span class="title"><em>Vista de un proyecto <span lang="en">NetBeans Java</span> <acronym title="Standard Edition" lang="en">SE</acronym> con un archivo persistence.xml.</em></span> <span class="license"><span class="sep">(</span><span>Dominio público</span><span class="sep">)</span></span></div>
</div>
</div>
<div style="width: 40%; display: inline-block;">
<div class="exe-figure exe-image license-pd position-center" style="width: 254px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/DondeDebeEstarPersistenceXML_carpeta.png" alt="Imagen que muestra la estructura de carpetas de un proyecto NetBeans, y en cual de ellas está el archivo persistence.xml. En la imagen se ve cómo el archivo persistence.xml aparece dentro de la carpeta META-INF que está en la carpeta src." title="Vista de las carpetas de un proyecto NetBeans, y en cuál de ellas exactamente está el archivo persistence.xml." width="254" height="215">
<div class="figcaption"><span class="author">Salvador Romero Villegas</span>. <span class="title"><em>Vista de las carpetas de un proyecto <span lang="en">NetBeans</span>, y en cuál de ellas exactamente está el archivo persistence.xml.</em></span> <span class="license"><span class="sep">(</span><span>Dominio público</span><span class="sep">)</span></span></div>
</div>
</div>
</div>
<p></p>
<div id="ta7e5d8e9-29c2-3308-0858-701ce8a7c50c" class="exe-tooltip-text">
<p>En el mundo del <span lang="en">software</span> se denomina implementación de referencia al <span lang="en">software</span> que sirve de modelo para otras implementaciones. Normalmente, el resto de desarrolladores se basan en la implementación de referencia para realizar sus propias mejoras.</p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper DestacadofpdIdevice" id="id150">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id150-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div class="iDevice_destacadofpd">
<div id="ta150_151" class="block iDevice_content">
<p><strong>Aparte de instalar el proveedor de persistencia es necesario instalar también el <span lang="en">driver</span> o controlador de la base de datos a utilizar. Es un proceso que no se explica aquí porque ya se explicó en la primera parte de esta unidad.</strong></p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id149">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id149-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta149_135" class="block iDevice_content">
<p><strong lang="en">Indica si la siguiente afirmación es verdadera o falsa:</strong></p>
</div>
<div class="question">
<form name="true-false-form-0b149" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b149" class="block iDevice_content">
<p>"El archivo&nbsp;persistence.xml contiene tanto la información como la localización de la&nbsp;<acronym title="Application Programming Interface" lang="en">API</acronym> de <acronym title="Java Persistence API" lang="en">JPA</acronym><acronym></acronym><acronym title="Java Delopment Kit" lang="en"></acronym>."</p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b149"><input type="radio" name="option0b149" id="true0b149" class="exe-radio-option exe-radio-option-0-2-0b149-truefalse"> Verdadero</label> 
<label for="false0b149"><input type="radio" name="option0b149" id="false0b149" class="exe-radio-option exe-radio-option-1-2-0b149-truefalse"> Falso</label>
</p>
</form>
<div id="s0b149" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b149-result" class="wrong">Falso</strong></p>
<p>Es falso. La&nbsp;<acronym title="Application Programming Interface" lang="en">API</acronym> de <acronym title="Java Persistence API" lang="en">JPA</acronym> ya va incluida en el <acronym title="Java Development Kit" lang="en">JDK</acronym>. El objetivo de ese archivo es aportar la configuración necesaria para poder persistir objetos en el almacén de datos.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.4.- Unidades de persistencia (I)</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id66">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id66-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta66_154" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-pd" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/jpa_vagon.png" alt="Imagen que muestra la interfaz gráfica de configuración de la unidad de persistencia en NetBeans con adornos." title="Configurar la unidad de persistencia en NetBeans." width="250" height="127">
<div class="figcaption"><span class="author">Salvador Romero Villegas. Elaboración propia.</span> <span class="license"><span class="sep">(</span><span>Dominio público</span><span class="sep">)</span></span></div>
</div>
<p>Con <acronym title="Java Persistence API" lang="en">JPA</acronym> aparece un concepto nuevo muy importante, el concepto de <strong>unidad de persistencia</strong>. La idea de <acronym title="Java Persistence API" lang="en">JPA</acronym> es, como ya se ha explicado, poder almacenar de forma sencilla objetos (y la información que contienen) en un almacén de datos. Pero, ¿qué objetos podrán ser almacenables en dicho almacén? ¿Cómo indico qué objetos podrán ser almacenados y cuáles no? ¿Cómo indico en qué almacén de datos se deberán almacenar los objetos?</p>
<p>Toda esa información es lo que llamamos la unidad de persistencia. Por tanto:</p>
<ul class="lista_verificacion">
<li>La<strong> unidad de persistencia incluye qué objetos serán persistentes</strong>. Estos objetos los llamaremos <strong>entidades</strong>.</li>
<li>La <strong>unidad de persistencia incluye dónde persistirá la información</strong>, es decir, en qué base de datos.</li>
<li>La <strong>unidad de persistencia incluye qué proveedor de persistencia se usará</strong>.</li>
</ul>
<p>Esta información se indica en dos lugares. En primer lugar, en el archivo&nbsp;persistence.xml donde indicaremos parte de la información, y el resto en nuestro código <span lang="en">Java</span>. Cada unidad de persistencia tendrá su propia sección en el archivo de configuración persistence.xml, por ejemplo:</p>
<div class="highlighted-code language-markup">
<div>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.1" xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
  &lt;persistence-unit name="EjemplosJPA" transaction-type="RESOURCE_LOCAL"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;class&gt;minipos.model.LineaTicket&lt;/class&gt;
    &lt;class&gt;minipos.model.DireccionEnvio&lt;/class&gt;
    &lt;class&gt;minipos.model.Producto&lt;/class&gt;
    &lt;class&gt;minipos.model.Ticket&lt;/class&gt;
  &lt;/persistence-unit&gt; 
&lt;/persistence&gt;</pre>
</div>
</div>
<p>Cada unidad de persistencia va definida con la etiqueta &lt;persistence-unit&gt;...&lt;/persistence-unit&gt;. En su interior, indicaremos qué configuración debe usarse para conectar a la base de datos, cuál será el proveedor de persistencia a usar, qué clases se podrán hacer persistentes, <abbr title="etcétera">etc</abbr>. Solo una porción de esta información debe indicarse aquí de forma obligatoria.</p>
<p>En el ejemplo anterior, se especifica el proveedor de persistencia a usar (&lt;provider&gt;...&lt;/provider&gt;), aunque no es obligatorio (<span style="background-color: #ffffff;">si no lo indicamos buscará una implementación en el CLASSPATH).</span> Como proveedor de persistencia se ha usado org.eclipse.persistence.jpa.PersistenceProvider, lo cual nos dice que la implementación de&nbsp;<acronym title="Java Persistence API" lang="en">JPA</acronym> usada en ese caso es <span lang="en">EclipseLink</span>.</p>
<p>Además del proveedor de persistencia, en el ejemplo anterior se indica qué objetos serán persistentes, a través de <strong>&lt;class&gt;...&lt;/class&gt;</strong>. Indicar las clases que podrán ser persistentes sí será obligatorio.</p>
<p class="destacado"><strong>Lo mínimo que debemos indicar en la unidad de persistencia es su nombre&nbsp; (name="EjemplosJPA") y las clases que serán persistentes (&lt;class&gt;...&lt;/class&gt;). </strong></p>
<p>Pero aquí faltarían cosas todavía para que <abbr title="Java Persistence API" lang="en">JPA</abbr> haga su magia.</p>
<ul class="lista_verificacion">
<li>¿Qué pasa con la información necesaria para conectar a la base de datos?</li>
<li>¿Dónde se indica la <acronym title="Uniform Resource Locator" lang="en">URL</acronym> de conexión, el <span lang="en">driver</span>, el usuario, el <span lang="en">password</span>, <abbr title="etcétera">etc.</abbr>?</li>
</ul>
<p>La verdad es que podremos indicar dicha información en el archivo anterior o bien por medio del programa. Es decir, podemos completar la información de la unidad de persistencia usando etiquetas <acronym title="Extensible Markup Language" lang="en">XML</acronym> o bien desde nuestro código en <span lang="en">Java</span>, sin necesidad de modificar el <acronym title="Extensible Markup Language" lang="en">XML</acronym>.</p>
<p>¿Y por dónde empiezo ahora?,&nbsp; te preguntarás.</p>
<p>Es sencillo: crea un archivo&nbsp;persistence.xml en la carpeta&nbsp;META-INF siguiendo el modelo anterior y échale un vistazo al ejemplo siguiente. <strong>Pero ¡cuidado!, no pongas todavía las clases a persistir (&lt;class&gt;...&lt;/class&gt;), eso lo haremos más adelante</strong>.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper DestacadofpdIdevice" id="id69">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id69-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div class="iDevice_destacadofpd">
<div id="ta69_151" class="block iDevice_content">
<p><strong>Una aplicación puede necesitar trabajar con datos de diferentes orígenes, por ejemplo, de diferentes bases de datos. Es por ello que podemos tener varias unidades de persistencia en un mismo archivo persistence.xml.</strong></p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id151">
<div class="iDevice emphasis_debesconocerfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id151-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta151_129" class="block iDevice_content">
<p>A continuación te ofrecemos dos proyectos base <span lang="en">NetBeans</span> que utilizan <acronym title="Java Persistence API" lang="en">JPA</acronym> con H2 y <span lang="en">MySQL</span> respectivamente, y donde la información necesaria para acceder al almacén de datos se proporciona a través del archivo persistence.xml.</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/UT10_ProyectoBase_JPA_H2_extra1.1.zip" class="paquete" title="Haz clic para descargar proyecto base 1 que utiliza JPA y H2.  Se abre en una nueva ventana [zip - 1856914 B]" target="_blank">Proyecto base tipo 1 que usa <acronym title="Java Persistence API" lang="en">JPA</acronym> con una base de datos H2.</a><span class="exe-link-data file-size"> (zip - 1856914 <abbr title="Bytes" lang="en">B</abbr>)</span></p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/UT10_ProyectoBase_JPA_MySQL_extra1.1.zip" title="Haz clic para descargar proyecto base 1 que utiliza JPA y MySQL. Se abre en una nueva ventana [zip - 2246995 B]" target="_blank" class="paquete">Proyecto base tipo 1 que usa <acronym title="Java Persistence API" lang="en">JPA</acronym> con una base de datos <span lang="en">MySQL</span>.</a><span class="exe-link-data file-size"> (zip - 2246995 <abbr title="Bytes" lang="en">B</abbr>)</span></p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id143">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id143-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta143_63" class="block story iDevice_content">
<p>La configuración de acceso a la base de datos puede indicarse a través de propiedades en la unidad de persistencia. Fíjate en el siguiente ejemplo, pensado para acceder a una base de datos H2.</p>
<div class="highlighted-code language-markup">
<div>
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.1" xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
  &lt;persistence-unit name="EjemplosJPA" transaction-type="RESOURCE_LOCAL"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;properties&gt;
      &lt;property name="javax.persistence.jdbc.url" value="jdbc:h2:./mibasededatos.h2db"/&gt;
      &lt;property name="javax.persistence.jdbc.user" value=""/&gt;
      &lt;property name="javax.persistence.jdbc.driver" value="org.h2.Driver"/&gt;
      &lt;property name="javax.persistence.jdbc.password" value=""/&gt;
      &lt;property name="javax.persistence.schema-generation.database.action" value="create"/&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;

</pre>
</div>
</div>
</div>
<div id="taquesQuestion0b143" class="block iDevice_content">
<p>¿Serías capaz de modificar el ejemplo anterior para acceder a una base de datos <span lang="en">MySQL</span>?</p>
</div>
<form name="feedback-form-quesFeedback0b143" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b143text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b143" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b143" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Supongo que más o menos intuyes cómo deberías indicar la configuración necesaria para acceder a la base de datos, veamos cómo podría ser un ejemplo para <span lang="en">MySQL</span>:</p>
<div class="highlighted-code language-markup">
<div>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.1" xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
  &lt;persistence-unit name="EjemplosJPA" transaction-type="RESOURCE_LOCAL"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;properties&gt;
      &lt;property name="javax.persistence.jdbc.url" value="jdbc:mysql://localhost:3306/ut10?serverTimezone=UTC"/&gt;
      &lt;property name="javax.persistence.jdbc.user" value="ut10"/&gt;
      &lt;property name="javax.persistence.jdbc.driver" value="com.mysql.cj.jdbc.Driver"/&gt;
      &lt;property name="javax.persistence.jdbc.password" value="ut10"/&gt;
      &lt;property name="javax.persistence.schema-generation.database.action" value="create"/&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
</div>
</div>
<p>El parámetro <code class="  language-markup">javax.persistence.schema-generation.database.action</code> con el valor <code class="  language-markup">create</code>, indicará a <acronym title="Java Persistence API" lang="en">JPA</acronym> que la base de datos debe crearse automáticamente si no existe.</p></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.4.1.- Unidades de persistencia (II)</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id70">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id70-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta70_154" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/industry-1140760_640.jpg" alt="Imagen que muestra una fábrica industrial." title="Factoría industrial." style="float: right;" width="250" height="188">
<div class="figcaption"><a href="https://pixabay.com/es/photos/industria-f%C3%A1brica-planta-industrial-1140760/" target="_blank" class="author" title="Acceder a la imagen  " factoría="" industrial.",="" de="" "ich="" bin="" dann="" mal="" raus="" hier",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">Ich bin dann mal raus hier.</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>Ya tenemos nuestro archivo persistence.xml, y ahora tenemos que dar el salto a <span lang="en">Java</span>. En <span lang="en">Java</span> tendremos dos clases importantes, cuya función es un poco complicada de entender al principio:</p>
<ul class="lista_verificacion">
<li>Clase EntityManagerFactory. Tendremos un EntityManagerFactory por cada unidad de persistencia que necesitemos usar. La función de esta clase es fundamentalmente la de encargarse de gestionar todas las conexiones al almacén de datos y facilitar así el almacenamiento de información. Por tanto, esta clase es el primer vínculo entre la unidad de persistencia (configuración) y el almacén de datos.</li>
<li>Clase EntityManager. Una vez que tenemos el&nbsp;EntityManagerFactory ya podremos crear uno o varios EntityManager, podremos crear tantos como necesitemos a lo largo del programa, no obstante <strong>en una aplicación de escritorio es suficiente con crear solo uno</strong>. Usaremos el&nbsp;EntityManager para guardar o rescatar información del almacén de datos.</li>
</ul>
<p class="destacado"><strong>Crear el EntityManagerFactory es una operación costosa y solo debe hacerse una vez. Se debe usar la misma instancia en todo el código de tu aplicación.</strong></p>
<p>El esquema básico de un programa que use <acronym title="Java Persistence API" lang="en">JPA</acronym> será el siguiente:</p>
<ul class="lista_verificacion">
<li>Crearemos un mapa (Map&lt;String,String&gt;) para indicar la información necesaria para conectar con la base de datos: <acronym title="Uniform Resource Locator" lang="en">URL</acronym>, <span lang="en">driver</span>, usuario, contraseña, <abbr title="etcétera">etc</abbr>. ¿Recuerdas que se dijo que esa información no era obligatorio indicarla en el archivo persistence.xml? Y así es, podemos indicarla por programa, lo cual tiene ciertas ventajas en aplicaciones de escritorio. Un ejemplo de propiedades para conectar a una base de datos H2 podría ser:</li>
</ul>
<div class="highlighted-code language-java">
<div>
<pre>Map&lt;String,String&gt; propiedades=new HashMap&lt;&gt;();

/* driver utilizado en esta conexión */
propiedades.put("javax.persistence.jdbc.driver", "org.h2.Driver");
/* URL para conectar a la base de datos*/
propiedades.put("javax.persistence.jdbc.url", "jdbc:h2:./mibasededatos_redif.h2db");
/* nombre de usuario para conectar */
propiedades.put("javax.persistence.jdbc.user", "");
/* password para necesario para conectar */
propiedades.put("javax.persistence.jdbc.password", "");
/* modelo de generación de base de datos */
propiedades.put("javax.persistence.schema-generation.database.action", "create"); </pre>
</div>
</div>
<ul class="lista_verificacion">
<li>Después, necesitaremos crear un EntityManagerFactory asociado a la unidad de persistencia configurada en el archivo&nbsp;persistence.xml (recuerda que cada unidad de persitencia tiene un nombre&nbsp;&lt;persistence-unit name="EjemplosJPA"&gt; , y debemos usarlo aquí):</li>
</ul>
<div class="highlighted-code language-java">
<div>
<pre>EntityManagerFactory emf=Persistence.createEntityManagerFactory("EjemplosJPA",propiedades);</pre>
</div>
</div>
<ul class="lista_verificacion">
<li>Una vez hayamos creado nuestro EntityManagerFactory, ya podemos empezar a crear uno o más EntityManager (aunque con uno nos bastará). Es tan fácil como hacer:</li>
</ul>
<div class="highlighted-code language-java">
<div>
<pre>EntityManager em=emf.createEntityManager();
</pre>
</div>
</div>
<p>El EntityManager tendrá los métodos necesarios para almacenar, rescatar, modifica y borrar. Parece fácil, ¿no?</p>
<p>Una vez que terminemos de usar el EntityManager, no debemos olvidar cerrarlo. Y cuando nuestro programa termine, debería cerrarse el EntityManagerFactory también, para cerrar apropiadamente cualquier conexión con la base de datos.</p>
<div class="highlighted-code language-java">
<div>
<pre>em.close();
emf.close();</pre>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id152">
<div class="iDevice emphasis_debesconocerfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id152-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta152_129" class="block iDevice_content">
<p>A continuación se proporcionan dos proyectos base nuevos, uno que utiliza como almacén de datos una base de datos <span lang="en">MySQL</span> y otro que utiliza una base de datos H2. A diferencia de los proyectos base proporcionados en el apartado anterior, en este caso, el acceso a la base de datos se configura por programa, y no a través del archivo persistence.xml.</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/UT10_ProyectoBase_JPA_H2.1.zip" title="Haz clic aquí para descargar proyecto base tipo 2 que usa JPA y H2. Se abre en una nueva ventana [zip - 1.77 MB]" target="_blank" class="paquete">Proyecto base tipo 2 que usa <acronym title="Java Persistence API" lang="en">JPA</acronym> con una base de datos H2.</a><span class="exe-link-data file-size"> (zip - 1.77 <abbr title="MegaBytes" lang="en">MB</abbr>)</span>.</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/UT10_ProyectoBase_JPA_MySQL.1.zip" title="Haz clic aquí para descargar proyecto base tipo 2 que usa JPA y MySQL. Se abre en una nueva ventana [zip - 2.17 MB]" target="_blank" class="paquete">Proyecto base tipo 2 que usa <acronym title="Java Persistence API" lang="en">JPA</acronym> con una base de datos <span style="text-align: center;" lang="en">MySQL</span>.</a><span class="exe-link-data file-size"> (zip - 2.17 <abbr title="MegaBytes" lang="en">MB</abbr>)</span></p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id144">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id144-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta144_63" class="block story iDevice_content">
<p>La aplicación de punto de venta trabajará con un almacén de datos diferente en función del cliente. La base de datos puede estar en la misma máquina o en otra. Por ello, el archivo&nbsp;persistence.xml que utilizarás será algo tan sencillo como:</p>
<div class="highlighted-code language-markup">
<div>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.1" xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
  &lt;persistence-unit name="EjemplosJPA" transaction-type="RESOURCE_LOCAL"&gt;
      
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;</pre>
</div>
</div>
<p>Aunque aquí, obviamente, faltaría por indicar las clases que son persistentes (&lt;class&gt;...&lt;/class&gt;), algo que haremos más adelante.</p>
</div>
<div id="taquesQuestion0b144" class="block iDevice_content">
<p>Basándote en los ejemplos de código anteriores y en el archivo&nbsp;persistence.xml dado, ¿podrías crear un proyecto <span lang="en">Java</span> que simplemente creará una instancia de EntityManager para conectar a una base de datos <span lang="en">MySQL</span>?</p>
</div>
<form name="feedback-form-quesFeedback0b144" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b144text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b144" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b144" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Para conectar con una base de datos <span lang="en">MySQL</span>, podríamos usar un código como el siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>public static void main(String[] args) {
        try {
            Map&lt;String,String&gt; propiedades=new HashMap&lt;&gt;();
            /* driver utilizado en esta conexión */
            propiedades.put("javax.persistence.jdbc.driver", "com.mysql.jcbc.Driver");
            /* URL para conectar a la base de datos*/
            propiedades.put("javax.persistence.jdbc.url", "jdbc:mysql://localhost/test");
            /* nombre de usuario para conectar */
            propiedades.put("javax.persistence.jdbc.user", "root");
            /* password para necesario para conectar */
            propiedades.put("javax.persistence.jdbc.password", "test");                      
            /* modelo de generación de base de datos */
            propiedades.put("javax.persistence.schema-generation.database.action", "create");             
                         
            EntityManagerFactory emf=Persistence.createEntityManagerFactory("EjemplosJPA",propiedades);
            EntityManager em=emf.createEntityManager();
            
            if (em.isOpen())
            {
                System.out.println("EntityManager con conexión abierta.");
            }
            else
            {
                System.out.println("EntityManager sin conexión.");
            }
            
            em.close();
            emf.close();
        } catch (PersistenceException pe) {
            System.err.println("Error al conectar con la base de datos.");
        }
    }</pre>
</div>
</div>
<p>Fíjate que el código estaría en un try-catch. Esto es porque si no se puede conectar con el almacén de datos, o surge otro problema, <acronym title="Java Persistence API" lang="en">JPA</acronym> lanzará una PersistenceException.</p>
<p>Este ejemplo, solo conecta con el almacén de datos y termina. Todavía no estamos almacenando información, pero hemos dado un paso importante.</p></div>
</form>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id145">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id145-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta145_63" class="block story iDevice_content">
<p>Una opción habitual es indicar parámetros de configuración a nuestro programa a través de los conocidos archivos de propiedades (archivos con extensión .properties). Échale un vistazo al siguiente documento:</p>
<p style="text-align: center;"><a href="http://chuwiki.chuidiang.org/index.php?title=Leer_y_modificar_fichero_de_propiedades_en_java" title="Documento que explica como leer y modificar archivos de propiedades. (Se abre en una nueva ventana)" target="_blank" class="html">Leer archivos de propiedades.</a></p>
<p style="text-align: left;"></p>
</div>
<div id="taquesQuestion0b145" class="block iDevice_content">
<p>Los archivos de propiedades son un mecanismo muy usado para configurar aplicaciones a diferentes entornos de producción. Es el caso del <span lang="en">software</span> de punto de venta, que podría ejecutarse en diferentes clientes, cada uno con sus características. ¿Cómo podría adaptarse el proyecto del ejemplo anterior para usar archivos de propiedades?</p>
</div>
<form name="feedback-form-quesFeedback0b145" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b145text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b145" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b145" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>A continuación tienes un proyecto que utiliza un archivo .properties llamado&nbsp;jpa.properties (el nombre podría ser cualquier otro, pero para este proyecto se ha elegido ese). El archivo se encuentra en la carpeta raíz del proyecto. Fíjate en el código <span lang="en">Java</span>, verás que si no encuentra el archivo&nbsp;&nbsp;jpa.properties usará una base de datos H2 por defecto. Este proyecto sería por tanto ambivalente, puede usarse H2 o puede usarse <span lang="en">MySQL</span>:</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/UT10_ProyectoBase_JPA_H2_MySQL_properties.zip" title="Descargar proyecto base NetBeans que usa JPA y un archivo properties. Se abre en una nueva ventana [zip - 4.26 MB]" target="_blank" class="paquete">Proyecto base tipo 3 que utiliza <acronym title="Java Persistence API" lang="en">JPA</acronym>, H2 y <span style="text-align: center;" lang="en">MySQL</span>.</a><span class="exe-link-data file-size"> (zip - 4.26 <abbr lang="en" title="MegaBytes">MB</abbr>)</span>.</p></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.5.- Modelo de datos en JPA</h1></div></div>
<div class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id153">
<div class="iDevice emphasis_casopracticofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id153-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta153_147" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/mail-truck-3248139_640.jpg" alt="Imagen que muestra un camión de reparto" title="Camión de reparto." style="float: right;" width="250" height="166">
<div class="figcaption"><a href="https://pixabay.com/es/photos/cami%C3%B3n-de-correo-3248139/" target="_blank" class="author" title="Acceder a la imagen  " camión="" de="" reparto",="" "f.="" muhammad",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">F. Muhammad </a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p><strong>Juan</strong> y <strong>María</strong> le han dado una vuelta de tuerca a su mini proyecto. <strong>Ada</strong> ha estado reunida esta mañana con el cliente, y, aunque todavía está afinando los términos del contrato y del producto a desarrollar, <strong>Ada</strong> les ha adelantado que en el <span lang="en">software</span> que quiere el cliente debe poder indicarse la dirección de envío de la compra.</p>
<p><strong>María</strong> ha decidido investigar qué debería modificar en su proyecto de prueba, el mini punto de venta, aprovechando que <acronym title="Java Persistence API" lang="en">JPA</acronym> les da más flexibilidad a la hora de desarrollar. Después de conseguirlo, se lo comenta a <strong>Juan</strong>:</p>
<p><span>—</span>Mira <strong>Juan</strong>, he añadido otra entidad al proyecto, una llamada DatosDeEntrega, asociada a cada <span lang="en">ticket</span>. Es bastante sencillo la verdad.</p>
<p><span>—</span>Genial, algo así es lo que comentó <strong>Ada</strong> que se necesitará en el proyecto real del cliente. Si seguimos a este ritmo vamos a terminar el proyecto antes de que se firme el contrato <span>—</span>dice <strong>Juan</strong> notablemente contento.</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id81">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id81-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta81_154" class="block iDevice_content">
<p>Como ya se ha comentado antes, <acronym title="Java Persistence API" lang="en">JPA</acronym> permite almacenar objetos directamente en la base de datos. Pero para que esto sea posible, es necesario definir lo que se denomina un modelo de datos.</p>
<p>Un modelo de datos, como ocurre en el modelo Entidad-Relación o en el modelo Relacional, consiste en una definición previa del esquema de la información a almacenar. Algo así ya se vio en apartados anteriores, por ejemplo, al crear las tablas en una base de datos <acronym title="Structured Query Language" lang="en">SQL</acronym>. Cuando creamos las tablas en <acronym title="Structured Query Language" lang="en">SQL</acronym> estamos definiendo el modelo de datos.</p>
<p>Afortunadamente, el modelo de datos en <acronym title="Java Persistence API" lang="en">JPA</acronym> es más sencillo, y se define a través de objetos <span lang="en">Java</span>, lo que se denomina <acronym title="Plain Old Java Objects" lang="en">POJO</acronym>&nbsp;(<span lang="en">Plain Old Java Objects</span>), también llamados como <strong>objetos ligeros</strong>. Eso es una gran ventaja, dado que para definir cómo serán los datos a almacenar en la base de datos, utilizamos simplemente clases <span lang="en">Java</span> que ya conocemos. Nos aprovecharemos de una ventaja de <acronym title="Java Persistence API" lang="en">JPA</acronym>, que es la de crear la estructura necesaria en la base de datos de forma automática y transparente.</p>
<p>Las clases que conformarán el modelo de datos en <acronym title="Java Persistence API" lang="en">JPA</acronym> se llamaran <strong>entidades</strong>. Si conoces el modelo Entidad-Relación, verás que hay cierta similitud entre dicho modelo y el modelo de datos en <acronym title="Java Persistence API" lang="en">JPA</acronym>. Una entidad <acronym title="Java Persistence API" lang="en">JPA</acronym> es conceptualmente similar a una entidad en el modelo Entidad-Relación. Una entidad es, en definitiva, un concepto real o abstracto que necesito en mi programa: cuenta bancaria, persona, documento, producto, <abbr title="etcétera">etc</abbr>.</p>
<p>Veamos cómo serían las entidades del <span lang="en">software</span> de mini punto de venta:</p>
<div class="exe-figure exe-image position-center" style="width: 299px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema1.png" alt="Entidades que participan en nuestro proyecto. En la imagen aparecen 4 entidades: ticket, linea de ticket, datos de entrega y producto." title="Entidades del mini punto de venta" class="elemento_centrado" width="299" height="174">
<div class="figcaption"><span class="title"><em>Elaboración propia. Entidades del mini punto de venta</em></span></div>
</div>
<p>También, igual que ocurre en el modelo entidad-relación, las entidades <acronym title="Java Persistence API" lang="en">JPA</acronym> tienen <strong>atributos</strong>. Un atributo de una entidad <acronym title="Java Persistence API" lang="en">JPA</acronym> será simplemente un atributo en una clase. Si añadimos atributos a nuestro modelo, quedaría algo así:</p>
<div class="exe-figure exe-image position-center" style="width: 299px;"><a href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema2.png" title="Ampliar imagen " entidades="" del="" mini="" punto="" de="" venta="" junto="" a="" los="" atributos="" la="" misma.".="" (se="" abre="" en="" una="" nueva="" ventana)"="" target="_blank"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema2.png" alt="Entidades que participan en nuestro proyecto, junto a los atributos de cada una." title="Entidades del mini punto de venta junto a los atributos de la misma." class="imagen_ampliable" width="299" height="211"></a>
<div class="figcaption"><span class="title"><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>Elaboración propia.&nbsp;</em> Entidades del mini punto de venta, junto a sus atributos.</em></span></div>
</div>
<p>Y por último, <acronym title="Java Persistence API" lang="en">JPA</acronym> también permite indicar que <strong>relaciones</strong> hay entre las entidades. ¿Te suena? Si conoces el modelo entidad-relación seguramente sí. Las relaciones indican cómo las entidades están vinculadas entre sí. Veamos qué relaciones habría en el modelo de datos que tenemos entre manos.</p>
<div class="exe-figure exe-image position-center" style="width: 299px;"><a href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema3.png" title="Ampliar imagen " entidades="" del="" mini="" punto="" de="" venta="" junto="" a="" los="" atributos="" la="" misma="" y="" las="" relaciones="" entre="" ellas.".="" (se="" abre="" en="" una="" nueva="" ventana)"="" target="_blank"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema3.png" alt="Entidades que participan en nuestro proyecto, junto a los atributos de cada una y sus relaciones." title="Entidades del mini punto de venta junto a los atributos de la misma y las relaciones entre ellas." class="imagen_ampliable" width="299" height="208"></a>
<div class="figcaption"><span class="title"><em><em><em>Elaboración propia.&nbsp;</em>&nbsp;</em>Entidades del mini punto de venta junto a los atributos de la misma y las relaciones entre ellas.</em></span></div>
</div>
<p>En&nbsp;<acronym title="Java Persistence API" lang="en">JPA</acronym> podemos tener relaciones de uno a muchos, de uno a uno, de muchos a muchos, de herencia, <abbr title="etcétera">etc</abbr>. La pregunta ahora es, ¿cómo pasamos este modelo de datos a un modelo <acronym title="Java Persistence API" lang="en">JPA</acronym>? Para definir el modelo de datos en <acronym title="Java Persistence API" lang="en">JPA</acronym> escribiremos clases con <strong>anotaciones</strong>.</p>
<div class="destacado"><strong>Una anotación es una forma de agregar información extra a diferentes elementos del lenguaje <span lang="en">Java</span>, tales como clases, métodos o atributos.</strong></div>
<p style="text-decoration: none;">Dos ejemplos de anotaciones muy usadas en Java son&nbsp;@Override y <code>@Deprecated</code>:</p>
<div class="highlighted-code language-java">
<div>
<pre>    @Override
    public String toString()
    {
        return a;
    }
    
    @Deprecated
    public String convertirACadena()
    {
        return a;
    }</pre>
</div>
</div>
<p style="text-decoration: none;">En el código anterior, las anotaciones indican información adicional sobre los métodos subsiguientes. La anotación&nbsp;@Override indicará que el método&nbsp;toString está sobrescribiendo la versión heredada de la clase padre, y&nbsp;@Deprecated está indicando que el método&nbsp;convertirACadena está desfasado y no debería usarse. En <acronym title="Java Persistence API" lang="en">JPA</acronym> veremos anotaciones asociadas a atributos, métodos y clases que permitirán detallar cómo será nuestro modelo de datos.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper SeleccionmultiplefpdIdevice em_iDevice" id="id155">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id155-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div class="question">
<div id="actitity-155_136">
<form name="multi-select-form-155_136" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form multi-select-form">
<h3 class="js-sr-av">Pregunta</h3>
<div id="taquestion155_136" class="block question iDevice_content">
<p><strong>Marca todas las opciones correctas. Una entidad <acronym title="Java Persistence API" lang="en">JPA</acronym> es en realidad una clase que...&nbsp;</strong></p>
</div>
<div class="iDevice_answers">
<h4 class="js-sr-av">Respuestas</h4>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op155_1360" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-155_139">Opción 1</a></label><input type="checkbox" id="op155_1360" value="False">
</p>
<div class="iDevice_answer-content" id="answer-155_139"><a name="answer-155_139" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans155_139" class="block iDevice_content">
<p>es abstracta.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-155_1360" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op155_1361" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-155_6331">Opción 2</a></label><input type="checkbox" id="op155_1361" value="True">
</p>
<div class="iDevice_answer-content" id="answer-155_6331"><a name="answer-155_6331" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans155_6331" class="block iDevice_content">
<p>aparece en el archivo&nbsp;persistence.xml en una etiqueta &lt;class&gt;...&lt;/class&gt;.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-155_1361" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op155_1362" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-155_6333">Opción 3</a></label><input type="checkbox" id="op155_1362" value="False">
</p>
<div class="iDevice_answer-content" id="answer-155_6333"><a name="answer-155_6333" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans155_6333" class="block iDevice_content">
<p>implementa interfaces <acronym title="Plain Old Java Object" lang="en">POJO</acronym>.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-155_1362" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op155_1363" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-155_6335">Opción 4</a></label><input type="checkbox" id="op155_1363" value="True">
</p>
<div class="iDevice_answer-content" id="answer-155_6335"><a name="answer-155_6335" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans155_6335" class="block iDevice_content">
<p>tiene anotaciones para indicar que es una entidad.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-155_1363" style="display:none"></div>
</div>
</div>
<div class="block iDevice_buttons feedback-button js-required">
<p>
<input type="button" name="submitSelect" class="feedbackbutton multi-select-feedback-toggler" value="Mostrar retroalimentación" id="multi-select-feedback-toggler-4-155_136"> 
</p>
</div>
<div id="f155_136" class="js-hidden js-feedback" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>

<div id="tafeedback155_136" class="feedback iDevice_content">
<p>En el texto de este apartado no se habla de que la clase <span lang="en">Java</span> tenga que ser abstracta, y tampoco que tenga que implementar ninguna interfaz. Solo se habla de que tienen que usarse algunas anotaciones.</p>
<p>También, en apartados anteriores de esta unidad, se hizo mención a que la clase a persistir debía aparecer en el archivo persistence.xml, así que tenlo en cuenta de ahora en adelante.</p>
</div>
</div>
</form>
<div class="iDevice_solution feedback js-hidden">
<h4>Solución</h4>
<ol>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-155_139" class="wrong">Incorrecto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-155_6331" class="right">Correcto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-155_6333" class="wrong">Incorrecto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-155_6335" class="right">Correcto</a></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.5.1.- Entidades</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id82">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id82-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta82_154" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/shopping-879498_640.jpg" alt="Imagen en la que se muestra un ticket, con multitud de líneas de ticket, rodeado de muchos productos." title="Tique de compra con muchas líneas de ticket" style="float: right;" width="250" height="166">
<div class="figcaption"><a href="https://pixabay.com/es/photos/compras-el-gasto-hasta-resbalones-879498/" target="_blank" class="author" title="Acceder a la imagen  " tique="" de="" compra="" con="" muchas="" líneas="" ticket",="" "steve="" buissinne="" ",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">Steve Buissinne </a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>Ahora que ya tenemos establecido el modelo de datos que nuestro <span lang="en">software</span> va a necesitar, vamos a convertir simples clases en entidades que <acronym title="Java Persistence API" lang="en">JPA</acronym> podrá usar para almacenar información.</p>
<p>Vamos a crear ahora una entidad para almacenar los productos de nuestro mini punto de venta, y para ello es necesario hacer lo siguiente:</p>
<ul class="lista_verificacion">
<li>Debe anotarse la clase con la anotación @Entity.</li>
<li>La clase debe tener al menos un constructor por defecto sin parámetros (se puede poner protected para evitar instanciaciones sin datos de las entidades). Puede haber, por supuesto, más constructores.</li>
<li>La clase no puede ser final. Tampoco puede haber ningún método marcado como final.</li>
<li>Es recomendable que implemente la interfaz Serializable.</li>
</ul>
<p>Dicho esto, vamos a crear nuestra clase Producto y a convertirla en una entidad:</p>
<div class="highlighted-code language-java">
<div>
<pre>@Entity
public class Producto implements Serializable {        

    private static final long serialVersionUID = 99488577171L;    

    protected Producto () {  }   

}</pre>
</div>
</div>
<p>En el ejemplo anterior el constructor se ha puesto como protected, para evitar que se pueda crear una instancia de Producto a la que le falten datos obligatorios (como el nombre del producto). Ahora que ya hemos creado una entidad, el siguiente paso es añadir el atributo que va a ser la clave primaria de la entidad, el cual lo marcaremos con la anotación @Id:</p>
<div class="highlighted-code language-java">
<div>
<pre>@Entity
public class Producto implements Serializable {    
    
    // ...resto del código...
    
    @Id
    private Long id; //Clave primaria del producto

    // ...resto del código...

}</pre>
</div>
</div>
<p class="destacado"><strong>La clave primaria de la entidad permitirá identificar a cada producto almacenado en la base de datos. No podrá haber dos productos con la misma clave primaria.</strong></p>
<p>En muchas situaciones, cuando la clave primaria es un número, podemos pedirle a <acronym title="Java Persistence API" lang="en">JPA</acronym> que genere de forma automática un identificador. Esto lo podemos hacer en <acronym title="Java Persistence API" lang="en">JPA</acronym> con la anotación @GeneratedValue:</p>
<div class="highlighted-code language-java">
<div>
<pre>@Entity
public class Producto implements Serializable {    
    
    // ...resto del código...
    
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id; //Clave primaria del producto

    // ...resto del código...

}</pre>
</div>
</div>
<p>En el ejemplo anterior strategy = GenerationType.AUTO&nbsp;es un parámetro de la anotación @GeneratedValue y con él simplemente indicamos la forma en la que se generará el identificador. El valor del identificador se establecerá la primera vez que guardemos la entidad en el almacén de datos, y no tendremos que hacer nada más.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper DestacadofpdIdevice" id="id161">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id161-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div class="iDevice_destacadofpd">
<div id="ta161_151" class="block iDevice_content">
<p><strong>No olvides que hay que añadir&nbsp;&lt;class&gt;...&lt;/class&gt; en el archivo de persistencia (persistence.xml), con la entidad y el paquete en el que está. Por ejemplo:<br></strong></p>
<div class="highlighted-code language-markup">
<div>
<pre> &lt;class&gt;minipos.model.Producto&lt;/class&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper SeleccionmultiplefpdIdevice em_iDevice" id="id159">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id159-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div class="question">
<div id="actitity-159_136">
<form name="multi-select-form-159_136" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form multi-select-form">
<h3 class="js-sr-av">Pregunta</h3>
<div id="taquestion159_136" class="block question iDevice_content">
<p><strong>Marca todas las afirmaciones correctas sobre una entidad en <acronym title="Java Persistence API" lang="en">JPA</acronym>:</strong></p>
</div>
<div class="iDevice_answers">
<h4 class="js-sr-av">Respuestas</h4>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op159_1360" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-159_139">Opción 1</a></label><input type="checkbox" id="op159_1360" value="True">
</p>
<div class="iDevice_answer-content" id="answer-159_139"><a name="answer-159_139" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans159_139" class="block iDevice_content">
<p>Debe anotarse la clase con la anotación @Entity.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-159_1360" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op159_1361" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-159_6483">Opción 2</a></label><input type="checkbox" id="op159_1361" value="False">
</p>
<div class="iDevice_answer-content" id="answer-159_6483"><a name="answer-159_6483" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans159_6483" class="block iDevice_content">
<p>La clase debe tener obligatoriamente un constructor por defecto con visibilidad&nbsp; protected.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-159_1361" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op159_1362" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-159_6485">Opción 3</a></label><input type="checkbox" id="op159_1362" value="False">
</p>
<div class="iDevice_answer-content" id="answer-159_6485"><a name="answer-159_6485" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans159_6485" class="block iDevice_content">
<p>La clase y sus métodos deben ser final.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-159_1362" style="display:none"></div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="op159_1363" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-159_6487">Opción 4</a></label><input type="checkbox" id="op159_1363" value="True">
</p>
<div class="iDevice_answer-content" id="answer-159_6487"><a name="answer-159_6487" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans159_6487" class="block iDevice_content">
<p>Es recomendable que implemente la interfaz Serializable.</p>
</div>
</div>
<div class="iDevice_answer-feedback feedback" id="feedback-159_1363" style="display:none"></div>
</div>
</div>
<div class="block iDevice_buttons feedback-button js-required">
<p>
<input type="button" name="submitSelect" class="feedbackbutton multi-select-feedback-toggler" value="Mostrar retroalimentación" id="multi-select-feedback-toggler-4-159_136"> 
</p>
</div>
<div id="f159_136" class="js-hidden js-feedback" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>

<div id="tafeedback159_136" class="feedback iDevice_content">
<p>Recuerda, la clase debe tener obligatoriamente un constructor por defecto, pero su visibilidad no tiene por que ser protected, eso es solo una recomendación. Además, respecto a que la clase y sus métodos deban ser &nbsp;final, es justo lo contrario: ni la clase, ni sus métodos deben ser final.</p>
</div>
</div>
</form>
<div class="iDevice_solution feedback js-hidden">
<h4>Solución</h4>
<ol>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-159_139" class="right">Correcto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-159_6483" class="wrong">Incorrecto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-159_6485" class="wrong">Incorrecto</a></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-159_6487" class="right">Correcto</a></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.5.2.- Atributos</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id156">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id156-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta156_154" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-copyright" style="width: 200px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/barcode-485220_640.1.png" alt="Imagen que muestra información de un pedido, incluyendo código de barras." title="Código de barras." style="float: right;" width="200" height="199">
<div class="figcaption"><a href="https://pixabay.com/es/vectors/c%c3%b3digo-de-barras-c%c3%b3digo-ean-485220/" target="_blank" class="author">stux</a> <span class="license"><span class="sep"></span><span>Pixabay License.</span><span class="sep"></span></span></div>
</div>
<p><br>Aunque ya has definido un atributo en el apartado anterior, el identificador, todavía faltan el resto de los atributos de la entidad. ¿Sabrías definirlos?</p>
<p>Es muy fácil, vamos a añadir el resto de los atributos necesarios a la entidad&nbsp;Producto (nombre, precio, <abbr title="etcétera">etc.</abbr>). No hay que hacer mucho, la verdad, solo poner el atributo en cuestión en la clase:</p>
<div class="highlighted-code language-java">
<div>
<pre class="  language-java"><code class="  language-java">@Entity
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producto</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    
    
    <span class="token comment" spellcheck="true">// ...resto del código...   </span>

    @Id
    @<span class="token function">GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> GenerationType<span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Clave primaria del producto</span>
    
    <span class="token keyword">private</span> String nombre<span class="token punctuation">;</span>

    <span class="token keyword">private</span> Double precio<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> String barCode<span class="token punctuation">;</span>   

    <span class="token comment" spellcheck="true">// ...resto del código...</span>

<span class="token punctuation">}</span></code></pre>
</div>
</div>
<p>Aunque con lo anterior bastaría, a veces es necesario indicar información "extra" a dichos atributos, y es normal encontrar las siguientes anotaciones en los atributos:</p>
<ul class="lista_verificacion">
<li>@Basic&nbsp;para marcar los atributos que tendrá nuestra entidad. No es obligatorio ponerlo, pues todos los atributos de nuestra clase serán atributos también de la entidad y se almacenarán en el almacén de datos si no se indica lo contrario.</li>
<li>@Transient&nbsp;para marcar aquellos atributos de la clase que no deberán almacenarse en la base de datos porque contienen información de carácter temporal.</li>
<li>@Column&nbsp;para indicar configuración adicional de un atributo. Lo utilizaremos sobre todo para indicar si un atributo puede tener un valor nulo y la longitud en caso de cadenas.</li>
</ul>
<p>De las tres anotaciones anteriores, la más usada es @Column. Fíjate en cómo se utiliza a continuación para indicar que los atributos no pueden estar vacíos y la longitud máxima de algunas cadenas:</p>
<div class="highlighted-code language-java">
<div>
<pre class="  language-java"><code class="  language-java">@Entity
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producto</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    
    
    <span class="token comment" spellcheck="true">// ...resto del código...   </span>

    @Id
    @<span class="token function">GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> GenerationType<span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Clave primaria del producto</span>
    
    @<span class="token function">Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String nombre<span class="token punctuation">;</span>

    @<span class="token function">Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> Double precio<span class="token punctuation">;</span>
    
    @<span class="token function">Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String barCode<span class="token punctuation">;</span>   

    <span class="token comment" spellcheck="true">// ...resto del código...</span>

<span class="token punctuation">}</span></code></pre>
</div>
</div>
<p>El parámetro nullable = false&nbsp;en la anotación&nbsp;@Column indica que ese atributo no puede contener un valor nulo, por lo que no puede estar vacío. Y por otro lado,&nbsp;length=24 indica la cantidad de caracteres que se deben usar para almacenar el texto de dicho atributo en el almacén de datos.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper DestacadofpdIdevice" id="id83">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id83-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div class="iDevice_destacadofpd">
<div id="ta83_151" class="block iDevice_content">
<p><strong>Una vez que hemos anotado la clase y los atributos debemos completar nuestra entidad: añadir constructores, métodos get/set para los atributos, sobrescribir el método toString, <abbr title="etcétera">etc</abbr>.</strong></p>
<p></p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id173">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id173-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta173_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b173" class="block iDevice_content">
<p>Te proponemos ahora un ejercicio muy sencillo. Utilizando uno de los proyectos base que te hemos proporcionado, añade la entidad&nbsp;Producto antes mencionada, completando todos los métodos&nbsp;get y <code>set</code>, y sobrecargando el método toString.</p>
</div>
<form name="feedback-form-quesFeedback0b173" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b173text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b173" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b173" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Seguro que lo has sabido hacer, no obstante, aquí tienes un ejemplo de dicha entidad completa:</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/Producto.java" title="Descargar la entidad Producto. Se abre en una nueva ventana [java - 1.75 KB]" class="paquete" target="_blank">Entidad&nbsp;Producto completa.</a><span class="exe-link-data file-size"> (java - 1.75 <abbr lang="en" title="KiloBytes">KB</abbr>)</span>.</p></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.5.3.- Relaciones entre entidades</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id86">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id86-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta86_154" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/social-media-3846597_250.jpg" alt="Imagen que muestra la interconexión entre diferentes personas." title="Relaciones." style="float: right;" width="250" height="157"><figcaption class="figcaption"><a href="https://pixabay.com/es/vectors/medios-de-comunicaci%C3%B3n-social-3846597/" target="_blank" class="author" title="Acceder a la imagen  " relaciones",="" de="" "gordon="" johnson",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">Gordon Johnson</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></figcaption></figure>
<p>Una de las cosas más engorrosas con las bases de datos es tener en cuenta las relaciones que tienen entre sí los datos. En general, existen tres tipos de relaciones fundamentales en <acronym title="Java Persistence API" lang="en">JPA</acronym>:</p>
<p><strong>Relación de uno a uno.</strong> Es una relación poco común, pero existe. Se produce cuando una entidad tiene relación exclusiva y recíproca con otra entidad.</p>
<p>Para ilustrar esta relación, imagina una empresa donde trabajan muchos empleados y muchas empleadas, y cada cual tendrá una tarjeta de seguridad que le da acceso solo a ciertas áreas. En ese caso, habrá claramente una entidad llamada&nbsp;Persona y otra llamada TarjetaDeSeguridad. Cada&nbsp;Persona tendrá una única TarjetaDeSeguridad, y cada&nbsp;TarjetaDeSeguridad corresponderá de forma exclusiva a una Persona.</p>
<p class="destacado" style="text-align: center;"><strong>En <acronym title="Java Persistence API" lang="en">JPA</acronym> las relaciones uno a uno se anotarán con la anotación @OneToOne.</strong></p>
<p><strong>Relación de uno a muchos.</strong> Es posiblemente la relación más común que existe. Se produce cuando una entidad tiene una relación con una o más instancias de otra entidad.</p>
<p>Para ilustrar esta relación, piensa otra vez en el ejemplo anterior. Imagina que cada empleado o empleada de la empresa pertenece a un único departamento. En este caso, una hipotética entidad&nbsp;Departamento tendría una o más instancias de la entidad&nbsp;Persona asociadas. Esto hace que entre&nbsp;Departamento y&nbsp;<code>Persona</code> haya una clara relación uno a muchos.</p>
<p class="destacado" style="text-align: center;"><strong>En&nbsp;<acronym title="Java Persistence API" lang="en">JPA</acronym> las relaciones uno a muchos se anotarán con las anotaciones @OneToMany y <strong>@ManyToOne</strong>.&nbsp; <br></strong></p>
<p><strong>Relación de muchos a muchos.</strong> Esta es también una relación bastante común. Se produce cuando una entidad A tiene una relación con una o varias instancias de otra entidad B, y a su vez, la entidad B puede tener una relación con una o varias instancias de la entidad A.</p>
<p>Nuevamente para ilustrar esta relación, piensa otra vez en el ejemplo anterior. Imagina que cada departamento tiene uno o varios proveedores de material de oficina, y que cada proveedor, a su vez, provee de material a uno o más departamentos de la empresa. Esto haría que una hipotética entidad Proveedor tuviera una relación muchos a muchos con la entidad Departamento.</p>
<p class="destacado" style="text-align: center;"><strong>En&nbsp;<acronym title="Java Persistence API" lang="en">JPA</acronym> las relaciones muchos a muchos se anotarán con la anotación @ManyToMany.</strong></p>
<p>De todos estos casos solo vamos a tratar las relaciones @OneToOne y&nbsp;<code>@OneToMany</code>/@ManyToOne para no extendernos demasiado.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id154">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id154-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta154_63" class="block story iDevice_content">
<p>Dado el modelo de datos de nuestra aplicación de mini punto de venta, visto en apartados anteriores:</p>
<div class="exe-figure exe-image position-center" style="width: 299px;"><a href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema3.png" title="Ampliar imagen " entidades="" del="" mini="" punto="" de="" venta="" junto="" a="" los="" atributos="" la="" misma="" y="" las="" relaciones="" entre="" ellas".="" (se="" abre="" en="" una="" nueva="" ventana)"="" target="_blank"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema3.png" alt="Entidades que participan en nuestro proyecto, junto a los atributos de cada una y sus relaciones." title="Entidades del mini punto de venta junto a los atributos de la misma y las relaciones entre ellas." class="imagen_ampliable" width="299" height="208"></a>
<div class="figcaption"><span class="title"><em>Elaboración propia. Entidades del mini punto de venta junto a los atributos de las mismas y las relaciones entre ellas.</em></span></div>
</div>
<p></p>
</div>
<div id="taquesQuestion0b154" class="block iDevice_content">
<p>¿Serías capaz de determinar qué relaciones entre entidades hay?</p>
</div>
<form name="feedback-form-quesFeedback0b154" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b154text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b154" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b154" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Dado el modelo de datos anterior podemos deducir que:</p>
<ul class="lista_verificacion">
<li>Hay una relación de <strong>uno a muchos</strong> entre&nbsp;Ticket y <code>LineaDeTicket</code>. Esto es porque un <span lang="en">ticket</span> está compuesto por una o varias líneas de <span lang="en">ticket</span>.</li>
<li>También podemos ver que hay una relación de <strong>uno a uno</strong> entre&nbsp;Ticket y <code>DatosDeEntrega</code>. Un <span lang="en">ticket</span> tiene asociado unos datos de entrega opcionales, pueden aparecer o no dichos datos de entrega, pero está claro que los productos de cada <span lang="en">ticket</span> se enviarán a una dirección diferente a la de otros <span lang="en">tickets</span>, y además, en una fecha y hora diferentes.</li>
<li>Por último, existe una asociación <strong>uno a muchos</strong> entre Producto y <code>LineaDeTicket</code>. Esto es porque un mismo producto puede aparecer en una o varias líneas de <span lang="en">ticket</span>. Sin embargo, las líneas de<span lang="en"> ticket</span> copian el precio del producto en el momento de la venta, y esto es porque es posible que el producto cambie de precio a lo largo del tiempo.</li>
</ul></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.5.4.- Relaciones uno a uno</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id88">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id88-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta88_154" class="block iDevice_content">
<p>¿Sabrías indicar la relación uno a uno entre dos entidades?</p>
<p>En este apartado vamos a profundizar en cómo indicar a través de anotaciones la existencia de una relación uno a uno en el modelo de datos. Como en la aplicación de mini punto de venta tenemos un ejemplo, vamos a resolver dicho caso. El ejemplo de relación uno a uno lo tenemos entre la entidad&nbsp;Ticket y la entidad DatosDeEntrega. Cada Ticket será único y, además, tendrá sus propios valores asociados en la entidad DatosDeEntrega.</p>
<div class="exe-figure exe-image float-right license-pd" style="width: 200px;"><a href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema_relacion_1_1.png" title="Ampliar imagen " relación="" uno="" a="" entre="" ticket="" y="" datosdeentrega".="" (se="" abre="" en="" una="" nueva="" ventana)"="" target="_blank"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema_relacion_1_1.png" alt="Imagen que ilustra la relación uno a uno entre Ticket y DatosDeEntrega." title="Relación uno a uno entre Ticket y DatosDeEntrega." style="float: right;" class="imagen_ampliable" width="153" height="250"></a>
<div class="figcaption"><span class="title"><em>Elaboración propia. Relación uno a uno entre Ticket y DatosDeEntrega.</em></span> <span class="license"><span class="sep">(</span><span>Dominio público</span><span class="sep">)</span></span></div>
</div>
<p>Empecemos por la entidad Ticket. Lo primero que haremos en esta entidad será añadir un atributo que serán los datos de entrega, eso lo indicaremos así:</p>
<div class="highlighted-code language-java">
<div>
<pre>@Entity
public class Ticket implements Serializable{
    //... resto del código
    
    @OneToOne
    private DatosDeEntrega direccionEnvio;
    
    //... resto del código
}</pre>
</div>
</div>
<p>La relación se materializará por tanto como un atributo en la entidad Ticket anotado con&nbsp;@OneToOne para indicar la existencia de dicha relación, y <acronym title="Java Persistence API">JPA</acronym> se encargará del resto. No obstante, podemos configurar dicha relación un poco más. Sabemos que no es obligatorio que un&nbsp;Ticket tenga DatosDeEntrega. ¿Cómo lo indicamos?</p>
<p>Se podría realizar así:</p>
<div class="highlighted-code language-java">
<div>
<pre>@Entity
public class Ticket implements Serializable{
    //... resto del código
    
    @OneToOne(optional = true, orphanRemoval = true, cascade = CascadeType.PERSIST)
    private DatosDeEntrega direccionEnvio;
    
    //... resto del código
}</pre>
</div>
</div>
<p>El parámetro&nbsp;optional = true indica que esa relación es opcional, es decir, que un&nbsp;Ticket puede no tener DatosDeEntrega. Esto permitirá que el atributo direccionEnvio anterior pueda ser null.</p>
<p>Por otro lado, si eliminamos un Ticket no tiene sentido que los datos de entrega se almacenen. Si se elimina el Ticket, pero no los DatosDeEntrega, serían unos datos de entrega huérfanos. El otro parámetro de la anotación&nbsp;@OneToOne, <code>orphanRemoval = true</code>, hace referencia precisamente a eso: si se elimina el Ticket se eliminarán también los DatosDeEntrega asociados para que no queden huérfanos.</p>
<p>Además de los dos parámetros anteriores, aparece el parámetro&nbsp;cascade = CascadeType.PERSIST. Este tercer parámetro permitirá que el cambio en los datos de entrega asociados al &nbsp;Ticket,&nbsp;se guarden al guardar el&nbsp;&nbsp;Ticket.&nbsp;De esa forma, solo tendremos que hacer una operación de guardado, sin tener que guardar los datos de entrega y el&nbsp;Ticket&nbsp;por separado.</p>
<p>Pero cuidado, aún faltaría una cosa, y es indicar la relación en el otro sentido. En la entidad DatosDeEntrega también deberíamos indicar dicha relación de forma similar:</p>
<div class="highlighted-code language-java">
<div>
<pre>@Entity
public class DatosDeEntrega implements Serializable {

    //... resto del código 
    
    @OneToOne(optional=false)
    private Ticket ticket;

    //... resto del código

}</pre>
</div>
</div>
<p>El proceso es similar, y la anotación es la misma (@OneToOne), pero fíjate que en este caso se ha puesto optional=false. Esto es porque aunque un &nbsp;Ticket&nbsp;no tiene porqué tener unos datos de entrega asociados obligatoriamente, al revés no es lo mismo: <strong>los datos de entrega siempre tienen que tener un&nbsp;Ticket&nbsp;asociado</strong>. Con esto estamos diciendo que el atributo ticket, de la entidad DatosDeEntrega, no puede ser nunca null.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper VerdaderofalsofpdIdevice em_iDevice" id="id164">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id164-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta164_135" class="block iDevice_content">

</div>
<div class="question">
<form name="true-false-form-0b164" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" class="activity-form">
<h3 class="js-sr-av">Pregunta 1</h3>
<div id="taquestion0b164" class="block iDevice_content">
<p><strong>La anotación&nbsp;@OneToOne siempre indica que una entidad&nbsp;A tiene asociada otra entidad&nbsp;B de forma opcional.</strong></p>
</div>
<p class="iDevice_answer js-required">
<label for="true0b164"><input type="radio" name="option0b164" id="true0b164" class="exe-radio-option exe-radio-option-0-2-0b164-truefalse"> Verdadero</label> 
<label for="false0b164"><input type="radio" name="option0b164" id="false0b164" class="exe-radio-option exe-radio-option-1-2-0b164-truefalse"> Falso</label>
</p>
</form>
<div id="s0b164" class="feedback js-feedback js-hidden" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<p><strong id="s0b164-result" class="wrong">Falso</strong></p>
<p>No es del todo cierto, dado que para que esa relación sea opcional es necesario indicarlo con el parámetro optional=true de la anotación @OneToOne.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.5.5.- Relaciones uno a muchos</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id90">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id90-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta90_154" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-pd" style="width: 350px;"><a href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema_relacion_1_n_b.png" title="Ampliar imagen " relación="" uno="" a="" muchos="" entre="" ticket="" y="" lineadeticket".="" (se="" abre="" en="" una="" nueva="" ventana)"="" target="_blank"><img class="imagen_ampliable" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema_relacion_1_n_b.png" alt="Imagen que ilustra la relación uno a muchos entre Ticket y LineaDeTicket. Una LineaDeTicket tendrá siempre un único producto, y cada producto podrá estar en una o más líneas de ticket." title="Relación uno a muchos entre Ticket y LineaDeTicket." style="display: block; margin-left: auto; margin-right: auto;" width="250"></a>
<div class="figcaption"><span class="title"><em>Elaboración propia.&nbsp;Relación uno a muchos entre Ticket y LineaDeTicket.</em></span> <span class="license"><span class="sep">(</span><span>Dominio público</span><span class="sep">)</span></span></div>
</div>
<p>Ahora toca la relación más habitual en cualquier modelo de datos. Teniendo en cuenta el apartado anterior, ¿cómo crees que se materializará la relación uno a muchos en nuestro modelo de datos <acronym title="Java Persistence API" lang="en">JPA</acronym>?</p>
<p>En la aplicación del mini punto de venta que tenemos entre manos hay dos situaciones donde se usan estas relaciones. Uno de esos casos es la relación entre&nbsp;LineaDeTicket y<code> Ticket</code>.</p>
<p>Empezaremos por ver cómo se materializa dicha relación en la entidad LineaDeTicket. Una línea de<span lang="en"> ticket</span> estará asociada a un único <span lang="en">ticket</span>, pero además, un <span lang="en">ticket</span> podrá tener múltiples líneas de ticket, esto significa que habrá una relación muchos a uno entre&nbsp;LineaDeTicket (muchos) y&nbsp;Ticket (uno). En&nbsp;<acronym title="Java Persistence API" lang="en">JPA </acronym>tendremos que usar la anotación @ManyToOne para indicar dicha relación. Veamos como sería:</p>
<div class="highlighted-code language-java">
<div>
<pre>@Entity
public class LineaDeTicket implements Serializable {

    // ... resto del código ...
    
    @ManyToOne(optional = false)
    private Ticket ticket;
    
    // ... resto del código ...

}</pre>
</div>
</div>
<p>Esta relación por tanto se materializará también en un atributo, llamado ticket y de tipo la entidad Ticket,&nbsp; marcado con la anotación @ManyToOne. No es obligatorio poner el parámetro optional = false, pero aquí es conveniente ponerlo para indicar que siempre debe haber un <span lang="en">ticket</span> asociado a la línea de <span lang="en">ticket</span>. De esta forma, el atributo&nbsp;ticket anterior no podrá ser&nbsp;null en el almacén de datos.</p>
<p>Y ahora que hemos hecho esa parte de la relación (la parte de @ManyToOne), podemos completar el código de la entidad Ticket, donde habrá que poner una relación @OneToMany, dado que un <span lang="en">ticket</span> podrá tener multiples líneas de <span lang="en">ticket</span>. Lo haríamos de la siguiente forma:</p>
<div class="highlighted-code language-java">
<div>
<pre>@Entity
public class Ticket implements Serializable{

    //... resto del código
    
    @OneToMany(mappedBy = "ticket", orphanRemoval = true, cascade = CascadeType.PERSIST)
    private List&lt;LineaDeTicket&gt; lineas;

    //... resto del código
    
}</pre>
</div>
</div>
<p>Fíjate que ahora, como tipo del atributo se ha puesto List&lt;LineaDeTicket&gt;. Hay que poner una lista en este caso porque no habrá solo una línea de <span lang="en">ticket</span>, sino que habrá varias líneas asociadas a un mismo <span lang="en">ticket</span>. <acronym title="Java Persistence API" lang="en">JPA</acronym> usará esa lista para almacenar las líneas de <span lang="en">ticket</span> de cada <span lang="en">ticket</span>.</p>
<p>Como puedes ver en el ejemplo anterior, a la anotación @OneToMany se le han pasado tres parámetros. Dichos parámetros significan lo siguiente:</p>
<ul class="lista_verificacion">
<li>mappedBy = "ticket" que indicará el atributo de la otra clase participante en la relación (LineaDeTicket) que tiene la anotación @ManyToOne.</li>
<li>orphanRemoval = true tiene el mismo significado que en la relación uno a uno vista en el apartado anterior. Si un <span lang="en">ticket</span> desaparece, sus líneas de <span lang="en">ticket</span> quedan huérfanas. Este parámetro hará que las líneas de <span lang="en">ticket</span> se borren de forma automática cuando el <span lang="en">ticket</span> asociado también se borre.</li>
<li>cascade = CascadeType.PERSIST&nbsp; permite que los cambios en cualquier LineaDeTicket de la lista List&lt;LineaDeTicket&gt; (tanto si añadimos una nueva línea de <span lang="en">ticket</span>, como si modificamos una ya existente), se guarden en la base de datos al guardar el <span lang="en">ticket</span>. De esa forma no tendremos que hacer dos operaciones por separado (guardar la línea de <span lang="en">ticket</span> y después el <span lang="en">ticket</span>), sino solamente una (guardar el <span lang="en">ticket</span>).</li>
</ul>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id158">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id158-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta158_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b158" class="block iDevice_content">
<div>
<div class="exe-figure exe-image float-right license-pd" style="width: 190px; margin: 3px;"><a href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema_relacion_1_n.png" title="Haz clic para ampliar imagen que muestra la relación uno a muchos entre Producto y LineaDeTicket." target="_parent"><img class="imagen_ampliable" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/esquema_relacion_1_n.png" alt="Imagen que ilustra la relación uno a muchos entre Producto y LineaDeTicket. Una LineaDeTicket tendrá siempre un único producto, y cada producto podrá estar en una o más líneas de ticket." title="Relación uno a muchos entre Producto y LineaDeTicket." height="200" width="161" style="float: right;"></a>
<div class="figcaption"><span class="title"><em>Elaboración propia. Relación uno a muchos entre Producto y LineaDeTicket.</em></span> <span class="license"><span class="sep">(</span><span>Dominio público</span><span class="sep">)</span></span></div>
</div>
</div>
<p>Queda una relación por modelar en nuestro modelo <acronym title="Java Persistence API" lang="en">JPA</acronym>, ¿te atreves?</p>
<p>Se trata de la relación entre&nbsp;Producto y <code>LineaDeTicket</code>. Esta relación es un poco especial, porque aunque es una relación uno a muchos (un producto estará en múltiples líneas de <span lang="en">ticket</span>), resulta que <strong>para un producto dado no es necesario saber en que líneas de <span lang="en">ticket</span> está</strong>.</p>
<p>Por tanto, para una línea de <span lang="en">ticket</span> si es necesario saber cuál es el producto que contiene, pero no al revés.</p>
<p>¿Qué piensas, esto simplifica nuestro modelo de datos o lo vuelve más complejo? ¿Cómo resolverías esto?</p>
</div>
<form name="feedback-form-quesFeedback0b158" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b158text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b158" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b158" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Realmente, este caso es más sencillo de resolver. Cuando se da esta situación solo indicamos una parte de la relación (@ManyToOne), pero no indicamos la otra (@OneToMany). Solo tenemos que añadir lo siguiente en la entidad LineaDeTicket:</p>
<div class="highlighted-code language-java">
<div>
<pre>@Entity
public class LineaDeTicket implements Serializable {

    //... resto del código
    
    @ManyToOne(optional = false)
    private Producto producto;
    
    //... resto del código

}</pre>
</div>
</div>
<p></p></div>
</form>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice" id="id165">
<div class="iDevice emphasis_debesconocerfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_debesconocerfpd.png)"><h2 class="iDeviceTitle">Debes conocer</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id165-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta165_129" class="block iDevice_content">
<p>A continuación tienes el código de las 4 entidades que componen el modelo de datos del minipunto de venta. Échale un vistazo, puede serte de utilidad:</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/Producto.1.java" title="Descargar el código fuente de la entidad Producto. Se abre en una nueva ventana [java - 2.82 KB]" target="_blank" class="binario">Código completo de la entidad Producto.</a><span class="exe-link-data file-size"> (java - 2.82 <abbr lang="en" title="KiloBytes">KB</abbr>)</span>.</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/LineaDeTicket.java" title="Descargar la entidad LineaDeTicket. Se abre en una nueva ventana [java - 3.2 KB]" target="_blank" class="binario">Código completo de la entidad LineaDeTicket.</a><span class="exe-link-data file-size"> (java - 3.2 <abbr lang="en" title="KiloBytes">KB</abbr>)</span>.</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/DatosDeEntrega.java" title="Descargar la entidad DatosDeEnvio. Se abre en una nueva ventana [java - 4.57 KB]" class="binario">Código&nbsp;completo de la entidad DatosDeEnvio.</a><span class="exe-link-data file-size"> (java - 4.57 <abbr lang="en" title="KiloBytes">KB</abbr>)</span>.</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/Ticket.java" title="Descargar la entidad Ticket. Se abre en una nueva ventana [java - 6.98 KB]" target="_blank" class="binario">Código completo de la entidad Ticket.</a><span class="exe-link-data file-size"> (java - 6.98 <abbr lang="en" title="KiloBytes">KB</abbr>)</span>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.6.- Operaciones CRUD con JPA</h1></div></div>
<div class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id163">
<div class="iDevice emphasis_casopracticofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id163-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta163_147" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/fear-4208702_640.jpg" alt="Imagen que ilustra a una persona nerviosa." title="Nervios" style="float: right;" width="250" height="154">
<div class="figcaption"><a href="https://pixabay.com/es/illustrations/miedo-p%C3%BAblica-hablando-etapa-susto-4208702/" target="_blank" class="author" title="Acceder a la imagen  " nervios",="" de="" "mohamed="" hassan",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">mohamed Hassan</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p><strong>Ada</strong> hoy está contenta, el cliente está a punto de firmar el contrato. Pero les ha pedido una última cosa, conocer de primera mano a quien se va a encargar del proyecto. Quieren mantener una charla con <strong>María</strong> y con <strong>Juan</strong>, y con otros miembros de la plantilla, para conocer su experiencia programando. <strong>Ada</strong> está contenta, pero <strong>Juan</strong> y <strong>María</strong> están un tanto nerviosos por la situación.</p>
<p>Por lo visto, el cliente va a traer a una asesora, experta en desarrollo de aplicaciones, para que evalúe al equipo de desarrollo. Es normal que <strong>Juan</strong> y <strong>María</strong> se sientan intimidados. <strong>Juan</strong> le comenta a <strong>María</strong>:</p>
<p><span>—</span>No se cómo puedes estar programando tan tranquila. Sabes que mañana nos entrevistará la asesora, estoy muy nervioso, ¿tú no?</p>
<p><strong><span>—</span>Juan</strong>, lo único que podemos hacer ahora es acumular cuanta más experiencia mejor. Quiero terminar la parte donde se guarda el <span lang="en">ticket</span> en el almacén de datos. Prefiero centrarme en esto, así se me olvida un poco lo de mañana.</p>
<p><span>—</span>Tienes razón <span>—</span>contesta <strong>Juan<span>—</span></strong>, voy a hacer lo mismo, así me sentiré más seguro para la reunión de mañana.</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id93">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id93-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta93_154" class="block iDevice_content">
<div class="exe-figure exe-image float-left license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/data-2723105_640.jpg" alt="Imagen que muestra un espiral de datos." title="Datos." width="250" height="166">
<div class="figcaption"><a href="https://pixabay.com/es/photos/datos-conjunto-de-datos-palabra-2723105/" target="_blank" class="author" title="Acceder a la imagen  " datos",="" de="" "geralt",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">geralt</a> <span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p><br>¿Recuerdas qué son las operaciones <acronym title="Create, Read, Update and Delete" lang="en">CRUD</acronym> vistas con anterioridad?</p>
<p>Pues eso vamos a hacer ahora con <acronym title="Java Persistence API" lang="en">JPA</acronym>: crear, leer, actualizar y borrar datos de un almacén de datos.&nbsp;</p>
<p>Para realizar estas operaciones tan fundamentales en <acronym title="Java Persistence API" lang="en">JPA</acronym> necesitaremos el&nbsp;EntityManager del que se habló en apartados anteriores. Una vez creado el modelo de datos <acronym title="Java Persistence API" lang="en">JPA</acronym>, será bastante simple realizar estas operaciones, pero tendremos que tener en cuenta un par de conceptos primero.</p>
<p>Lo primero que tienes que tener en cuenta es que muchas de las operaciones anteriores es conveniente realizarlas dentro de lo que denominamos una <strong>transacción</strong>. Lo cual tiene enormes ventajas.</p>
<div class="destacado">
<p><strong>Una transacción consiste en un grupo de operaciones que se realizan a la vez para garantizar que la información del almacén de datos tenga coherencia.</strong></p>
</div>
<p>Esto, en términos prácticos, significa que:</p>
<ul class="lista_verificacion">
<li>Cuando vayamos a realizar cualquier operación debemos primero <strong>iniciar la transacción</strong>.</li>
<li>Después, indicamos el <strong>conjunto de acciones a realizar</strong>: borrar, crear, actualizar o leer tantas veces como necesitemos.</li>
<li>Y por último, es necesario indicar que queremos <strong>confirmar las operaciones</strong> o bien <strong>deshacer los cambios</strong>.</li>
</ul>
<p>Y esto se traduce en que, cuando vayamos a realizar una operación con <acronym title="Java Persistence API" lang="en">JPA</acronym> es conveniente seguir la siguiente estructura:</p>
<div class="highlighted-code language-java">
<div>
<pre>        EntityManager em = ...; //creación del entity manager (visto anteriormente)
&lt;br /&gt;        em.getTransaction().begin(); //Inicio de la transacción.
        
        //... conjunto de operaciones a realizar ...
        
        em.getTransaction().commit(); //Confirmar las operaciones        </pre>
</div>
</div>
<p>En caso de que, a lo largo del código, se determine que la operación no debe realizarse y que deben deshacerse los cambios, en vez de&nbsp;commit() tendremos que usar el método rollback():</p>
<div class="highlighted-code language-java">
<div>
<pre>        em.getTransaction().rollback(); //Deshacer las operaciones     </pre>
</div>
</div>
<p>Lo segundo que tienes que tener en cuenta es que una instancia de entidad tiene cuatro estados diferentes. Una instancia de entidad solo puede estar en uno de los siguientes estados:</p>
<ul class="lista_verificacion">
<li>Una instancia de entidad puede ser <strong>nueva</strong> (<strong></strong><span lang="en"><strong>new</strong></span>). Esto ocurre cuando creamos, por primera vez, la instancia de una entidad que antes no existía. El hecho de crear una instancia de dicha entidad, no quiere decir que se vaya a almacenar directamente. Por ejemplo:&nbsp;
<div class="highlighted-code language-java">
<div>
<pre>Producto p=new Producto("Cuchara Elegance", 3.49, "8480000145895"));</pre>
</div>
</div>
</li>
<li>Una instancia de entidad puede estar <strong>gestionada</strong> (<strong></strong><span lang="en"><strong><span lang="en">managed</span></strong></span>). Esto significa que el&nbsp;EntityManager tiene almacenada internamente la referencia a la instancia de entidad y cualquier cambio a la misma puede ser volcado a la base de datos en el siguiente commit(). Si una instancia de entidad está gestionada se puede decir que dicha instancia de entidad esta "conectada" al EntityManager.&nbsp;<span style="background-color: #ffff00;"></span></li>
<li>Una instancia de entidad puede estar <strong>desligada</strong> (<strong></strong><span lang="en"><strong><span lang="en">detached</span></strong></span>). Cuando una instancia de entidad está desligada significa que el&nbsp;EntityManager ha dejado de referenciarla internamente. En otras palabras, la instancia de entidad en cuestión está "desconectada" del EntityManager. Viene a ser lo contrario a <strong>gestionada</strong>.</li>
<li>Una instancia de entidad puede estar <strong>borrada</strong> (<strong></strong><span lang="en"><strong><span lang="en">removed</span></strong></span>). Cuando una instancia de entidad está borrada se ha eliminado del almacén de datos, y además, se ha desconectado del EntityManager. Eso sí, puede que para alguna parte de nuestro programa dicha información exista en memoria, porque haya alguna referencia a la misma en otra parte de nuestro código, pero a ojos de <acronym title="Java Persistence API" lang="en">JPA</acronym> es información eliminada.</li>
</ul>
<div class="destacado">
<p><strong>Al conjunto de instancias de entidad gestionadas (<span lang="en">estado managed</span>) por un EntityManager se les denomina <em>contexto de persistencia</em> (<span lang="en">persistence context</span>). </strong></p>
</div>
<p>Ahora todos estos conceptos te sonarán un poco raros, pero en la práctica, solo implica realizar las operaciones de una forma concreta. Échale un vistazo a los siguientes apartados, y verás que realmente es más sencillo de lo que parece.</p>
<div class="destacado">
<p style="text-align: center;"><strong>Para saber si una entidad está siendo gestionada puedes usar el método&nbsp;contains del EntityManager.</strong></p>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EleccionmultiplefpdIdevice em_iDevice" id="id171">
<div class="iDevice emphasis_autoevaluacionfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_autoevaluacionfpd.gif)"><h2 class="iDeviceTitle">Autoevaluación</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id171-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div class="question">
<form name="multi-choice-form-171_141" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="activity-form">
<h3 class="js-sr-av">Pregunta</h3>
<div id="taquestion171_141" class="block question iDevice_content">
<p><strong>Elige la opción correcta para completar la siguiente frase. </strong></p>
<p><strong>Una instancia de entidad será volcada al almacén de datos al hacer un&nbsp;commit&nbsp;...&nbsp;</strong></p>
</div>
<div class="iDevice_answers">
<h4 class="js-sr-av">Respuestas</h4>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i171_144" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-171_144">Opción 1</a></label><input type="radio" name="option171_141" id="i171_144" class="exe-radio-option exe-radio-option-0-4-171_141-multi">
</p>
<div class="iDevice_answer-content" id="answer-171_144"><a name="answer-171_144" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans171_144" class="block iDevice_content">
<p>Si está desligada al EntityManager.</p>
</div>
</div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i171_6894" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-171_6894">Opción 2</a></label><input type="radio" name="option171_141" id="i171_6894" class="exe-radio-option exe-radio-option-1-4-171_141-multi">
</p>
<div class="iDevice_answer-content" id="answer-171_6894"><a name="answer-171_6894" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans171_6894" class="block iDevice_content">
<p>Si está gestionada por el EntityManager.</p>
</div>
</div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i171_6897" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-171_6897">Opción 3</a></label><input type="radio" name="option171_141" id="i171_6897" class="exe-radio-option exe-radio-option-2-4-171_141-multi">
</p>
<div class="iDevice_answer-content" id="answer-171_6897"><a name="answer-171_6897" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans171_6897" class="block iDevice_content">
<p>Al crearse.</p>
</div>
</div>
</div>
<div class="iDevice_answer">
<p class="iDevice_answer-field js-required">
<label for="i171_6900" class="sr-av"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-171_6900">Opción 4</a></label><input type="radio" name="option171_141" id="i171_6900" class="exe-radio-option exe-radio-option-3-4-171_141-multi">
</p>
<div class="iDevice_answer-content" id="answer-171_6900"><a name="answer-171_6900" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taans171_6900" class="block iDevice_content">
<p>Al estar en memoria.</p>
</div>
</div>
</div>
</div>
<div class="iDevice_feedbacks js-feedback" role="status">
<h4 class="js-sr-av">Retroalimentación</h4>
<div id="sa0b171_141" class="feedback js-hidden"><a name="sa0b171_141" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taf171_144" class=" iDevice_content">
<p><strong>Incorrecto</strong>. Es justo lo contrario, si la instancia de la entidad está desligada no se enviará al almacén de datos.</p>
</div>
</div>
<div id="sa1b171_141" class="feedback js-hidden"><a name="sa1b171_141" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taf171_6894" class=" iDevice_content">
<p><strong>Correcto</strong>. Así es, si la instancia de la entidad está gestionada se modificará o creará en el almacén de datos.</p>
</div>
</div>
<div id="sa2b171_141" class="feedback js-hidden"><a name="sa2b171_141" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taf171_6897" class=" iDevice_content">
<p><strong>Incorrecto</strong>. No por crear una entidad, esta se almacena directamente en el almacén de datos.</p>
</div>
</div>
<div id="sa3b171_141" class="feedback js-hidden"><a name="sa3b171_141" href="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/saved_resource"></a>
<div id="taf171_6900" class=" iDevice_content">
<p><strong>Incorrecto</strong>. Una instancia de entidad es como cualquier instancia de cualquier clase, si no es gestionada por el EntityManager no se almacenará en el almacén de datos..</p>
</div>
</div>
</div>
</form>
<div class="iDevice_solution feedback js-hidden">
<h4>Solución</h4>
<ol>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-171_144">Incorrecto</a><span> (<a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#sa0b171_141">Retroalimentación</a>)</span></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-171_6894">Opción correcta</a><span> (<a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#sa1b171_141">Retroalimentación</a>)</span></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-171_6897">Incorrecto</a><span> (<a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#sa2b171_141">Retroalimentación</a>)</span></li>
<li><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#answer-171_6900">Incorrecto</a><span> (<a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/#sa3b171_141">Retroalimentación</a>)</span></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.6.1.- Persistir y leer</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id95">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id95-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta95_154" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/children-593313_640.jpg" alt="Un niño y una niña celebrando que algo funciona delante de la pantalla de un ordenador." title="¡¡Funciona!!" width="250" height="166">
<div class="figcaption"><a href="https://pixabay.com/es/photos/ni%C3%B1os-ganar-%C3%A9xito-videojuego-jugar-593313/" target="_blank" class="author" title="Acceder a la imagen  " ¡¡funciona!!",="" de="" "startupstockphotos",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"=""> StartupStockPhotos </a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>La operación de hacer persistente una instancia de entidad consiste, básicamente, en decirle al EntityManager que almacene una instancia de entidad recién creada (estado <strong>nueva</strong>) en el almacén de datos. Para ello, se debe utilizar el método&nbsp;persist() del EntityManager.</p>
<p>Imagina que has creado una instancia de la entidad&nbsp;Producto con el código siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>Producto p=new Producto("Cuchara Elegance", 3.49, "8480000145895");</pre>
</div>
</div>
<p>Fíjate que para crear la nueva instancia de&nbsp;Producto no se le pasa al constructor el identificador de producto (atributo id). Como se explicó en apartados anteriores, la entidad&nbsp;Producto tiene un identificador (atributo marcado con la anotación @Id) que se generará de forma automática (<code class="  language-java">@<span class="token function">GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> GenerationType<span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span></code>). Para que dicho identificador se genere automáticamente, debe dejarse sin inicializar. Así,<strong> al invocar el método persist dicho identificador se rellenará de forma automática</strong>.</p>
<p>¿Cómo podrías hacer persistente dicha entidad?</p>
<p>Vamos a crear un ejemplo de método para llevar a cabo dicha operación:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static boolean persistirProducto(EntityManager em, Producto p) {
        boolean ok = false;

        /*1º Iniciamos la transacción.*/
        em.getTransaction().begin();
        try {
            /*2º Persistimos la entidad usando el método persist.*/
            em.persist(p);

            /*3º Concluimos la transacción*/
            em.getTransaction().commit();

            /*4º (opcional, pero recomendable) Desligamos la entidad del 
             EntityManager para que cambios en la misma no persistan en 
            otro commit posterior */
            em.detach(p);
            
            ok = true;
        } catch (EntityExistsException ex) { 
            
            /*5º Excepción que saltará si ya existe una entidad con el mismo ID,
            es conveniente capturarla.*/
            System.out.println("El producto ya existe.");

            /*6º Como la transacción ha ido mal, deshacemos la operación */
            em.getTransaction().rollback();
        }
        
        return ok;
    }</pre>
</div>
</div>
<p>Fíjate que en el ejemplo anterior se captura, por seguridad, la excepción EntityExistsException. Dicha excepción se producirá solamente cuando ya exista una instancia de entidad con el mismo identificador. Aunque el identificador se genere automáticamente, es posible especificar un valor concreto para el mismo, por lo que si dicha circunstancia se da, debemos prevenirla.</p>
<p>Después de persistir una instancia de entidad, esta tendrá el estado de <strong>gestionada </strong>por el EntityManager. Esto implica que cualquier cambio en la misma en otras partes del código (cambiar el nombre del producto, por ejemplo), se podría guardar en el almacén de datos en futuros commit, y puede que eso no sea lo que se desea. Para evitar esas situaciones conviene desligar la instancia (detach) del EntityManager.<code></code></p>
<p>Ahora que ya hemos persistido una instancia de entidad, podremos leer dicha instancia de entidad a través de su identificador (id). Para ello, la clase EntityManager tiene el método find. Veamos un método donde se leería una instancia de entidad con un&nbsp;id concreto:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static Producto leerProducto(EntityManager em, long id) {
        /* 1º Buscamos el producto por Id */
        Producto p=em.find(Producto.class, id);
        /* 2º (opcional, pero recomendable) 
           Si el producto se ha encontrado, entonces, lo desacoplamos. */
        if (p!=null) em.detach(p);
        return p;
    } </pre>
</div>
</div>
<p>El método find necesita la clase del objeto que debe buscar (Producto.class en este caso) y el identificador del objeto a extraer. Si no es posible encontrar a la instancia de entidad en cuestión retornará null.</p>
<p>Después de ejecutar el método find, la entidad leída por el&nbsp;EntityManager tendrá el estado de <strong>gestionada</strong>. Nuevamente, para evitar que cambios en el producto recién leído sean guardados accidentalmente en el almacén de datos en un&nbsp;commit futuro, es conveniente desligar la instancia del&nbsp;EntityManager como ocurría en el caso anterior (método detach).</p>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id170">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id170-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta170_63" class="block story iDevice_content">
<p>En el siguiente código se crean y persisten dos instancias de la entidad producto, pero existe un problema:</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/CodigoErroneo.java" title="Descargar el código erróneo. Se abre en una nueva ventana [java - 3.7 KB]" target="_blank" class="binario">Código erróneo</a><span class="exe-link-data file-size"> (java - 3.7 <abbr lang="en" title="KiloBytes">KB</abbr>)</span>.</p>
<p>Resulta que los datos mostrados por pantalla indican que el precio almacenado del primer producto ("Cuchara <span lang="en">Elegance</span>") es incorrecto. Fíjate en la siguiente ejecución, cuando se guarda el producto pone que el precio es 3,49, pero al rescatarlo de nuevo pone que el precio es 4,22.&nbsp;&nbsp;</p>
<p>¿Sabrías decir por qué?</p>
<div class="highlighted-code language-java">
<div>
<pre>&lt;strong&gt;Entidad 1 guardada&lt;/strong&gt; [Producto: Cuchara Elegance, Precio: &lt;strong&gt;3,49&lt;/strong&gt;]
Precio con IVA entidad 1 [Producto: Cuchara Elegance, Precio con IVA: 4,22]
Entidad 2 guardada [Producto: Cuchara Normal, Precio: 1,39]
Precio con IVA entidad 1 [Producto: Cuchara Normal, Precio con IVA: 1,68]
&lt;strong&gt;Entidad 1 rescatada&lt;/strong&gt; [Producto: Cuchara Elegance, Precio: &lt;strong&gt;4,22&lt;/strong&gt;]
Entidad 2 rescatada [Producto: Cuchara Normal, Precio: 1,68]</pre>
</div>
</div>
</div>
<div id="taquesQuestion0b170" class="block iDevice_content">

</div>
<form name="feedback-form-quesFeedback0b170" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b170text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b170" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b170" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>No es fácil ver el problema, y si lo has averiguado, ¡¡genial, puedes alegrarte!!</p>
<p>El problema es que para calcular el precio con <acronym title="Impuesto sobre el valor añadido">IVA</acronym> se ha modificado el valor del atributo precio:</p>
<div class="highlighted-code language-java">
<div>
<pre>            p1.setPrecio(p1.getPrecio()*1.21);             </pre>
</div>
</div>
<p>Además, el producto no se desligó (detach) después de ejecutar el método&nbsp;persist y dicha modificación se guardó también en el siguiente commit. Esto no sería un problema si la entidad se hubiera <strong>desligado antes del siguiente commit</strong>:</p>
<div class="highlighted-code language-java">
<div>
<pre>            ...
            // Almacenamos la primera instancia
            em.getTransaction().begin();
            em.persist(p1);
            em.getTransaction().commit();
            em.detach(p1); // Desligamos justo después del commit
            ...
            // Almacenamos la segunda instancia
            em.getTransaction().begin();
            em.persist(p2);
            em.getTransaction().commit();
            em.detach(p2); //Desligamos justo después del commit                       
            ...</pre>
</div>
</div>
<p>A continuación tienes el código corregido:</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/CodigoCorrecto.java" title="Descargar el código corregido del ejercicio. Se abre en una nueva ventana [java - 3.67 KB]" target="_blank" class="binario">Código del ejercicio corregido.</a><span class="exe-link-data file-size"> (java - 3.67 <abbr lang="en" title="KiloBytes">KB</abbr>)</span>.</p></div>
</form>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id176">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id176-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta176_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b176" class="block iDevice_content">
<p>¿Recuerdas cómo era la entidad&nbsp;Ticket del mini punto de venta? ¿Serías capaz de implementar un método para crear (y almacenar) un <span lang="en">ticket</span> que tuviese como fecha y hora el momento de creación del <span lang="en">ticket</span> (now())?</p>
</div>
<form name="feedback-form-quesFeedback0b176" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b176text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b176" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b176" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Teniendo en cuenta que la entidad&nbsp;Ticket ya tiene un constructor que admite la fecha y la hora, realizar la operación descrita antes es muy sencillo:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static Ticket crearNuevoTicket(EntityManager em)
    {      
        em.getTransaction().begin();        
        Ticket t=new Ticket(LocalDate.now(), LocalTime.now());
        em.persist(t);        
        em.getTransaction().commit();        
        em.detach(t);
        return t;
    }</pre>
</div>
</div></div>
</form>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id179">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id179-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta179_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b179" class="block iDevice_content">
<p>Y ahora te proponemos un último ejercicio, algo más fácil de lo que parece.<span style="font-size: 1em;">¿Serías capaz de añadir una línea de</span><span lang="en" style="font-size: 1em;"> ticket</span><span style="font-size: 1em;"> a un </span><span lang="en" style="font-size: 1em;">ticket</span><span style="font-size: 1em;">? </span></p>
<p><span style="font-size: 1em;">Te proponemos que hagas un método con la siguiente cabecera:</span></p>
<div class="highlighted-code language-java">
<div>
<pre>public static void addLineaTicket (EntityManager em, long idTicket, long idProducto, int unidades)
</pre>
</div>
</div>
<p>Recuerda que la relación&nbsp;@OneToMany entre <span lang="en">ticket</span> y línea de<span lang="en"> ticket</span> tiene el parámetro (cascade = CascadeType.PERSIST). Además, si revisas el código de la entidad Ticket, encontrarás que dispone de un método llamado:&nbsp; public void lineaTicket(Producto p, int cantidad).</p>
</div>
<form name="feedback-form-quesFeedback0b179" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b179text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b179" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b179" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>El código es mucho más sencillo de lo que parece, no obstante, aquí lo tienes completamente comentado. Gracias a la capacidad de persistir en cascada&nbsp;(cascade = CascadeType.PERSIST) de <acronym title="Java Persistence API" lang="en">JPA</acronym>, solo hay que guardar el el <span lang="en">ticket</span> después de añadir la línea de <span lang="en">ticket</span>, sin necesidad de guardar la línea de <span lang="en">ticket</span> por separado:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static void addLineaTicket (EntityManager em, long idTicket, long idProducto, int unidades)
    {
        em.getTransaction().begin();                
        //Buscamos el producto y el ticket
        Producto p=em.find(Producto.class, idProducto);
        Ticket t=em.find(Ticket.class, idTicket);
        //Realizamos la operación solamente si el producto y el ticket existen
        // y además, si el ticket no está cerrado:
        if (p!=null &amp;&amp; t!=null &amp;&amp; !t.isTicketCerrado())
        {
            /*Aprovechamos los métodos creados en la clase Ticket para
            almacenar la línea de ticket en la lista de líneas de ticket */             
            t.lineaTicket(p, unidades);
            /* No es necesario "persitir" la línea de ticket, la línea de ticket
            ya está almacenada en la lista de líneas de ticket del ticket y la
            relación @OneToMany tiene el parámetro cascade = CascadeType.PERSIST*/
            em.persist(t);            
            // confirmamos la operación
            em.getTransaction().commit();
        }
        else
        {
            //Si algo va mal, deshacemos la operación
            em.getTransaction().rollback();
        }
        
        // (optional) Desligamos las entidades
        if (p!=null) em.detach(p);               
        if (t!=null) em.detach(t);
                                    
    }</pre>
</div>
</div></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.6.2.-  Actualizar y borrar instancias</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id98">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id98-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta98_154" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/keyboard-155722_640.jpg" alt="Imagen que muestra un teclado donde hay dos teclas marcadas en rojo que ponen " pánico"="" y="" "borrar"="" en="" inglés."="" title="Pánico a borrar datos." width="250" height="177">
<div class="figcaption"><a href="https://pixabay.com/es/illustrations/teclado-bot%C3%B3n-p%C3%A1nico-elimina-155722/" target="_blank" class="author" title="Acceder a la imagen  " pánico="" a="" borrar="" datos",="" de="" "geralt",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">geralt&nbsp;<span class="sep">(</span></a><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><a href="https://pixabay.com/es/illustrations/teclado-bot%C3%B3n-p%C3%A1nico-elimina-155722/" target="_blank" class="author"><span class="sep">)</span></a></div>
</div>
<p>¿Te resultó fácil persistir y leer entidades usando <acronym title="Java Persistence API" lang="en">JPA</acronym>? Seguro que sí. Ahora vamos a ver cómo se realizan las operaciones de actualización y borrado de entidades. ¿Cuál de las dos te causa más respeto?</p>
<h4>Actualizar una instancia de entidad</h4>
<p>Cuando se trata de una entidad que ya está siendo <strong>gestionada</strong> por el EntityManager, basta con modificar los datos de la misma y hacer un&nbsp;commit para que se modifiquen también los datos en el almacén de datos. Imagina que en el almacén de datos ya existe un producto con id=990. Para modificarlo solo habría que hacer lo siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>//Cargamos la instancia de entidad. Esta instancia tendrá el estado de gestionada
Producto productoGestionado=em.find(Producto.class, (long)990);

//Realizamos las modificaciones oportunas            
productoGestionado.setNombre("Cuchara Premium");        

//Iniciamos y cerramos una transacción   
em.getTransaction().begin();                       
em.getTransaction().commit();</pre>
</div>
</div>
<p>En este caso, después de usar el método find, la instancia de entidad cambia su estado a <strong>gestionada</strong>, por lo que el&nbsp;EntityManager se hará cargo de actualizar el almacén de datos cuando haya modificaciones en el siguiente commit.</p>
<p>Pero, ¿qué pasa cuando una instancia de entidad no está siendo gestionada por el EntityManager? Recuerda que podemos decirle al&nbsp;EntityManager que deje de gestionar una entidad usando el método detach. En ese caso hay que fusionar los datos de la entidad desligada con los que pudiera haber en el almacén de datos, usando para ello el método merge:</p>
<div class="highlighted-code language-java">
<div>
<pre>//Modificamos los datos de la instancia de entidad no gestionada
productoNoGestionado.setNombre("Cuchara Premium");        
//Iniciamos una transacción
em.getTransaction().begin();
//Fusionamos la instancia de la entidad
Producto productoGestionado=em.merge(productoNoGestionado);
//Hacemos commit para sincronizar con el almacén de datos.
em.getTransaction().commit();
</pre>
</div>
</div>
<p>En el ejemplo anterior la instancia de entidad productoNoGestionado contiene un producto que no está siendo gestionado por el EntityManager. Al hacer el merge se fusiona su información con la del almacén de datos y se convierte en un producto gestionado, retornado por el mismo método merge. Al realizar la fusión se actualiza el objeto rescatado del almacén de datos con los datos de la instancia no gestionada, y al hacer el commit, los cambios se volcarán al almacén de datos.</p>
<p>En ambos casos, después de actualizar los datos del almacén conviene usar el método&nbsp;detach para desligar la instancia del EntityManager. Tendrás que analizar en qué situaciones necesitas desligar la instancia de entidad.</p>
<div class="highlighted-code language-java">
<div>
<pre>em.detach(productoGestionado);</pre>
</div>
</div>
<h4>Borrar una instancia de entidad</h4>
<p>Borrar una entidad es un proceso sencillo que requiere que la entidad esté siendo <strong>gestionada</strong> por el EntityManager. Se dan nuevamente dos situaciones similares a las dadas en la operación de actualización. Puede que la entidad ya esté siendo gestionada previamente o puede que no. Si la entidad ya está siendo gestionada, podemos hacer algo como lo siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>Producto productoGestionado=em.find(Producto.class, (long)990);&lt;br /&gt;&lt;br /&gt;// ... código ...
            
em.getTransaction().begin();                       
em.remove(productoGestionado);
em.getTransaction().commit();</pre>
</div>
</div>
<p>En el ejemplo anterior, el método remove eliminará la instancia de entidad <strong>gestionada</strong>, que pasará al estado de <strong>eliminada</strong>. Sin embargo, el procedimiento para eliminar una <strong>entidad no gestionada</strong> es completamente diferente:</p>
<div class="highlighted-code language-java">
<div>
<pre>em.getTransaction().begin();
Producto productoGestionado=em.merge(productoNoGestionado);
em.remove(productoGestionado);
em.getTransaction().commit();</pre>
</div>
</div>
<p>Como puedes ver, en este segundo caso, antes de usar el método remove, tendremos que usar el método&nbsp;merge para que el&nbsp;EntityManager empiece a gestionar la instancia y poder así eliminarla posteriormente.</p>
<div class="destacado" style="text-align: center;"><strong>El EntityManager no podrá actualizar ni borrar entidades que no tengan el estado de gestionadas. </strong></div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id180">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id180-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta180_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b180" class="block iDevice_content">
<p>Te pronemos ahora hacer un pequeño ejercicio, que seguro que te resultará sencillo. Se trata de crear un método que modifique el precio de un producto partiendo del&nbsp;id de producto. El método debe tener una cabecera como la siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>public static boolean actualizarPrecioProducto (EntityManager em, long idproducto, double precio)
</pre>
</div>
</div>
<p>¿Serás capaz?</p>
</div>
<form name="feedback-form-quesFeedback0b180" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b180text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b180" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b180" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Seguro que lo has conseguido, pero por si acaso, te proponemos la siguiente solución:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static boolean actualizarPrecioProducto (EntityManager em, long idproducto, double precio)
    {
        boolean operacionRealizada=false;
        //Al hacer el find, el producto se convierte en gestionado.
        Producto productoAModificar=em.find(Producto.class, idproducto);
        if (productoAModificar!=null) //Si el producto existe
        {
            //Establecemos el precio
            productoAModificar.setPrecio(precio);            
            em.getTransaction().begin();
            //En este commit se almacenará la entidad
            em.getTransaction().commit();
            //Desligamos la entidad, para evitar problemas
            em.detach(productoAModificar);            
            operacionRealizada=true;
        }
        return operacionRealizada;
    }</pre>
</div>
</div>
<p></p></div>
</form>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id178">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id178-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta178_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b178" class="block iDevice_content">
<p>Te proponemos un ejercicio más, también muy sencillo. Como sabrás, un <span lang="en">ticket</span> puede estar cerrado (no se admiten modificaciones en el mismo porque ya se ha pagado) o abierto (todavía se admiten modificaciones en el mismo). La idea ahora es crear un método que elimine un <span lang="en">ticket</span> solo si no está cerrado. La cabecera del método debe ser la siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>public static boolean borrarTicket (EntityManager em, long idTicket)
</pre>
</div>
</div>
<p>Recuerda que la entidad&nbsp;Ticket dispone de un método llamado isTicketCerrado que permite comprobar si el <span lang="en">ticket</span> está cerrado o no. ¿Sabes cómo hacerlo?</p>
</div>
<form name="feedback-form-quesFeedback0b178" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b178text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b178" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b178" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>Una solución posible para el método anterior sería la siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static boolean borrarTicket (EntityManager em, long idTicket)
    {
        boolean operacionRealizada=false;
        //Al hacer el find, el ticket se convierte en gestionado.
        Ticket ticketAEliminar=em.find(Ticket.class, idTicket);
        //Si el existe y no está cerrado, podremos eliminarlo, en caso contrario no
        if (ticketAEliminar!=null &amp;&amp; !ticketAEliminar.isTicketCerrado()) 
        {
            //Iniciamos transacción
            em.getTransaction().begin();
            //Borramos el ticket
            em.remove(ticketAEliminar);
            //Confirmamos las operaciones.
            em.getTransaction().commit();            
            operacionRealizada=true;
        }
        return operacionRealizada;
    }</pre>
</div>
</div></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.7.- JPQL (I)</h1></div></div>
<div class="iDevice_wrapper CasopracticofpdIdevice em_iDevice" id="id172">
<div class="iDevice emphasis_casopracticofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_casopracticofpd.png)"><h2 class="iDeviceTitle">Caso práctico</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id172-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta172_147" class="block iDevice_content">
<figure class="exe-figure exe-image float-left license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/job-interview-3410427_640.jpg" alt="Imagen que muestra una persona entrevistándose con Graciela." title="Entrevista con Graciela" width="250" height="166"><figcaption class="figcaption"><a href="https://pixabay.com/es/photos/entrevista-de-trabajo-entrevista-3410427/" target="_blank" class="author" title="Acceder a la imagen  " entrevista="" con="" graciela",="" de="" "styles66",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">styles66&nbsp;</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></figcaption></figure>
<p><strong>Juan</strong> y <strong>María</strong> acaban de tener una entrevista con <strong>Graciela</strong>, la asesora de la empresa cliente. Aunque ambos estaban un poco nerviosos, finalmente la entrevista no ha ido nada mal.</p>
<p><strong>Graciela</strong> les ha resultado muy agradable y la entrevista ha sido muy enriquecedora. <strong>Graciela</strong> se ha quedado sorprendida por su capacidad de anticipación, y les ha dicho que anticiparse a los problemas es un factor clave para el éxito de cualquier proyecto.</p>
<p>Durante la entrevista han hablando, entre otras cosas, de la tecnología que tenían pensado usar para desarrollar el proyecto. Resulta que <strong>Graciela</strong> ya había trabajado con <acronym title="Java Persistence API" lang="en">JPA</acronym> y mencionó varias veces <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym>. <strong>Juan</strong> y <strong>María</strong> realmente no sabían de qué estaba hablando y no querían preguntar para no dar la impresión de que tenían poca experiencia.</p>
<p>En cuanto han salido de la entrevista, ambos se han puesto a buscar como locos que era eso de <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id101">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id101-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta101_154" class="block iDevice_content">
<div class="exe-figure exe-image float-right license-pd" style="width: 200px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/SELECT.jpg" width="200" height="129" alt="Ilustración de una mano seleccionando una figura rectangular de entre un montón que aparecen juntas." title="SELECT" style="float: left;">
<div class="figcaption"><a href="https://pixabay.com/es/illustrations/selecci%C3%B3n-mano-mostrar-seleccione-68953/" target="_blank" class="author" title="Acceder a la imagen  " select",="" de="" "geralt",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">geralt</a>&nbsp;<span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a los términos de la Licencia Pixabay. (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></div>
</div>
<p>¿Qué piensas? ¿Crees que con las operaciones vistas en el apartado anterior es suficiente?</p>
<p>Me temo que no. Hay situaciones donde se necesita operar con la información del almacén de datos de forma un poco más compleja. Para ese tipo de situaciones <acronym title="Java Persistence API" lang="en">JPA</acronym> provee de un lenguaje de consulta llamado <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym> de características,&nbsp; grosso modo, parecidas a <acronym title="Structured Query Language" lang="en">SQL</acronym>.</p>
<p>La principal diferencia entre <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym> y <acronym title="Structured Query Language" lang="en">SQL</acronym> es que en <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym> usaremos el nombre de las entidades y los atributos de las mismas, en lugar del nombre de las tablas y columnas.</p>
<p>Imagina que necesitas obtener todos los productos con un precio superior a 15<abbr title="euro">€</abbr>. Para ello podrías usar una sentencia <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym> como la siguiente:</p>
<div class="highlighted-code language-sql">
<div>
<pre>SELECT p FROM Producto p WHERE p.precio&gt;=15</pre>
</div>
</div>
<p>En la sentencia <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym> anterior, Producto hace referencia a la entidad&nbsp;Producto y&nbsp;<code>p</code> es similar a una variable <span lang="en">Java</span>. Las instancias de entidad almacenadas son filtradas por la sección WHERE, donde como puedes ver, se usa el mismo nombre de atributo que tiene la entidad (precio). Así, al poner&nbsp;p.precio estamos haciendo referencia al valor que tiene dicho atributo para cada una de las instancias de&nbsp;Producto almacenadas.</p>
<p>Por tanto, las sentencias SELECT sirven para acceder a una porción de las instancias almacenadas. Aquí no vamos a profundizar en su sintaxis, al igual que tampoco lo hicimos para <acronym title="Structured Query Language" lang="en">SQL</acronym>. Solo vamos a exponer unos ejemplos:</p>
<table class="tabla" style="width: 100%;" summary="Tabla que muestra varios ejemplos comunes de consultas JPQL tipo SELECT, indicando en la primera columna lo que se desea hacer y en la segunda columna el ejemplo de consulta a realizar.." java="" persistence="" query="" language="" lang="en"><caption>Ejemplos de consultas <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym> tipo SELECT típicas.</caption>
<thead>
<tr><th scope="col">Descripción de la consulta que se desea hacer.</th><th scope="col">Ejemplo de la consulta a realizar.</th></tr>
</thead>
<tbody>
<tr>
<td>
<p><strong>Obtener todas las instancias de una entidad.</strong></p>
<p></p>
</td>
<td>
<p>A diferencia del ejemplo anterior, si queremos obtener todas las instancias de una entidad, simplemente quitamos la sección WHERE:</p>
<div class="highlighted-code language-sql">
<div>
<pre>SELECT p FROM Producto p</pre>
</div>
</div>
</td>
</tr>
<tr>
<td>
<p><strong>Obtener las instancias de una entidad que cumplan dos condiciones.</strong></p>
<p><br></p>
</td>
<td>
<p></p>
<p>En este tipo de situaciones, uniremos las condiciones de la sección&nbsp;WHERE con AND, por ejemplo, a continuación se seleccionan todos los productos con un precio entre 15 y 30 euros: &lt;br /&gt;</p>
<div class="highlighted-code language-sql">
<pre class="  language-sql">SELECT p FROM Producto p WHERE   p.precio&gt;=15 <code class="  language-sql"><span class="token operator">AND</span> </code>p.precio&lt;=30</pre>
</div>
</td>
</tr>
<tr>
<td>
<p><strong>Obtener las instancias de una entidad que cumpla al menos una condición de varias condiciones dadas.</strong></p>
<p><br></p>
</td>
<td>
<p>En este tipo de situaciones, uniremos las condiciones de la sección&nbsp;WHERE con OR, por ejemplo, en la siguiente consulta se seleccionan todos los productos cuyo precio<strong> no</strong> está entre 15 y 30 euros:</p>
<div class="highlighted-code language-sql">
<pre class="  language-sql">SELECT p FROM Producto p WHERE <code class="  language-sql">p<span class="token punctuation">.</span>precio<span class="token operator">&lt;</span><span class="token number">15</span> </code>OR <code class="  language-sql">p<span class="token punctuation">.</span>precio<span class="token operator">&gt;</span><span class="token number">30</span></code></pre>
</div>
</td>
</tr>
<tr>
<td>
<p><strong>Obtener las instancias de una entidad que no cumpla una condición concreta<br></strong></p>
<p></p>
</td>
<td>
<p></p>
<p>En este tipo de situaciones, usaremos&nbsp;NOT en la sección WHERE. En el siguiente ejemplo se seleccionan aquellos productos que <strong>no</strong> tienen un precio inferior o igual a 15 euros, o lo que es lo mismo, que tienen un precio superior a 15 euros:</p>
<div class="highlighted-code language-sql">
<div>
<pre>SELECT p FROM Producto p WHERE NOT (p.precio&lt;=15)</pre>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<p></p>
<p>De forma equivalente a las sentencias anteriores, también se pueden hacer consultas de eliminación (DELETE) y actualización de entidades (UPDATE), de forma muy similar a <acronym title="Structured Query Language" lang="en">SQL</acronym>. Veamos algunos ejemplos:</p>
<table class="tabla" summary="Tabla que muestra varios ejemplos de consultas JPQL tipo DELETE y UPDATE. En la primera columna se muestra la descripción de la consulta que se desea hacer, y en la segunda columna la consulta a realizar para obtener el resultado deseado." java="" persistence="" query="" language="" lang="en" style="width: 100%;"><caption>Ejemplos de consultas <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym> tipo&nbsp;DELETE y&nbsp;<code>UPDATE</code> típicas.</caption>
<tbody>
<tr><th>Descripción de la consulta que se desea hacer.</th><th>Ejemplo de la consulta a realizar.</th></tr>
<tr>
<td>
<p></p>
<p><strong>Actualizar un atributo de una entidad concreta</strong></p>
<p></p>
</td>
<td>
<p>Para este tipo de situaciones recurrimos a consultas tipo UPDATE. En la sección&nbsp;WHERE indicaremos cuál es la entidad a modificar, especificando la clave primaria correspondiente, y en la sección&nbsp;SET indicamos los atributos a modificar:</p>
<div class="highlighted-code language-sql">
<div>
<pre>UPDATE Producto p SET p.precio=34 WHERE p.id=16</pre>
</div>
</div>
</td>
</tr>
<tr>
<td>
<p><strong>Actualizar más de un atributo de una entidad concreta</strong></p>
</td>
<td>
<p>Para este tipo de situaciones recurrimos también a consultas tipo UPDATE, pero en la sección SET, separados por comas, indicamos todos los atributos que deseamos modificar:</p>
<div class="highlighted-code language-sql">
<div>
<pre>UPDATE Producto p SET p.precio=34, p.barCode='2212988389291' WHERE p.id=16</pre>
</div>
</div>
</td>
</tr>
<tr>
<td>
<p><strong>Actualizar un atributo con una fórmula</strong></p>
</td>
<td>
<p>A la hora de actualizar un atributo es posible usar una fórmula matemática simple (también se pueden usar en la sección WHERE). En el siguiente ejemplo se incrementan todos los productos un 15% de precio:</p>
<div class="highlighted-code language-sql">
<div>
<pre>UPDATE Producto p SET p.precio=p.precio*1.15</pre>
</div>
</div>
</td>
</tr>
<tr>
<td>
<p><strong>Borrar una entidad concreta</strong></p>
</td>
<td>
<p>Para eliminar una entidad concreta, aunque existen otros procedimientos, también podemos recurrir a las consultas tipo DELETE, especificando el valor de la clave primaria correspondiente:</p>
<div class="highlighted-code language-sql">
<div>
<pre>DELETE FROM Producto p WHERE p.id=15</pre>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<p></p>
<p>Y ya solo nos queda revisar un concepto más, las <strong><span class="destacado_inline">consultas paramétricas</span></strong>. La realidad es que, salvo raras excepciones, las consultas son siempre paramétricas. Es decir, <strong>no tienen unos valores fijos para los datos, sino que depende de la situación los datos usados en la consulta van cambiando</strong>. En el siguiente ejemplo es una consulta paramétrica de actualización:</p>
<div class="highlighted-code language-sql">
<div>
<pre>UPDATE Producto p SET p.precio=:precio WHERE p.id=:id</pre>
</div>
</div>
<p>En la consulta anterior ":id" sería el&nbsp;id del producto a modificar y&nbsp;":precio" sería el nuevo precio del producto. Antes de ejecutar la consulta, los parámetros serán reemplazados de forma segura, evitando que la consulta tenga una sintaxis errónea o que pueda provocar pérdida o modificación de información malintencionada. Esto se verá en el siguiente apartado.</p>
</div>
</div>
</div>
<div class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice" id="id103">
<div class="iDevice emphasis_parasabermasfpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_parasabermasfpd.png)"><h2 class="iDeviceTitle">Para saber más</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id103-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta103_128" class="block iDevice_content">
<p>En la siguiente página encontrarás un poco más de información sobre <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym>, por si quieres ampliar tus conocimientos en el área:</p>
<p style="text-align: center;"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/pluginfile.php/56013/mod_scorm/content/0/JPA_articulo.pdf" title="Acceder a artículo sobre JPQL. Se abre en una nueva ventana [pdf - 375472 B]" target="_blank" class="pdf">Artículo sobre <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym>.</a><span class="exe-link-data file-size"> (pdf - 375472 <abbr title="Bytes" lang="en">B</abbr>)</span></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js";jQuery(function(){loadPage()})</script>
<div id="outer">
<div id="main">
<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">2.7.1.- JPQL (II)</h1></div></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id102">
<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id102-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
<div id="ta102_154" class="block iDevice_content">
<figure class="exe-figure exe-image float-right license-CC-BY-SA" style="width: 250px;"><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/computer-1873831_640.png" alt="Imagen que muestra código fuente." title="Código fuente." width="250" height="137"><figcaption class="figcaption"><a href="https://pixabay.com/es/photos/ordenador-c%C3%B3digo-inform%C3%A1tico-1873831/" target="_blank" class="author" title="Acceder a la imagen  " código="" fuente",="" de="" "boskampi",="" en="" pixabay.="" (se="" abre="" una="" nueva="" ventana)"="">Boskampi </a><span class="license"><span class="sep">(</span><a href="https://pixabay.com/es/service/license/" title="Acceder a la Licencia Pixabay (Se abre en una nueva ventana)" target="_blank">Licencia Pixabay</a><span class="sep">)</span></span></figcaption></figure>
<p>Y ahora seguro que te estarás preguntando, ¿cómo ejecuto una consulta <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym>?</p>
<p>Si en el apartado anterior veíamos cómo eran las consultas <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym>, aquí vamos a responder justo a esa pregunta. Estas consultas son muy similares a los&nbsp;PreparedStatement de <acronym title="Java Database Connectivity" lang="en">JDBC</acronym>, verás qué fácil.</p>
<p>Vamos a empezar poniendo un ejemplo de consultas tipo&nbsp;UPDATE y <code>DELETE</code>, que en el fondo son bastante similares. Partimos de la consulta paramétrica que dejamos al final del apartado anterior. El primer paso, sería <strong><span class="resaltado_inline">crear la consulta</span></strong>:</p>
<div class="highlighted-code language-java">
<div>
<pre>EntityManager em=...&lt;br /&gt;Query q=em.createQuery("UPDATE Producto p SET p.precio=:precio where id=:id");       
</pre>
</div>
</div>
<p>Crear una consulta es tan sencillo como usar el método&nbsp;createQuery. Después, el segundo paso sería <strong><span class="resaltado_inline">establecer el valor de cada parámetro</span></strong> con el método&nbsp;setParameter. En el caso de la consulta que tenemos entre manos, el parámetro ":id" sería el&nbsp;id del producto a modificar y&nbsp;":precio" sería el nuevo precio del producto. Veamos cómo se haría:</p>
<div class="highlighted-code language-java">
<div>
<pre>q.setParameter("precio", nuevoPrecio);        
q.setParameter("id", idDelProductoAModificar);       
</pre>
</div>
</div>
<p>Y el tercer paso sería <strong><span class="resaltado_inline">ejecutar la consulta</span></strong>. Al ejecutar la consulta los parámetros serán sustituidos por los valores establecidos con el método setParameter. En el caso de las consultas tipo&nbsp;UPDATE y&nbsp;<code>DELETE</code> esta ejecución se hará con el método executeUpdate:</p>
<div class="highlighted-code language-java">
<div>
<pre>int result=q.executeUpdate();
</pre>
</div>
</div>
<p>El valor retornado por el método executeUpdate será el número de entidades actualizadas o eliminadas (dependiendo de la consulta realizada). Es importante tener en cuenta dicho valor para saber si la actualización o eliminación se han llevado a término.</p>
<div class="destacado"><strong><span>Recuerda, las consultas <acronym title="Java Persistence Query Language" lang="en">JPQL</acronym> de borrado y actualización también hay que hacerlas en una transacción. Antes de iniciar la consulta <span><acronym title="Java Persistence Query Language" lang="en">JPQL</acronym></span>, primero hay que iniciar la transacción:</span></strong><br><br><strong> em.getTransaction().begin();</strong><br><br><strong>Y al terminar tenemos que cerrar la transacción:</strong><br><br><strong> em.getTransaction().commit();</strong></div>
<p>Cuando se trata de una consulta de tipo SELECT, la cosa cambia un poco. En primer lugar, debemos <strong><span class="destacado_inline">crear la consulta pero indicando la entidad que se espera en retorno</span></strong>:</p>
<div class="highlighted-code language-java">
<div>
<pre>  TypedQuery&lt;Producto&gt; q=em.createQuery("SELECT p FROM Producto p WHERE p.precio&gt;=:preciominimo",Producto.class);
</pre>
</div>
</div>
<p>Fíjate que ahora esta versión del método retorna una instancia de&nbsp;TypedQuery, donde se especifica el tipo de dicha clase (dado que es genérica): TypedQuery&lt;Producto&gt;. <strong>Aquí es importante indicar como segundo argumento del métoco&nbsp;createQuery la entidad que se espera retornar, en este caso Producto.class</strong>. El siguiente paso, es igual al anterior, <strong><span class="destacado_inline">establecer el valor de cada parámetro</span></strong>:</p>
<div class="highlighted-code language-java">
<div>
<pre>q.setParameter("preciominimo", 15);</pre>
</div>
</div>
<p>El tercer paso sería <strong><span class="destacado_inline">obtener la lista de resultados</span></strong>, donde literalmente obtenemos una lista del mismo tipo que hemos indicado antes (List&lt;Producto&gt;) con todas las entidades que coinciden con la condición especificada:</p>
<div class="highlighted-code language-java">
<div>
<pre> List&lt;Producto&gt; r=q.getResultList();</pre>
</div>
</div>
<div class="destacado" style="text-align: center;"><strong><span>Debes tener en cuenta que cuando hacemos una consulta tipo&nbsp;SELECT las entidades rescatadas tendrán el estado de gestionadas.</span></strong><br><br></div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id181">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id181-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta181_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b181" class="block iDevice_content">
<p>Te proponesmos ahora un pequeño reto. ¿Sabrías crear un método que rescatara todos los productos cuyo precio fuera igual o superior a uno dado?</p>
<p>Intenta hacer un método que tenga la siguiente cabecera:</p>
<div class="highlighted-code language-java">
<div>
<pre>private static List&lt;Producto&gt; obtenerProductosPrecioMinimo(EntityManager em, double preciominimo)</pre>
</div>
</div>
</div>
<form name="feedback-form-quesFeedback0b181" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b181text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b181" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b181" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>El código del método indicado podría ser simplemente así:</p>
<div class="highlighted-code language-java">
<div>
<pre>    private static List&lt;Producto&gt; obtenerProductosPrecioMinimo(EntityManager em, double preciominimo) {
        String query="SELECT p FROM Producto p WHERE p.precio&gt;=:preciominimo";
        TypedQuery&lt;Producto&gt; q=em.createQuery(query,Producto.class);
        q.setParameter("preciominimo", preciominimo);
        return q.getResultList();                    
    }</pre>
</div>
</div></div>
</form>
</div>
</div>
</div>
</div>
<div class="iDevice_wrapper EjercicioresueltofpdIdevice em_iDevice" id="id182">
<div class="iDevice emphasis_ejercicioresueltofpd">
<div class="iDevice_header" style="background-image:url(https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/icon_ejercicioresueltofpd.png)"><h2 class="iDeviceTitle">Ejercicio Resuelto</h2><p class="toggle-idevice toggle-em1"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id182-em1" title="Ocultar"><span>Ocultar</span></a></p></div>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta182_63" class="block story iDevice_content">

</div>
<div id="taquesQuestion0b182" class="block iDevice_content">
<p>Y por último te proponemos el siguiente reto, algo más complicado de lo habitual. ¿Serías capaz de crear un método para eliminar los <span lang="en">tickets</span> no cerrados con una antigüedad de 4 días o más?</p>
<p>La idea es crear un método que permita limpiar <span lang="en">tickets</span>&nbsp;antiguos no cerrados con la siguiente cabecera:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static int borrarTicketsAntiguos (EntityManager em)</pre>
</div>
</div>
<p>El método debería retornar la cantidad de <span lang="en">tickets</span> borrados.</p>
</div>
<form name="feedback-form-quesFeedback0b182" action="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" onsubmit="return false" class="feedback-form">
<div class="block iDevice_buttons feedback-button js-required">
<p><script type="text/javascript">var feedbackquesFeedback0b182text = "Mostrar retroalimentación";</script><input type="button" name="toggle-feedback-quesFeedback0b182" value="Mostrar retroalimentación" class="feedbackbutton feedback-toggler"></p>
</div>
<div id="feedback-quesFeedback0b182" class="feedback js-feedback js-hidden" role="status">
<h3 class="js-sr-av">Retroalimentación</h3>
<p>No es un ejercicio fácil, por lo que si lo has conseguido, ¡enhorabuena! Una solución posible podría ser la siguiente:</p>
<div class="highlighted-code language-java">
<div>
<pre>    public static int borrarTicketsAntiguos (EntityManager em)
    {
        em.getTransaction().begin();    
        String query="DELETE FROM Ticket t WHERE t.fecha&lt;:fecha and t.ticketCerrado=false";
        Query q=em.createQuery(query);
        LocalDate fechaAntigua=LocalDate.now().minusDays(4); //calculamos la fecha de hace 4 días.
        q.setParameter("fecha", java.sql.Date.valueOf(fechaAntigua)); //Establecemos como fecha para comparar la fecha de hace cuatro días.
        //Fíjate que el tipo de datos usado es java.sql.Date

        int entidadesAfectadas=q.executeUpdate(); //Ejecutamos la consulta       
        em.getTransaction().commit();                
        return entidadesAfectadas;    
    }</pre>
</div>
</div></div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div><script type="text/javascript">document.body.className+=" js"</script>
			<div id="outer">
			<div id="main">
			<div id="nodeDecoration"><div id="headerContent"><h1 id="nodeTitle">Condiciones y términos de uso de los materiales</h1></div></div>
			<div class="iDevice_wrapper DestacadofpdIdevice" id="id60">
			<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id60-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
			<div class="iDevice_destacadofpd">
			<div id="ta60_66" class="block iDevice_content">
			<div title="Información acerca de la licencia de los materiales">
			<p align="center" style="margin: 2px 2px;"><strong>Materiales desarrollados inicialmente por el Ministerio de Educación, Cultura y Deporte y actualizados por el profesorado de la Junta de Andalucía bajo licencia Creative Commons <acronym title="Reconocimiento-NoComercial-CompartirIgual">BY-NC-SA.</acronym></strong></p>
						      <p align="center" style="font-size: 0.8em; margin: 2px 2px;"><strong><img src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/img_para_licencias.png" height="94" alt="Logotipos del Ministerio de Educación, Cultura y Deporte, Junta de Andalucía y licencia Creative Commons"></strong></p>
                              <p align="center" style="font-size: 0.8em; margin: 2px 2px;"><span>Antes de cualquier uso leer detenidamente el siguente</span> <a href="https://www.juntadeandalucia.es/educacion/gestionafp/documentacion/aviso_legal/aviso_legal_mjda/index.html" target="_blank" title="Enlace externo, se accede al aviso legal de los materiales">Aviso legal</a></p>
			</div>
			</div>
			</div>
			</div>
			</div>
			<div class="iDevice_wrapper FreeTextIdevice" id="id61">
			<p class="toggle-idevice toggle-em0"><a href="https://educacionadistancia.juntadeandalucia.es/formacionprofesional/blocks/recopila/recopila.php?id=4052&amp;dopt=1#" id="toggle-idevice-id61-em0" title="Ocultar"><span>Ocultar</span></a></p><div class="iDevice emphasis0">
			<div id="ta61_85" class="block iDevice_content">
			<h3>Historial de actualizaciones</h3>
			<table border="0" class="tabla" style="width: 100%;"><tbody><tr><th scope="col">Versión: 04.02.00</th><th scope="col">Fecha de actualización: 23/03/22</th><th scope="col">Autoría: Diosdado Sánchez Hernández</th></tr><tr>
                            <td colspan="3"><p><strong>Ubicación: </strong>1.7.1.2.- Recuperación de información (II)<br><strong>Mejora (tipo 2): </strong>Incluir una breve explicación sobre la conveniencia de utilizar sentencias SQL preparadas (objeto PreparedStatement) indicando las ventajas que ello conlleva (rendimiento y seguridad frente a inyecciones SQL).<br>
Podría hacerse a través de un iDevice de tipo Para saber más donde se incluyan un par de enlaces:<br>
Uno con alguna explicación interesante sobre el funcionamiento de las sentencias preparadas.<br>
Otro sobre el concepto de inyección SQL.</p></td></tr></tbody></table><table border="0" class="tabla" style="width: 100%;"><tbody><tr><th scope="col">Versión: 04.01.00</th><th scope="col">Fecha de actualización: 24/11/21</th><th scope="col">Autoría: José Javier Bermúdez Hernández</th></tr><tr>
                            <td colspan="3"><p><strong>Ubicación: </strong>2.2.<br><strong>Mejora (tipo 1): </strong>Cambiar el enlace de DataNucleus del último para saber más, pues ya no funciona</p><p><strong>Ubicación: </strong>1.7.6.<br><strong>Mejora (tipo 1): </strong>Cambiar el enlace de los códigos de error que ya no funciona</p><p><strong>Ubicación: </strong>1.7.5<br><strong>Mejora (tipo 1): </strong>Cambiar enlace del Para Saber más que ya no funciona</p><p><strong>Ubicación: </strong>1.5.1<br><strong>Mejora (tipo 2): </strong>Convertir el swf de comandos SQL en un pdf</p><p><strong>Ubicación: </strong>1,5<br><strong>Mejora (tipo 2): </strong>Sustituir la presentación del debes conocer por un vídeo donde se muestre cómo crear tablas con MySQL Workbench</p><p><strong>Ubicación: </strong>1.4<br><strong>Mejora (tipo 2): </strong>Cambiar la presentación swf sobre la instalación de MySQL por un vídeo</p></td></tr></tbody></table><table border="0" class="tabla" style="width: 100%;"><tbody><tr><th scope="col">Versión: 04.00.00</th><th scope="col">Fecha de actualización: 23/06/20</th><th scope="col">Autoría: Salvador Romero Villegas</th></tr><tr>
                            <td colspan="3"><p><strong>Ubicación: </strong>Apartado 2. Bases de datos orientadas a objetos con Java.<br><strong>Mejora (tipo 3): </strong>7.- Cambiar la parte de DB4O por JPA y JDO. Casi todas las bases de datos OO y OR tienen soporte a ambos APIs.</p><p><strong>Ubicación: </strong>Apartado 1. Bases de datos relacionales.<br><strong>Mejora (tipo 2): </strong>1.- Cambiar los ejemplos donde no haya un “try-catch”, para capturar la excepción generada en vez de propagarla.<br>
<br>
// 2.- Quitar posibles referencias a Oracle si las hubiera y generalizar ciertos procesos a cualquier base de datos relacional con soporte de JDBC (independientemente de si es MySQL, H2, etc.). Apartados implicados: 1.3, 1.6, 1.6.1 y 1.6.2. Dejar los ejemplos para MySQL, añadir algún otro para otra base de datos como H2, pero que quede claro cual es el la parte común para cualquier base de datos. <br>
<br>
//3.- Apartado 1.6. Cambiar “instalación del conector de la base de datos” con “añadir conector de la base de datos a un proyecto” o algo así, dado que no es una instalación propiamente dicha.<br>
<br>
//4.- Mejorar la explicación del apartado 1.7.5 indicando que es necesario cerrar las conexiones y el Statement, para liberar recursos. Conveniencia de usar try-with-resources en Statements.<br>
<br>
//5.- Añadir ejemplos con PreparedStatement, que es lo lógico aquí. Apartados a modificar son 1.7.1, 1.7.2, 1.7.3 y 1.7.4.<br>
<br>
//6.- Apartado 1.7.6. Añadir ejemplo de uso de SQLException para detectar cuando se viola una Constraint (duplicated key, por ejemplo).  Indicar aquí la importancia de cerrar el Statement cuando se produce una excepción (seccion finally o try-with-resource).<br>
</p><p><strong>Ubicación: </strong>Cambio del mapa conceptual para adaptarlo al cambio tipo 3 de la unidad.<br><strong>Mejora (Mapa conceptual): </strong>Cambio del mapa conceptual para adaptarlo al cambio tipo 3 de la unidad.</p><p><strong>Ubicación: </strong>Todas las orientaciones.<br><strong>Mejora (Orientaciones del alumnado): </strong>Cambiar el índice para que coincida con los cambios de tipo 3 realizados en la unidad.</p></td></tr></tbody></table><table border="0" class="tabla" style="width: 100%;"><tbody><tr><th scope="col">Versión: 03.00.00</th><th scope="col">Fecha de actualización: 22/04/15</th><th scope="col">Autoría: José Javier Bermúdez Hernández</th></tr><tr>
                            <td colspan="3"><p><strong>Ubicación: </strong>Toda la unidad<br><strong>Mejora (tipo 3): </strong>Se han eliminado los contenidos de Caché, respecto a bases de datos orientadas a objeto. Se ha añadido db4o sobre BBDDOO.</p><p><strong>Ubicación: </strong>1.4.- Instalación de la base de datos.<br><strong>Mejora (tipo 1): </strong>En la autoevaluación, sobra la palabra usar.  DONDE PONE: Para usar programar accesos a MySQL... DEBE PONER: Para programar accesos a MySQL... </p><p><strong>Ubicación: </strong>Apartado  1.7.4 Borrado de información.<br><strong>Mejora (tipo 1): </strong>Código de ejemplo al Statement se le llama de forma distinta a como se ha declarado cuando se usa.<br>
Donde pone:<br>
<br>
Statement s = con.createStatement();<br>
<br>
  numReg = res.executeUpdate( DELETE FROM CLIENTE WHERE NIF= 66778998T  );<br>
<br>
Debería poner: <br>
<br>
Statement s = con.createStatement();<br>
<br>
  numReg = s.executeUpdate( DELETE FROM CLIENTE WHERE NIF= 66778998T  );</p></td></tr></tbody></table><table border="0" class="tabla" style="width: 100%;"><tbody><tr><th scope="col">Versión: 02.00.00</th><th scope="col">Fecha de actualización: 04/04/14</th><th scope="col">Autoría: José Javier Bermúdez Hernández</th></tr><tr>
                            <td colspan="3">&nbsp;Se han fusionado las originales unidades 10 y 11. Se han actualizado algunas presentaciones y algunas erratas.</td></tr></tbody></table><table border="0" class="tabla" style="width: 100%;"><tbody><tr><th scope="col">Versión: 01.00.00</th><th scope="col" colspan="2">Fecha de actualización: 01/04/14</th></tr><tr>
                            <td colspan="3">Versión inicial de los materiales.</td></tr></tbody></table>
			</div>
			</div>
			</div>
			</div>
			</div>
			<script type="text/javascript" src="./educacionadistancia.juntadeandalucia.es_formacionprofesional_blocks_recopila_recopila.php_id=4052&amp;dopt=1_files/_fpd_js.js"></script><div style="page-break-before: always;"></div>

</body></html>